<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 17 Define dependencies | Outstanding User Interfaces with Shiny</title>
<meta name="author" content="David Granjon">
<!-- CSS --><link rel="stylesheet" href="css/style.css">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.2/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.2/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.1.9000/tabs.js"></script><script src="libs/bs3compat-0.2.1.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Outstanding User Interfaces with Shiny</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li class="book-part">Introduction</li>
<li><a class="" href="web-intro.html"><span class="header-section-number">1</span> Shiny and the Web</a></li>
<li><a class="" href="web-dependencies.html"><span class="header-section-number">2</span> Discover Shiny dependencies</a></li>
<li class="book-part">Unleash {htmltools}: from R to HTML</li>
<li><a class="" href="htmltools-overview.html"><span class="header-section-number">3</span> htmltools overview</a></li>
<li><a class="" href="htmltools-dependencies.html"><span class="header-section-number">4</span> Dependency utilities</a></li>
<li class="book-part">Beautify with CSS and SASS</li>
<li><a class="" href="beautify-css.html"><span class="header-section-number">5</span> Introduction to CSS</a></li>
<li><a class="" href="beautify-sass.html"><span class="header-section-number">6</span> Introduction to SASS</a></li>
<li><a class="" href="beautify-with-fresh.html"><span class="header-section-number">7</span> Beautify with fresh</a></li>
<li><a class="" href="beautify-with-bootstraplib.html"><span class="header-section-number">8</span> Beautify with bootstraplib</a></li>
<li><a class="" href="beautify-other-tools.html"><span class="header-section-number">9</span> Other tools</a></li>
<li class="book-part">Deep dive in the Shiny input system</li>
<li><a class="" href="survival-kit-javascript.html"><span class="header-section-number">10</span> JavaScript for Shiny</a></li>
<li><a class="" href="shiny-intro.html"><span class="header-section-number">11</span> Shiny’s internal: session and websockets</a></li>
<li><a class="" href="shiny-input-system.html"><span class="header-section-number">12</span> Shiny’s input system</a></li>
<li><a class="" href="shiny-input-lifecycle.html"><span class="header-section-number">13</span> Shiny inputs lifecycles</a></li>
<li><a class="" href="shiny-input-gems.html"><span class="header-section-number">14</span> Hidden gems about inputs</a></li>
<li><a class="" href="shiny-custom-handler.html"><span class="header-section-number">15</span> Custom handlers: from R to JavaScript</a></li>
<li class="book-part">Practice 1: a dashboard template</li>
<li><a class="" href="custom-templates-selection.html"><span class="header-section-number">16</span> Template selection</a></li>
<li><a class="active" href="custom-templates-dependencies.html"><span class="header-section-number">17</span> Define dependencies</a></li>
<li><a class="" href="custom-templates-skeleton.html"><span class="header-section-number">18</span> Template skeleton</a></li>
<li><a class="" href="custom-templates-testing.html"><span class="header-section-number">19</span> Testing and validating templates elements</a></li>
<li><a class="" href="custom-templates-inputs.html"><span class="header-section-number">20</span> Develop custom input widgets</a></li>
<li><a class="" href="custom-templates-interactivity.html"><span class="header-section-number">21</span> Adding more interactivity</a></li>
<li class="book-part">Toward a better workflow</li>
<li><a class="" href="workflow-charpente.html"><span class="header-section-number">22</span> Introduction to {charpente}</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/DivadNojnarg/outstanding-shiny-ui">View book source</a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="custom-templates-dependencies" class="section level1">
<h1>
<span class="header-section-number">17</span> Define dependencies<a class="anchor" aria-label="anchor" href="#custom-templates-dependencies"><i class="fas fa-link"></i></a>
</h1>
<p>The Tabler template is a tiny Bootstrap 4 dashboard template. In this chapter, we will describe how to customize Tabler by providing an R wrapper. In this way, the underlying JavaScript code is left untouched yet we are able to incorporate greater functionality.</p>
<div id="discover-the-project" class="section level2">
<h2>
<span class="header-section-number">17.1</span> Discover the project<a class="anchor" aria-label="anchor" href="#discover-the-project"><i class="fas fa-link"></i></a>
</h2>
<p>The first step of any template adaptation consists of exploring the underlying Github repository (if open source) and look for mandatory elements, like CSS/JS dependencies. This is a similar strategy if you want to incorporate an htmlWidget as well.</p>
<div class="figure">
<span id="fig:tabler-github"></span>
<img src="images/practice/tabler-github.png" alt="Github project exploration" width="100%"><p class="caption">
FIGURE 17.1: Github project exploration
</p>
</div>
<p>As shown in Figure <a href="custom-templates-dependencies.html#fig:tabler-github">17.1</a>, the most important folders are:</p>
<ul>
<li>dist: contains CSS and JS files as well as other libraries like Bootstrap and jQuery. It is also a good moment to look at the version of each dependency that might conflict with Shiny</li>
<li>demo is the website folder used for demonstration purpose. This is our source to explore the template capabilities in depth</li>
</ul>
<p>The scss and build folder may be used to customize the tabler template directly. However as stated above, directions on how to do so are out of scope for this book.</p>
</div>
<div id="identify-mandatory-dependencies" class="section level2">
<h2>
<span class="header-section-number">17.2</span> Identify mandatory dependencies<a class="anchor" aria-label="anchor" href="#identify-mandatory-dependencies"><i class="fas fa-link"></i></a>
</h2>
<p>Bootstrap 4, jQuery, tabler.min.css and tabler.min.js are key elements for the template, contrary to flag icons which are optional (and take a lot of space). If your goal is to release your template on CRAN, be mindful of the 5 Mb maximum size limit. From personal experience, I can attest that this is quite challenging to manage.</p>
<p>To inspect dependencies, we proceed as follows</p>
<ul>
<li>Download or clone the Github repository</li>
<li>Go to the demo folder and open the layout-dark.html file</li>
<li>Open the HTML inspector</li>
</ul>
<p><img src="images/practice/tabler-deps-1.png" width="50%"><img src="images/practice/tabler-deps-2.png" width="50%"></p>
<p>As depicted in Figure <a href="#fig:tabler-deps"><strong>??</strong></a> left-hand side, we need to include the tabler.min.css from the header. If you are not convinced, try to remove it from the DOM and see what happens. <a href="https://www.10bestdesign.com/jqvmap/">jqvmap</a> is actually related to an external visualization plugin used in the demo. Finally the demo.min.css file is for the demo purpose. This will not prevent the template from working, so we will skip it for now. So far so good, we only need one file thus!</p>
<p>JavaScript dependencies are shown on the right-hand side and located at the end of the body tag. Because we will not need all chart-related dependencies like apexcharts, jquery.vmap and vmap world and may safely ignore them. We will keep the Bootstrap 4 bundle.js, jQuery core and tabler.min.js (the order is crucial).</p>
</div>
<div id="bundle-dependencies" class="section level2">
<h2>
<span class="header-section-number">17.3</span> Bundle dependencies<a class="anchor" aria-label="anchor" href="#bundle-dependencies"><i class="fas fa-link"></i></a>
</h2>
<p>With the help of the <code>htmltoolsDependency</code> function, we are going to create our main Tabler HTML dependency containing all assets to allow our template to render properly. In this example, I am going to cheat a bit: instead of handling local files, I will use a CDN (content delivery network) that hosts all necessary Tabler <a href="https://www.jsdelivr.com/package/npm/tabler">assets</a>. This avoids to include all the necessary files in the R package, as well as in a github repository.</p>
<div class="sourceCode" id="cb304"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tablers_deps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/htmlDependency.html">htmlDependency</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"tabler"</span>,
  version <span class="op">=</span> <span class="st">"1.0.7"</span>, <span class="co"># we take that of tabler,</span>
  src <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>href <span class="op">=</span> <span class="st">"https://cdn.jsdelivr.net/npm/tabler@1.0.0-alpha.7/dist/"</span><span class="op">)</span>,
  script <span class="op">=</span> <span class="st">"js/tabler.min.js"</span>,
  stylesheet <span class="op">=</span> <span class="st">"css/tabler.min.css"</span>
<span class="op">)</span></code></pre></div>
<p>I advise the reader to create one HTML dependency per element. The Bootstrap version is v4.3.1 (Shiny relies on 3.4.1) and jQuery is 3.5.0 (Shiny relies on 3.4.1). We can also use a CDN:</p>
<div class="sourceCode" id="cb305"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bs4_deps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/htmlDependency.html">htmlDependency</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"Bootstrap"</span>,
  version <span class="op">=</span> <span class="st">"4.3.1"</span>,
  src <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>href <span class="op">=</span> <span class="st">"https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/"</span><span class="op">)</span>,
  script <span class="op">=</span> <span class="st">"bootstrap.bundle.min.js"</span>
<span class="op">)</span>

<span class="va">jQuery_deps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/htmlDependency.html">htmlDependency</a></span><span class="op">(</span>
  name <span class="op">=</span> <span class="st">"jquery"</span>,
  version <span class="op">=</span> <span class="st">"3.5.0"</span>,
  src <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>href <span class="op">=</span> <span class="st">"https://code.jquery.com/"</span><span class="op">)</span>,
  script <span class="op">=</span> <span class="st">"jquery-3.5.0.slim.min.js"</span>
<span class="op">)</span></code></pre></div>
<p>We finally create our dependency manager:</p>
<div class="sourceCode" id="cb306"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># add all dependencies to a tag. Don't forget to set append to TRUE to preserve any existing dependency</span>
<span class="va">add_tabler_deps</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tag</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># below, the order is of critical importance!</span>
  <span class="va">deps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">bs4_deps</span>, <span class="va">tablers_deps</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/htmlDependencies.html">attachDependencies</a></span><span class="op">(</span><span class="va">tag</span>, <span class="va">deps</span>, append <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Notice the dependencies order in the <code>deps</code> list: this will be exactly the same order in the <code>head</code> of the HTML page. Some libraries require to be loaded at a specific place, like the Tabler dependencies which must come after Bootstrap.
It is not surprising since Tabler is built on top of Bootstrap 4.</p>
<p>Let’s see how to use <code>add_tabler_deps</code>. We consider a <code>&lt;div&gt;</code> placeholder and check for its dependencies with <code>findDependencies</code> (should be NULL). Then, we wrap it with <code>add_tabler_deps</code>.</p>
<div class="sourceCode" id="cb307"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/findDependencies.html">findDependencies</a></span><span class="op">(</span><span class="va">tag</span><span class="op">)</span></code></pre></div>
<pre><code>## NULL</code></pre>
<div class="sourceCode" id="cb309"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tag</span> <span class="op">&lt;-</span> <span class="fu">add_tabler_deps</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">div</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/findDependencies.html">findDependencies</a></span><span class="op">(</span><span class="va">tag</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
## List of 10
##  $ name      : chr "Bootstrap"
##  $ version   : chr "4.3.1"
##  $ src       :List of 1
##   ..$ href: chr "https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/"
##  $ meta      : NULL
##  $ script    : chr "bootstrap.bundle.min.js"
##  $ stylesheet: NULL
##  $ head      : NULL
##  $ attachment: NULL
##  $ package   : NULL
##  $ all_files : logi TRUE
##  - attr(*, "class")= chr "html_dependency"
## 
## [[2]]
## List of 10
##  $ name      : chr "tabler"
##  $ version   : chr "1.0.7"
##  $ src       :List of 1
##   ..$ href: chr "https://cdn.jsdelivr.net/npm/tabler@1.0.0-alpha.7/dist/"
##  $ meta      : NULL
##  $ script    : chr "js/tabler.min.js"
##  $ stylesheet: chr "css/tabler.min.css"
##  $ head      : NULL
##  $ attachment: NULL
##  $ package   : NULL
##  $ all_files : logi TRUE
##  - attr(*, "class")= chr "html_dependency"</code></pre>
<p>As shown above, our dependencies are applied to the div, in the correct order. This order is set by the list <code><a href="https://rdrr.io/r/base/list.html">list(bs4_deps, jQuery_deps, tablers_deps)</a></code> and allows use to avoid potential conflicts. If we try to run this simple tag in a shiny app, we notice that all dependencies are added to the <code>&lt;head&gt;</code> tag, whereas the original template loads JavaScript dependencies in the <code>&lt;body&gt;</code>. Unfortunately, htmltools does not allow developers to distribute dependencies in different places. Here there is no impact but for other templates like <a href="https://framework7.io">Framework7</a> (which is powering <a href="https://github.com/RinteRface/shinyMobile">shinyMobile</a>), JavaScript must be place in the body. In practice, this is challenging to guess and may only be solved by manual testing.</p>
<div class="sourceCode" id="cb311"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span><span class="va">tag</span><span class="op">)</span>
<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span><span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<p>Even though the <code>add_tabler_deps</code> function may be applied to any tag, we will use it with the core HTML template, that remain to be designed!</p>
<p>Would you like to see if our dependency system works? Let’s meet in the next chapter to design the main dashboard layout.</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="custom-templates-selection.html"><span class="header-section-number">16</span> Template selection</a></div>
<div class="next"><a href="custom-templates-skeleton.html"><span class="header-section-number">18</span> Template skeleton</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#custom-templates-dependencies"><span class="header-section-number">17</span> Define dependencies</a></li>
<li><a class="nav-link" href="#discover-the-project"><span class="header-section-number">17.1</span> Discover the project</a></li>
<li><a class="nav-link" href="#identify-mandatory-dependencies"><span class="header-section-number">17.2</span> Identify mandatory dependencies</a></li>
<li><a class="nav-link" href="#bundle-dependencies"><span class="header-section-number">17.3</span> Bundle dependencies</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/DivadNojnarg/outstanding-shiny-ui/blob/master/custom-templates-dependencies.Rmd">View source</a></li>
          <li><a id="book-edit" href="https://github.com/DivadNojnarg/outstanding-shiny-ui/edit/master/custom-templates-dependencies.Rmd">Edit this page</a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Outstanding User Interfaces with Shiny</strong>" was written by David Granjon. It waslast built on 2020-11-04.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This website is produced by the <a class="text-light" href="https://bookdown.org">bookdown</a> bs4_book template.</p>
  </div>

</div></div>
</footer>
</body>
</html>
