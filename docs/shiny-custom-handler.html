<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 15 Custom handlers: from R to JavaScript | Outstanding User Interfaces with Shiny</title>
<meta name="author" content="David Granjon">
<!-- CSS --><link rel="stylesheet" href="css/style.css">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.2/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.2/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.1.9000/tabs.js"></script><script src="libs/bs3compat-0.2.1.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Outstanding User Interfaces with Shiny</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li class="book-part">Introduction</li>
<li><a class="" href="web-intro.html"><span class="header-section-number">1</span> Shiny and the Web</a></li>
<li><a class="" href="web-dependencies.html"><span class="header-section-number">2</span> Discover Shiny dependencies</a></li>
<li class="book-part">Unleash {htmltools}: from R to HTML</li>
<li><a class="" href="htmltools-overview.html"><span class="header-section-number">3</span> htmltools overview</a></li>
<li><a class="" href="htmltools-dependencies.html"><span class="header-section-number">4</span> Dependency utilities</a></li>
<li class="book-part">Beautify with CSS and SASS</li>
<li><a class="" href="beautify-css.html"><span class="header-section-number">5</span> Introduction to CSS</a></li>
<li><a class="" href="beautify-sass.html"><span class="header-section-number">6</span> Introduction to SASS</a></li>
<li><a class="" href="beautify-with-fresh.html"><span class="header-section-number">7</span> Beautify with fresh</a></li>
<li><a class="" href="beautify-with-bootstraplib.html"><span class="header-section-number">8</span> Beautify with bootstraplib</a></li>
<li><a class="" href="beautify-other-tools.html"><span class="header-section-number">9</span> Other tools</a></li>
<li class="book-part">Deep dive in the Shiny input system</li>
<li><a class="" href="survival-kit-javascript.html"><span class="header-section-number">10</span> JavaScript for Shiny</a></li>
<li><a class="" href="shiny-intro.html"><span class="header-section-number">11</span> Shiny’s internal: session and websockets</a></li>
<li><a class="" href="shiny-input-system.html"><span class="header-section-number">12</span> Shiny’s input system</a></li>
<li><a class="" href="shiny-input-lifecycle.html"><span class="header-section-number">13</span> Shiny inputs lifecycles</a></li>
<li><a class="" href="shiny-input-gems.html"><span class="header-section-number">14</span> Hidden gems about inputs</a></li>
<li><a class="active" href="shiny-custom-handler.html"><span class="header-section-number">15</span> Custom handlers: from R to JavaScript</a></li>
<li class="book-part">Practice 1: a dashboard template</li>
<li><a class="" href="custom-templates-selection.html"><span class="header-section-number">16</span> Template selection</a></li>
<li><a class="" href="custom-templates-dependencies.html"><span class="header-section-number">17</span> Define dependencies</a></li>
<li><a class="" href="custom-templates-skeleton.html"><span class="header-section-number">18</span> Template skeleton</a></li>
<li><a class="" href="custom-templates-testing.html"><span class="header-section-number">19</span> Testing and validating templates elements</a></li>
<li><a class="" href="custom-templates-inputs.html"><span class="header-section-number">20</span> Develop custom input widgets</a></li>
<li><a class="" href="custom-templates-interactivity.html"><span class="header-section-number">21</span> Adding more interactivity</a></li>
<li class="book-part">Toward a better workflow</li>
<li><a class="" href="workflow-charpente.html"><span class="header-section-number">22</span> Introduction to {charpente}</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/DivadNojnarg/outstanding-shiny-ui">View book source</a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="shiny-custom-handler" class="section level1">
<h1>
<span class="header-section-number">15</span> Custom handlers: from R to JavaScript<a class="anchor" aria-label="anchor" href="#shiny-custom-handler"><i class="fas fa-link"></i></a>
</h1>
<div id="introduction-3" class="section level2">
<h2>
<span class="header-section-number">15.1</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction-3"><i class="fas fa-link"></i></a>
</h2>
<p>Shiny provides tools to ease the communication between R and JavaScript, as illustrated in section <a href="shiny-intro.html#shiny-websocket">11.1</a>. How does R send messages to JavaScript?</p>
<p>We already discussed the usage of <code>sendInputMessage()</code> in the input binding section <a href="shiny-input-system.html#shiny-input-system">12</a>. The other important method is <code>sendCustomMessage(type, message)</code>. It works by pair with the JS method <code>Shiny.AddCustomMessageHandler</code>, linked with the type parameter.</p>
<div class="sourceCode" id="cb300"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">say_hello_to_js</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">text</span>, <span class="va">session</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/domains.html">getDefaultReactiveDomain</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">session</span><span class="op">$</span><span class="fu">sendCustomMessage</span><span class="op">(</span>type <span class="op">=</span> <span class="st">'say-hello'</span>, message <span class="op">=</span> <span class="va">text</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>The JavaScript receptor is defined below:</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb301-1"><a href="shiny-custom-handler.html#cb301-1"></a><span class="at">$</span>(<span class="kw">function</span>() <span class="op">{</span></span>
<span id="cb301-2"><a href="shiny-custom-handler.html#cb301-2"></a>  <span class="va">Shiny</span>.<span class="at">AddCustomMessageHandler</span>(<span class="st">'say-hello'</span><span class="op">,</span> <span class="kw">function</span>(message) <span class="op">{</span></span>
<span id="cb301-3"><a href="shiny-custom-handler.html#cb301-3"></a>    <span class="at">alert</span>(<span class="vs">`R says </span><span class="sc">${</span>message<span class="sc">}</span><span class="vs"> to you!`</span>)</span>
<span id="cb301-4"><a href="shiny-custom-handler.html#cb301-4"></a>  <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb301-5"><a href="shiny-custom-handler.html#cb301-5"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>The shiny app below will simply print a welcome message every 5 seconds. We obviously set <code><a href="https://rdrr.io/r/base/options.html">options(shiny.trace = TRUE)</a></code>. Figure <a href="shiny-custom-handler.html#fig:shiny-custom-message">15.1</a> summarizes the main mechanisms involved in the R to JS communication. The corresponding code may be found <a href="https://github.com/DivadNojnarg/outstanding-shiny-ui-code/blob/master/R/say_hello.R">here</a>.</p>
<div class="sourceCode" id="cb302"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyAppDir</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"chapter6/say_hello"</span>, package <span class="op">=</span> <span class="st">"OSUICode"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>You will find a whole chapter dedicated to custom handlers here <a href="custom-templates-interactivity.html#custom-templates-interactivity">21</a>.</p>
<div class="figure">
<span id="fig:shiny-custom-message"></span>
<img src="images/survival-kit/shiny-custom-message.png" alt="From R to JavaScript" width="100%"><p class="caption">
FIGURE 15.1: From R to JavaScript
</p>
</div>
<p>Combining <code>Shiny.setInputValue</code>, <code>Shiny.addCustomMessageHandler</code>, here is a fun example
that sets the body background as a result of a simple button click.
We defined 3 JS pieces:</p>
<ul>
<li>
<code>getPokemon</code> whose script is adapted from Colin Fay et al. (see <a href="https://engineering-shiny.org/optimjs.html">here</a>). This function fetch the <a href="https://pokeapi.co/">pokeapi</a>
data and if successful set an input value, which will be available on the R side</li>
<li>An event listener is set to the only button of the page so that each time we click,
we call <code>getPokemon</code> to select a random background image</li>
<li>
<code>input$pokeData</code> is actually a quite complex list (deeply nested JSON) and some manipulation is done from R in the <code>observeEvent</code> block. Once done, we send the data
back to JS through the websocket (the session object sends a message).</li>
<li>On the JS side, the last block is a custom message handler that will add some inline
CSS properties to the body element</li>
</ul>
<div class="sourceCode" id="cb303"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://shiny.rstudio.com">shiny</a></span><span class="op">)</span>

<span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span>
  <span class="va">tags</span><span class="op">$</span><span class="fu">script</span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/HTML.html">HTML</a></span><span class="op">(</span>
      <span class="st">[1165 chars quoted with '"']</span>
    <span class="op">)</span>
  <span class="op">)</span>,
  <span class="va">tags</span><span class="op">$</span><span class="fu">button</span><span class="op">(</span>id <span class="op">=</span> <span class="st">"button"</span>, <span class="st">"Go!"</span>, class <span class="op">=</span> <span class="st">"btn-success"</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">pokeData</span>, <span class="op">{</span>
    <span class="va">background</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">$</span><span class="va">pokeData</span><span class="op">$</span><span class="va">sprites</span><span class="op">$</span><span class="va">other</span><span class="op">$</span><span class="va">`official-artwork`</span><span class="op">$</span><span class="va">front_default</span>
    <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="va">background</span><span class="op">)</span>
    <span class="va">session</span><span class="op">$</span><span class="fu">sendCustomMessage</span><span class="op">(</span>type <span class="op">=</span> <span class="st">"update_background"</span>, message <span class="op">=</span> <span class="va">background</span><span class="op">)</span>
  <span class="op">}</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
</div>
<div id="dynamically-manage-content" class="section level2">
<h2>
<span class="header-section-number">15.2</span> Dynamically manage content<a class="anchor" aria-label="anchor" href="#dynamically-manage-content"><i class="fas fa-link"></i></a>
</h2>
<p>As shown in the Mastering Shiny <a href="https://mastering-shiny.org/action-dynamic.html">book</a>, there exists tools to update UI components from the server. You can use all <code>update&lt;INPUT_NAME&gt;</code> functions like <code>updateTextInput</code> but also what I call secondary input related function like <code>updateTabsetPanel</code>. Why secondary input? Since they are not necessary to perform computations. For instance when you fill a inscription form on a website, it contains a lot of input like select, text, numeric, date. Your data is ultimately stored in a database for later use (login, …). A <code>tabsetPanel</code> is a simple way to dispatch multiple elements on different panels and usually gather them by topic. In Shiny, it is always interesting to associate an input to it, as shown in the previous chapter <a href="shiny-input-system.html#secondary-inputs">12.2</a>, so as to be able to trigger sophisticated actions on the server side, whenever necessary.
Other tools to manage your UI consist in <code>toggle</code> functions like <code>hideTab</code>, <code>showTab</code>, the limit being the very few number, which often oblige use to use packages like <code>shinyjs</code> <span class="citation">(<span class="citeproc-not-found" data-reference-id="R-shinyjs"><strong>???</strong></span>)</span> or write custom JavaScript code.
<code>insertUI/removeUI</code> allows to dynamically insert or remove any element any where. Finally, one may know the <code>renderUI/uiOutput</code> that allows to render any HTML block from the server. While the <code>update&lt;INPUT_NAME&gt;</code> and <code>toggle</code> tools are component specific, meaning they in principle only target the element to modify, <code>renderUI/uiOutput</code> re-renders the whole block each time an associated reactive dependency is invalidated, even though only a little part should be re-rendered.</p>
<div id="issues-with-renderui" class="section level3">
<h3>
<span class="header-section-number">15.2.1</span> Issues with renderUI<a class="anchor" aria-label="anchor" href="#issues-with-renderui"><i class="fas fa-link"></i></a>
</h3>
<p>Below is an very naive and dirty example where <code>renderUI</code> makes the entire dropdown menu re-render each time something changes in the <code>renderUI</code> expression, which may not be optimal. For instance in React, we only re-render what needs to be <a href="https://en.reactjs.org/docs/rendering-elements.html#react-only-updates-whats-necessary">updated</a>! Run the app below, open the HTML inspector and click to add 1 message. Notice that the entire block is updated, whereas only the corresponding HTML element should. Advanced user will immediately see a place for <code>insertUI</code>.</p>
<div class="sourceCode" id="cb304"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rinterface.github.io/bs4Dash/index.html">bs4Dash</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/">tibble</a></span><span class="op">)</span>

<span class="va">new_message</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tibble/man/tibble.html">tibble</a></span><span class="op">(</span>
  message <span class="op">=</span> <span class="st">"New message"</span>,
  from <span class="op">=</span> <span class="st">"Paul"</span>,
  src <span class="op">=</span> <span class="st">"https://adminlte.io/themes/v3/dist/img/user3-128x128.jpg"</span>,
  time <span class="op">=</span> <span class="st">"yesterday"</span>,
  status <span class="op">=</span> <span class="st">"success"</span>,
  type <span class="op">=</span> <span class="st">"message"</span>
<span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span>
  ui <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/bs4Dash/man/bs4DashPage.html">bs4DashPage</a></span><span class="op">(</span>
    navbar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/bs4Dash/man/bs4DashNavbar.html">bs4DashNavbar</a></span><span class="op">(</span>
      rightUi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/htmlOutput.html">uiOutput</a></span><span class="op">(</span><span class="st">"messages"</span>, container <span class="op">=</span> <span class="va">tags</span><span class="op">$</span><span class="va">li</span><span class="op">)</span>
    <span class="op">)</span>,
    sidebar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/bs4Dash/man/bs4DashSidebar.html">bs4DashSidebar</a></span><span class="op">(</span><span class="op">)</span>,
    controlbar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/bs4Dash/man/bs4DashControlbar.html">bs4DashControlbar</a></span><span class="op">(</span><span class="op">)</span>,
    footer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/bs4Dash/man/bs4DashFooter.html">bs4DashFooter</a></span><span class="op">(</span><span class="op">)</span>,
    title <span class="op">=</span> <span class="st">"test"</span>,
    body <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/bs4Dash/man/bs4DashBody.html">bs4DashBody</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/actionButton.html">actionButton</a></span><span class="op">(</span><span class="st">"add"</span>, <span class="st">"Add message"</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span>,
  server <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span>
    
    <span class="va">messages</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactiveValues.html">reactiveValues</a></span><span class="op">(</span>
      items <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/tibble/man/tibble.html">tibble</a></span><span class="op">(</span>
        message <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"A message"</span>, <span class="fl">10</span><span class="op">)</span>,
        from <span class="op">=</span> <span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>,
        src <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"https://adminlte.io/themes/v3/dist/img/user3-128x128.jpg"</span>, <span class="fl">10</span><span class="op">)</span>,
        time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"yesterday"</span>, <span class="fl">10</span><span class="op">)</span>,
        status <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"success"</span>, <span class="fl">10</span><span class="op">)</span>,
        type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"message"</span>, <span class="fl">10</span><span class="op">)</span>
      <span class="op">)</span>
    <span class="op">)</span>
    
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">add</span>, <span class="op">{</span>
      <span class="va">messages</span><span class="op">$</span><span class="va">items</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tibble/man/add_row.html">add_row</a></span><span class="op">(</span><span class="va">messages</span><span class="op">$</span><span class="va">items</span>, <span class="va">new_message</span><span class="op">)</span>
    <span class="op">}</span><span class="op">)</span>
    
    <span class="va">output</span><span class="op">$</span><span class="va">messages</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderUI.html">renderUI</a></span><span class="op">(</span><span class="op">{</span>
      <span class="fu"><a href="https://rdrr.io/pkg/bs4Dash/man/bs4DropdownMenu.html">dropdownMenu</a></span><span class="op">(</span>
        show <span class="op">=</span> <span class="cn">FALSE</span>,
        status <span class="op">=</span> <span class="st">"danger"</span>,
        src <span class="op">=</span> <span class="st">"https://www.google.fr"</span>,
        <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">messages</span><span class="op">$</span><span class="va">items</span><span class="op">)</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">r</span><span class="op">)</span> <span class="op">{</span>
          <span class="va">temp</span> <span class="op">&lt;-</span> <span class="va">messages</span><span class="op">$</span><span class="va">items</span><span class="op">[</span><span class="va">r</span>, <span class="op">]</span>
          <span class="fu"><a href="https://rdrr.io/pkg/bs4Dash/man/bs4DropdownMenuItem.html">dropdownMenuItem</a></span><span class="op">(</span>
            message <span class="op">=</span> <span class="va">temp</span><span class="op">$</span><span class="va">message</span>,
            from <span class="op">=</span> <span class="va">temp</span><span class="op">$</span><span class="va">from</span>, 
            time <span class="op">=</span> <span class="va">temp</span><span class="op">$</span><span class="va">time</span>,
            status <span class="op">=</span> <span class="va">temp</span><span class="op">$</span><span class="va">status</span>,
            type <span class="op">=</span> <span class="va">temp</span><span class="op">$</span><span class="va">type</span>,
            src <span class="op">=</span> <span class="va">temp</span><span class="op">$</span><span class="va">src</span>
          <span class="op">)</span>
        <span class="op">}</span><span class="op">)</span>
      <span class="op">)</span>
    <span class="op">}</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">)</span></code></pre></div>
<div class="figure">
<span id="fig:render-ui-1"></span>
<img src="images/survival-kit/render-ui-1.png" alt="renderUI is not specific" width="100%"><p class="caption">
FIGURE 15.2: renderUI is not specific
</p>
</div>
<p>The problem is illustrated Figure <a href="shiny-custom-handler.html#fig:render-ui-1">15.2</a>, where the entire block is re-rendered. That’s why you should avoid this method as much as possible, as it will overload the server. In the following, we’ll leverage custom handlers to solve this problem. Overall, it’s more work, maybe more complex but ensures to be specific and more optimized.</p>
</div>
<div id="insertui" class="section level3">
<h3>
<span class="header-section-number">15.2.2</span> insertUI<a class="anchor" aria-label="anchor" href="#insertui"><i class="fas fa-link"></i></a>
</h3>
<p>Why don’t we just go for <code>insertUI</code>? Let’s try below:</p>
<div class="sourceCode" id="cb305"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span>
  ui <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/bs4Dash/man/bs4DashPage.html">bs4DashPage</a></span><span class="op">(</span>
    navbar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/bs4Dash/man/bs4DashNavbar.html">bs4DashNavbar</a></span><span class="op">(</span>
      rightUi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/bs4Dash/man/bs4DropdownMenu.html">dropdownMenu</a></span><span class="op">(</span>
        show <span class="op">=</span> <span class="cn">FALSE</span>,
        status <span class="op">=</span> <span class="st">"danger"</span>,
        src <span class="op">=</span> <span class="st">"https://www.google.fr"</span>
      <span class="op">)</span>
    <span class="op">)</span>,
    sidebar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/bs4Dash/man/bs4DashSidebar.html">bs4DashSidebar</a></span><span class="op">(</span><span class="op">)</span>,
    controlbar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/bs4Dash/man/bs4DashControlbar.html">bs4DashControlbar</a></span><span class="op">(</span><span class="op">)</span>,
    footer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/bs4Dash/man/bs4DashFooter.html">bs4DashFooter</a></span><span class="op">(</span><span class="op">)</span>,
    title <span class="op">=</span> <span class="st">"test"</span>,
    body <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/bs4Dash/man/bs4DashBody.html">bs4DashBody</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/actionButton.html">actionButton</a></span><span class="op">(</span><span class="st">"add"</span>, <span class="st">"Add dropdown item"</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span>,
  server <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span>
    
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">add</span>, <span class="op">{</span>
      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/insertUI.html">insertUI</a></span><span class="op">(</span>
        selector <span class="op">=</span> <span class="st">".dropdown-menu &gt; .dropdown-item.dropdown-footer"</span>,
        where <span class="op">=</span> <span class="st">"beforeBegin"</span>,
        ui <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/bs4Dash/man/bs4DropdownMenuItem.html">dropdownMenuItem</a></span><span class="op">(</span>
          inputId <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"triggerAction_"</span>, <span class="va">input</span><span class="op">$</span><span class="va">add</span><span class="op">)</span>,
          message <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"message"</span>, <span class="va">input</span><span class="op">$</span><span class="va">add</span><span class="op">)</span>,
          from <span class="op">=</span> <span class="st">"Divad Nojnarg"</span>,
          src <span class="op">=</span> <span class="st">"https://adminlte.io/themes/v3/dist/img/user3-128x128.jpg"</span>,
          time <span class="op">=</span> <span class="st">"today"</span>,
          status <span class="op">=</span> <span class="st">"danger"</span>,
          type <span class="op">=</span> <span class="st">"message"</span>
        <span class="op">)</span>
      <span class="op">)</span>
    <span class="op">}</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">)</span></code></pre></div>
<p>Well, if the item is inserted, the item counter as well as the dropdown text are not, as depicted Figure <a href="shiny-custom-handler.html#fig:insertUI-1">15.3</a>! We can’t blame <code>insertUI</code> for this, since this is the fault of the <a href="https://rinterface.github.io/bs4Dash/index.html">bs4Dash</a> component that actually has interconnected HTML pieces.</p>
<div class="figure">
<span id="fig:insertUI-1"></span>
<img src="images/survival-kit/insertUI-1.png" alt="insertUI is not enough specific" width="100%"><p class="caption">
FIGURE 15.3: insertUI is not enough specific
</p>
</div>
<p>We may fix that by adding extra <code><a href="https://rdrr.io/pkg/shiny/man/insertUI.html">insertUI()</a></code> and <code><a href="https://rdrr.io/pkg/shiny/man/insertUI.html">removeUI()</a></code> to replace those parts (<code><a href="https://rdrr.io/pkg/shiny/man/insertUI.html">insertUI()</a></code> does not update the targeted item). Moreover, you we must set correct priority to each <code>observeEvent</code> (try to remove them, it will fail) to ensure that <em>remove</em> happens before <em>insert</em>.</p>
<div class="sourceCode" id="cb306"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span>
  ui <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/bs4Dash/man/bs4DashPage.html">bs4DashPage</a></span><span class="op">(</span>
    navbar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/bs4Dash/man/bs4DashNavbar.html">bs4DashNavbar</a></span><span class="op">(</span>
      rightUi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/bs4Dash/man/bs4DropdownMenu.html">dropdownMenu</a></span><span class="op">(</span>
        show <span class="op">=</span> <span class="cn">FALSE</span>,
        status <span class="op">=</span> <span class="st">"danger"</span>,
        src <span class="op">=</span> <span class="st">"https://www.google.fr"</span>
      <span class="op">)</span>
    <span class="op">)</span>,
    sidebar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/bs4Dash/man/bs4DashSidebar.html">bs4DashSidebar</a></span><span class="op">(</span><span class="op">)</span>,
    controlbar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/bs4Dash/man/bs4DashControlbar.html">bs4DashControlbar</a></span><span class="op">(</span><span class="op">)</span>,
    footer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/bs4Dash/man/bs4DashFooter.html">bs4DashFooter</a></span><span class="op">(</span><span class="op">)</span>,
    title <span class="op">=</span> <span class="st">"test"</span>,
    body <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/bs4Dash/man/bs4DashBody.html">bs4DashBody</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/actionButton.html">actionButton</a></span><span class="op">(</span><span class="st">"add"</span>, <span class="st">"Add dropdown item"</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span>,
  server <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span>
    
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">add</span>, <span class="op">{</span>
      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/insertUI.html">insertUI</a></span><span class="op">(</span>
        selector <span class="op">=</span> <span class="st">".dropdown-menu &gt; .dropdown-item.dropdown-footer"</span>,
        where <span class="op">=</span> <span class="st">"beforeBegin"</span>,
        ui <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/bs4Dash/man/bs4DropdownMenuItem.html">dropdownMenuItem</a></span><span class="op">(</span>
          inputId <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"triggerAction_"</span>, <span class="va">input</span><span class="op">$</span><span class="va">add</span><span class="op">)</span>,
          message <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"message"</span>, <span class="va">input</span><span class="op">$</span><span class="va">add</span><span class="op">)</span>,
          from <span class="op">=</span> <span class="st">"Divad Nojnarg"</span>,
          src <span class="op">=</span> <span class="st">"https://adminlte.io/themes/v3/dist/img/user3-128x128.jpg"</span>,
          time <span class="op">=</span> <span class="st">"today"</span>,
          status <span class="op">=</span> <span class="st">"danger"</span>,
          type <span class="op">=</span> <span class="st">"message"</span>
        <span class="op">)</span>
      <span class="op">)</span>
    <span class="op">}</span><span class="op">)</span>
    
    <span class="co"># remove old badge</span>
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">add</span>, <span class="op">{</span>
      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/insertUI.html">removeUI</a></span><span class="op">(</span>selector <span class="op">=</span> <span class="st">".badge-danger.navbar-badge"</span><span class="op">)</span>
    <span class="op">}</span>, priority <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
    
    <span class="co"># insert new badge</span>
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">add</span>, <span class="op">{</span>
      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/insertUI.html">insertUI</a></span><span class="op">(</span>
        selector <span class="op">=</span> <span class="st">"[data-toggle=\"dropdown\"]"</span>,
        where <span class="op">=</span> <span class="st">"beforeEnd"</span>,
        ui <span class="op">=</span> <span class="va">tags</span><span class="op">$</span><span class="fu">span</span><span class="op">(</span>class <span class="op">=</span> <span class="st">"badge badge-danger navbar-badge"</span>, <span class="va">input</span><span class="op">$</span><span class="va">add</span><span class="op">)</span>
      <span class="op">)</span>
    <span class="op">}</span><span class="op">)</span>
    
    
    <span class="co"># remove old text counter</span>
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">add</span>, <span class="op">{</span>
      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/insertUI.html">removeUI</a></span><span class="op">(</span>selector <span class="op">=</span> <span class="st">".dropdown-item.dropdown-header"</span><span class="op">)</span>
    <span class="op">}</span>, priority <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
    
    <span class="co"># insert new text counter</span>
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">add</span>, <span class="op">{</span>
      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/insertUI.html">insertUI</a></span><span class="op">(</span>
        selector <span class="op">=</span> <span class="st">".dropdown-menu"</span>,
        where <span class="op">=</span> <span class="st">"afterBegin"</span>,
        ui <span class="op">=</span> <span class="va">tags</span><span class="op">$</span><span class="fu">span</span><span class="op">(</span>class<span class="op">=</span><span class="st">"dropdown-item dropdown-header"</span>, <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"%s Items"</span>, <span class="va">input</span><span class="op">$</span><span class="va">add</span><span class="op">)</span><span class="op">)</span>
      <span class="op">)</span>
    <span class="op">}</span><span class="op">)</span>
    
  <span class="op">}</span>
<span class="op">)</span></code></pre></div>
<p>So many <code>observeEvent</code> for a simple action! Imagine if we had 10 similar tasks… Isn’t there a way to do all of this at once, thereby reducing the server code? In general setting priorities in <code>observeEvent</code> is a rather bad smell of poorly designed shiny app.</p>
<p>Under the hood, <code>insertUI</code> sends a custom <a href="https://github.com/rstudio/shiny/blob/master/R/shiny.R#L1696">message</a> through <code>session$sendInsertUI</code>, viathe websocket:</p>
<div class="sourceCode" id="cb307"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sendInsertUI</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">selector</span>, <span class="va">multiple</span>, <span class="va">where</span>, <span class="va">content</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">private</span><span class="op">$</span><span class="fu">sendMessage</span><span class="op">(</span>
    `shiny-insert-ui` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
      selector <span class="op">=</span> <span class="va">selector</span>,
      multiple <span class="op">=</span> <span class="va">multiple</span>,
      where <span class="op">=</span> <span class="va">where</span>,
      content <span class="op">=</span> <span class="va">content</span>
    <span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Importantly, the content has been treated with <code>shiny:::processDeps</code> that:</p>
<ul>
<li>
<li>Find and resolve any HTML dependency</li>
<li>For each dependency, make sure the corresponding files can be accessed on the server with <code>createWebDependency</code> and <code>addResourcePath</code>.</li>
<li>Returns a list of the HTML element and dependencies. The HTML will be accessed by <code>message.content.html</code> and dependencies by <code>message.content.deps</code>.</li>
</ul>
<p>On the UI side, Shiny has a predefined message <a href="https://github.com/rstudio/shiny/blob/master/srcjs/shinyapp.js#L670">handler</a>:</p>
<div class="sourceCode" id="cb308"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb308-1"><a href="shiny-custom-handler.html#cb308-1"></a><span class="at">addMessageHandler</span>(<span class="st">'shiny-insert-ui'</span><span class="op">,</span> <span class="kw">function</span>(message) <span class="op">{</span></span>
<span id="cb308-2"><a href="shiny-custom-handler.html#cb308-2"></a>  <span class="kw">var</span> targets <span class="op">=</span> <span class="at">$</span>(<span class="va">message</span>.<span class="at">selector</span>)<span class="op">;</span></span>
<span id="cb308-3"><a href="shiny-custom-handler.html#cb308-3"></a>  <span class="cf">if</span> (<span class="va">targets</span>.<span class="at">length</span> <span class="op">===</span> <span class="dv">0</span>) <span class="op">{</span></span>
<span id="cb308-4"><a href="shiny-custom-handler.html#cb308-4"></a>    <span class="co">// render the HTML and deps to a null target, so</span></span>
<span id="cb308-5"><a href="shiny-custom-handler.html#cb308-5"></a>    <span class="co">// the side-effect of rendering the deps, singletons,</span></span>
<span id="cb308-6"><a href="shiny-custom-handler.html#cb308-6"></a>    <span class="co">// and &lt;head&gt; still occur</span></span>
<span id="cb308-7"><a href="shiny-custom-handler.html#cb308-7"></a>    <span class="va">console</span>.<span class="at">warn</span>(<span class="st">'The selector you chose ("'</span> <span class="op">+</span> <span class="va">message</span>.<span class="at">selector</span> <span class="op">+</span></span>
<span id="cb308-8"><a href="shiny-custom-handler.html#cb308-8"></a>                 <span class="st">'") could not be found in the DOM.'</span>)<span class="op">;</span></span>
<span id="cb308-9"><a href="shiny-custom-handler.html#cb308-9"></a>    <span class="va">exports</span>.<span class="at">renderHtml</span>(<span class="va">message</span>.<span class="va">content</span>.<span class="at">html</span><span class="op">,</span> <span class="at">$</span>([])<span class="op">,</span> <span class="va">message</span>.<span class="va">content</span>.<span class="at">deps</span>)<span class="op">;</span></span>
<span id="cb308-10"><a href="shiny-custom-handler.html#cb308-10"></a>  <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb308-11"><a href="shiny-custom-handler.html#cb308-11"></a>    <span class="va">targets</span>.<span class="at">each</span>(<span class="kw">function</span> (i<span class="op">,</span> target) <span class="op">{</span></span>
<span id="cb308-12"><a href="shiny-custom-handler.html#cb308-12"></a>      <span class="va">exports</span>.<span class="at">renderContent</span>(target<span class="op">,</span> <span class="va">message</span>.<span class="at">content</span><span class="op">,</span> <span class="va">message</span>.<span class="at">where</span>)<span class="op">;</span></span>
<span id="cb308-13"><a href="shiny-custom-handler.html#cb308-13"></a>      <span class="cf">return</span> <span class="va">message</span>.<span class="at">multiple</span><span class="op">;</span></span>
<span id="cb308-14"><a href="shiny-custom-handler.html#cb308-14"></a>    <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb308-15"><a href="shiny-custom-handler.html#cb308-15"></a>  <span class="op">}</span></span>
<span id="cb308-16"><a href="shiny-custom-handler.html#cb308-16"></a><span class="op">}</span>)</span></code></pre></div>
<p>It checks whether the provided selector corresponds to multiple DOM elements. If at least 1 item is found, it calls <code>renderContent(html, el, dependencies)</code> that triggers <code>renderHtml(html, el, dependencies)</code>:</p>
<ul>
<li>Processes the provided HTML (treat the head, body and singletons).</li>
<li>Renders all given dependencies into the page’s <a href="https://github.com/rstudio/shiny/blob/master/srcjs/output_binding_html.js#L241">head</a>.</li>
<li>Insert the HTML into the page at the position provided in the <code>insertUI</code> <strong>where</strong> parameter. Internally this calls the <code>insertAdjacentHTML</code> method.</li>
<li>Initialize any input and bind them to the scope and send the value to the server so that output/observers are invalidated. Outputs are also bound. If this step is missed the newly inserted input won’t react, so is the related output and any observer.</li>
</ul>
</div>
</div>
<div id="toward-custom-ui-management-functions" class="section level2">
<h2>
<span class="header-section-number">15.3</span> Toward custom UI management functions<a class="anchor" aria-label="anchor" href="#toward-custom-ui-management-functions"><i class="fas fa-link"></i></a>
</h2>
<div id="html-with-extra-dependencies" class="section level3">
<h3>
<span class="header-section-number">15.3.1</span> HTML with extra dependencies<a class="anchor" aria-label="anchor" href="#html-with-extra-dependencies"><i class="fas fa-link"></i></a>
</h3>
<p>TO DO: talk about <code>Shiny.renderHtml</code>, <code>Shiny.renderContent</code></p>
</div>
<div id="example-2" class="section level3">
<h3>
<span class="header-section-number">15.3.2</span> Example<a class="anchor" aria-label="anchor" href="#example-2"><i class="fas fa-link"></i></a>
</h3>
<p>User messages in <a href="https://github.com/RinteRface/shinydashboardPlus">shinydashboardPlus</a> (latest devel version).</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb309-1"><a href="shiny-custom-handler.html#cb309-1"></a><span class="co">// userMessages</span></span>
<span id="cb309-2"><a href="shiny-custom-handler.html#cb309-2"></a>  <span class="co">// ------------------------------------------------------------------</span></span>
<span id="cb309-3"><a href="shiny-custom-handler.html#cb309-3"></a>  <span class="co">// This code creates acustom handler for userMessages</span></span>
<span id="cb309-4"><a href="shiny-custom-handler.html#cb309-4"></a>  <span class="va">Shiny</span>.<span class="at">addCustomMessageHandler</span>(<span class="st">"user-messages"</span><span class="op">,</span> <span class="kw">function</span>(message) <span class="op">{</span></span>
<span id="cb309-5"><a href="shiny-custom-handler.html#cb309-5"></a>    <span class="kw">var</span> id <span class="op">=</span> <span class="va">message</span>.<span class="at">id</span><span class="op">,</span> action <span class="op">=</span> <span class="va">message</span>.<span class="at">action</span><span class="op">,</span> content <span class="op">=</span> <span class="va">message</span>.<span class="at">body</span><span class="op">,</span> index <span class="op">=</span> <span class="va">message</span>.<span class="at">index</span><span class="op">;</span></span>
<span id="cb309-6"><a href="shiny-custom-handler.html#cb309-6"></a>    </span>
<span id="cb309-7"><a href="shiny-custom-handler.html#cb309-7"></a>    <span class="co">// message text</span></span>
<span id="cb309-8"><a href="shiny-custom-handler.html#cb309-8"></a>    <span class="co">// We use Shiny.renderHtml to handle the case where the user pass input/outputs in the updated content that require a new dependency not available in the </span></span>
<span id="cb309-9"><a href="shiny-custom-handler.html#cb309-9"></a>    <span class="co">// page at startup. </span></span>
<span id="cb309-10"><a href="shiny-custom-handler.html#cb309-10"></a>    <span class="cf">if</span> (<span class="va">content</span>.<span class="at">hasOwnProperty</span>(<span class="st">"text"</span>)) <span class="op">{</span></span>
<span id="cb309-11"><a href="shiny-custom-handler.html#cb309-11"></a>      <span class="kw">var</span> text<span class="op">;</span></span>
<span id="cb309-12"><a href="shiny-custom-handler.html#cb309-12"></a>      <span class="cf">if</span> (<span class="va">content</span>.<span class="va">text</span>.<span class="at">html</span> <span class="op">===</span> <span class="kw">undefined</span>) <span class="op">{</span></span>
<span id="cb309-13"><a href="shiny-custom-handler.html#cb309-13"></a>        text <span class="op">=</span> <span class="va">content</span>.<span class="at">text</span><span class="op">;</span></span>
<span id="cb309-14"><a href="shiny-custom-handler.html#cb309-14"></a>      <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb309-15"><a href="shiny-custom-handler.html#cb309-15"></a>        text <span class="op">=</span> <span class="va">Shiny</span>.<span class="at">renderHtml</span>(<span class="va">content</span>.<span class="va">text</span>.<span class="at">html</span><span class="op">,</span> <span class="at">$</span>([])<span class="op">,</span> <span class="va">content</span>.<span class="va">text</span>.<span class="at">deps</span>).<span class="at">html</span><span class="op">;</span></span>
<span id="cb309-16"><a href="shiny-custom-handler.html#cb309-16"></a>      <span class="op">}</span> </span>
<span id="cb309-17"><a href="shiny-custom-handler.html#cb309-17"></a>    <span class="op">}</span></span>
<span id="cb309-18"><a href="shiny-custom-handler.html#cb309-18"></a>    </span>
<span id="cb309-19"><a href="shiny-custom-handler.html#cb309-19"></a>    <span class="co">// unbind all</span></span>
<span id="cb309-20"><a href="shiny-custom-handler.html#cb309-20"></a>    <span class="va">Shiny</span>.<span class="at">unbindAll</span>()<span class="op">;</span></span>
<span id="cb309-21"><a href="shiny-custom-handler.html#cb309-21"></a>    </span>
<span id="cb309-22"><a href="shiny-custom-handler.html#cb309-22"></a>    <span class="cf">if</span> (action <span class="op">===</span> <span class="st">"remove"</span>) <span class="op">{</span></span>
<span id="cb309-23"><a href="shiny-custom-handler.html#cb309-23"></a>      <span class="at">$</span>(<span class="st">"#"</span> <span class="op">+</span> id).<span class="at">find</span>(<span class="st">".direct-chat-msg"</span>).<span class="at">eq</span>(index <span class="op">-</span> <span class="dv">1</span>).<span class="at">remove</span>()<span class="op">;</span></span>
<span id="cb309-24"><a href="shiny-custom-handler.html#cb309-24"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> (action <span class="op">===</span> <span class="st">"add"</span>) <span class="op">{</span></span>
<span id="cb309-25"><a href="shiny-custom-handler.html#cb309-25"></a>      <span class="kw">var</span> author <span class="op">=</span> <span class="va">content</span>.<span class="at">author</span><span class="op">,</span> date <span class="op">=</span> <span class="va">content</span>.<span class="at">date</span><span class="op">,</span> image <span class="op">=</span> <span class="va">content</span>.<span class="at">image</span><span class="op">,</span> type <span class="op">=</span> <span class="va">content</span>.<span class="at">type</span><span class="op">;</span></span>
<span id="cb309-26"><a href="shiny-custom-handler.html#cb309-26"></a>      </span>
<span id="cb309-27"><a href="shiny-custom-handler.html#cb309-27"></a>      <span class="co">// build the new message </span></span>
<span id="cb309-28"><a href="shiny-custom-handler.html#cb309-28"></a>      <span class="kw">var</span> newMessage <span class="op">=</span> <span class="st">'&lt;div class="direct-chat-info clearfix"&gt;'</span> <span class="op">+</span></span>
<span id="cb309-29"><a href="shiny-custom-handler.html#cb309-29"></a>        <span class="st">'&lt;span class="direct-chat-name"&gt;'</span> <span class="op">+</span> author <span class="op">+</span> <span class="st">'&lt;/span&gt;'</span> <span class="op">+</span></span>
<span id="cb309-30"><a href="shiny-custom-handler.html#cb309-30"></a>        <span class="st">'&lt;span class="direct-chat-timestamp" style="margin-left: 4px"&gt;'</span> <span class="op">+</span> date <span class="op">+</span> <span class="st">'&lt;/span&gt;'</span> <span class="op">+</span> <span class="st">'&lt;/div&gt;'</span> <span class="op">+</span></span>
<span id="cb309-31"><a href="shiny-custom-handler.html#cb309-31"></a>        <span class="st">'&lt;img class="direct-chat-img" src="'</span> <span class="op">+</span> image <span class="op">+</span> <span class="st">'"/&gt;'</span> <span class="op">+</span> </span>
<span id="cb309-32"><a href="shiny-custom-handler.html#cb309-32"></a>        <span class="st">'&lt;div class="direct-chat-text"&gt;'</span> <span class="op">+</span> text <span class="op">+</span> <span class="st">'&lt;/div&gt;'</span></span>
<span id="cb309-33"><a href="shiny-custom-handler.html#cb309-33"></a>        </span>
<span id="cb309-34"><a href="shiny-custom-handler.html#cb309-34"></a>      <span class="co">// build wrapper</span></span>
<span id="cb309-35"><a href="shiny-custom-handler.html#cb309-35"></a>      <span class="kw">var</span> newMessageWrapper<span class="op">;</span></span>
<span id="cb309-36"><a href="shiny-custom-handler.html#cb309-36"></a>      <span class="cf">if</span> (type <span class="op">===</span> <span class="st">"sent"</span>) <span class="op">{</span></span>
<span id="cb309-37"><a href="shiny-custom-handler.html#cb309-37"></a>        newMessageWrapper <span class="op">=</span> <span class="st">'&lt;div class="direct-chat-msg right"&gt;'</span> <span class="op">+</span> newMessage <span class="op">+</span> <span class="st">'&lt;/div&gt;'</span></span>
<span id="cb309-38"><a href="shiny-custom-handler.html#cb309-38"></a>      <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb309-39"><a href="shiny-custom-handler.html#cb309-39"></a>        newMessageWrapper <span class="op">=</span> <span class="st">'&lt;div class="direct-chat-msg"&gt;'</span> <span class="op">+</span> newMessage <span class="op">+</span> <span class="st">'&lt;/div&gt;'</span></span>
<span id="cb309-40"><a href="shiny-custom-handler.html#cb309-40"></a>      <span class="op">}</span></span>
<span id="cb309-41"><a href="shiny-custom-handler.html#cb309-41"></a>      </span>
<span id="cb309-42"><a href="shiny-custom-handler.html#cb309-42"></a>      <span class="co">// append message</span></span>
<span id="cb309-43"><a href="shiny-custom-handler.html#cb309-43"></a>      <span class="at">$</span>(<span class="st">"#"</span> <span class="op">+</span> id).<span class="at">find</span>(<span class="st">".direct-chat-messages"</span>).<span class="at">append</span>(newMessageWrapper)<span class="op">;</span></span>
<span id="cb309-44"><a href="shiny-custom-handler.html#cb309-44"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> (action <span class="op">===</span> <span class="st">"update"</span>) <span class="op">{</span></span>
<span id="cb309-45"><a href="shiny-custom-handler.html#cb309-45"></a>      </span>
<span id="cb309-46"><a href="shiny-custom-handler.html#cb309-46"></a>      <span class="co">// today's date</span></span>
<span id="cb309-47"><a href="shiny-custom-handler.html#cb309-47"></a>      <span class="kw">var</span> d <span class="op">=</span> <span class="kw">new</span> <span class="at">Date</span>()<span class="op">;</span></span>
<span id="cb309-48"><a href="shiny-custom-handler.html#cb309-48"></a>      <span class="kw">var</span> month <span class="op">=</span> <span class="va">d</span>.<span class="at">getMonth</span>() <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb309-49"><a href="shiny-custom-handler.html#cb309-49"></a>      <span class="kw">var</span> day <span class="op">=</span> <span class="va">d</span>.<span class="at">getDate</span>()<span class="op">;</span></span>
<span id="cb309-50"><a href="shiny-custom-handler.html#cb309-50"></a>      <span class="kw">var</span> today <span class="op">=</span> <span class="va">d</span>.<span class="at">getFullYear</span>() <span class="op">+</span> <span class="st">'/'</span> <span class="op">+</span></span>
<span id="cb309-51"><a href="shiny-custom-handler.html#cb309-51"></a>        ((<span class="st">''</span><span class="op">+</span>month).<span class="at">length</span><span class="op">&lt;</span><span class="dv">2</span> <span class="op">?</span> <span class="st">'0'</span> : <span class="st">''</span>) <span class="op">+</span> month <span class="op">+</span> <span class="st">'/'</span> <span class="op">+</span></span>
<span id="cb309-52"><a href="shiny-custom-handler.html#cb309-52"></a>        ((<span class="st">''</span><span class="op">+</span>day).<span class="at">length</span><span class="op">&lt;</span><span class="dv">2</span> <span class="op">?</span> <span class="st">'0'</span> : <span class="st">''</span>) <span class="op">+</span> day<span class="op">;</span></span>
<span id="cb309-53"><a href="shiny-custom-handler.html#cb309-53"></a>        </span>
<span id="cb309-54"><a href="shiny-custom-handler.html#cb309-54"></a>      <span class="co">// we assume only text may be updated. Does not make sense to modify author/date</span></span>
<span id="cb309-55"><a href="shiny-custom-handler.html#cb309-55"></a>      </span>
<span id="cb309-56"><a href="shiny-custom-handler.html#cb309-56"></a>      <span class="at">$</span>(<span class="st">"#"</span> <span class="op">+</span> id)</span>
<span id="cb309-57"><a href="shiny-custom-handler.html#cb309-57"></a>        .<span class="at">find</span>(<span class="st">".direct-chat-text"</span>)</span>
<span id="cb309-58"><a href="shiny-custom-handler.html#cb309-58"></a>        .<span class="at">eq</span>(index <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb309-59"><a href="shiny-custom-handler.html#cb309-59"></a>        .<span class="at">replaceWith</span>(<span class="st">'&lt;div class="direct-chat-text"&gt;&lt;small class="text-red"&gt;(modified: '</span> <span class="op">+</span> today <span class="op">+</span><span class="st">')&lt;/small&gt;&lt;br&gt;'</span> <span class="op">+</span>  text <span class="op">+</span> <span class="st">'&lt;/div&gt;'</span>)</span>
<span id="cb309-60"><a href="shiny-custom-handler.html#cb309-60"></a>    <span class="op">}</span></span>
<span id="cb309-61"><a href="shiny-custom-handler.html#cb309-61"></a>    </span>
<span id="cb309-62"><a href="shiny-custom-handler.html#cb309-62"></a>    <span class="co">// Calls .initialize() for all of the input objects in all input bindings,</span></span>
<span id="cb309-63"><a href="shiny-custom-handler.html#cb309-63"></a>    <span class="co">// in the given scope (document)</span></span>
<span id="cb309-64"><a href="shiny-custom-handler.html#cb309-64"></a>    <span class="va">Shiny</span>.<span class="at">initializeInputs</span>()<span class="op">;</span></span>
<span id="cb309-65"><a href="shiny-custom-handler.html#cb309-65"></a>    <span class="va">Shiny</span>.<span class="at">bindAll</span>()<span class="op">;</span> <span class="co">// bind all inputs/outputs</span></span>
<span id="cb309-66"><a href="shiny-custom-handler.html#cb309-66"></a>  <span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>Shiny demo:</p>
<div class="sourceCode" id="cb310"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://rstudio.github.io/shinydashboard/">shinydashboard</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RinteRface/shinydashboardPlus">shinydashboardPlus</a></span><span class="op">)</span>
 
 <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span>
  ui <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shinydashboard/man/dashboardPage.html">dashboardPage</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/pkg/shinydashboard/man/dashboardHeader.html">dashboardHeader</a></span><span class="op">(</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/pkg/shinydashboard/man/dashboardSidebar.html">dashboardSidebar</a></span><span class="op">(</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/pkg/shinydashboard/man/dashboardBody.html">dashboardBody</a></span><span class="op">(</span>
      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidRow</a></span><span class="op">(</span>
        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/actionButton.html">actionButton</a></span><span class="op">(</span><span class="st">"remove"</span>, <span class="st">"Remove message"</span><span class="op">)</span>,
        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/actionButton.html">actionButton</a></span><span class="op">(</span><span class="st">"add"</span>, <span class="st">"Add message"</span><span class="op">)</span>,
        <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/actionButton.html">actionButton</a></span><span class="op">(</span><span class="st">"update"</span>, <span class="st">"Update message"</span><span class="op">)</span>
      <span class="op">)</span>,
      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/numericInput.html">numericInput</a></span><span class="op">(</span><span class="st">"index"</span>, <span class="st">"Message index:"</span>, <span class="fl">1</span>, min <span class="op">=</span> <span class="fl">1</span>, max <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,
      <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">br</a></span><span class="op">(</span><span class="op">)</span>,
      <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">br</a></span><span class="op">(</span><span class="op">)</span>,
      <span class="fu"><a href="https://rdrr.io/pkg/shinydashboardPlus/man/userMessage.html">userMessages</a></span><span class="op">(</span>
        width <span class="op">=</span> <span class="fl">6</span>,
        status <span class="op">=</span> <span class="st">"danger"</span>,
        id <span class="op">=</span> <span class="st">"message"</span>,
        <span class="fu"><a href="https://rdrr.io/pkg/shinydashboardPlus/man/userMessage.html">userMessage</a></span><span class="op">(</span>
          author <span class="op">=</span> <span class="st">"Alexander Pierce"</span>,
          date <span class="op">=</span> <span class="st">"20 Jan 2:00 pm"</span>,
          image <span class="op">=</span> <span class="st">"https://adminlte.io/themes/AdminLTE/dist/img/user1-128x128.jpg"</span>,
          type <span class="op">=</span> <span class="st">"received"</span>,
          <span class="st">"Is this template really for free? That's unbelievable!"</span>
        <span class="op">)</span>,
        <span class="fu"><a href="https://rdrr.io/pkg/shinydashboardPlus/man/userMessage.html">userMessage</a></span><span class="op">(</span>
          author <span class="op">=</span> <span class="st">"Sarah Bullock"</span>,
          date <span class="op">=</span> <span class="st">"23 Jan 2:05 pm"</span>,
          image <span class="op">=</span> <span class="st">"https://adminlte.io/themes/AdminLTE/dist/img/user3-128x128.jpg"</span>,
          type <span class="op">=</span> <span class="st">"sent"</span>,
          <span class="st">"You better believe it!"</span>
        <span class="op">)</span>
      <span class="op">)</span>
    <span class="op">)</span>,
    title <span class="op">=</span> <span class="st">"user Message"</span>
  <span class="op">)</span>,
  server <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">remove</span>, <span class="op">{</span>
      <span class="fu"><a href="https://rdrr.io/pkg/shinydashboardPlus/man/userMessages.html">updateUserMessages</a></span><span class="op">(</span><span class="st">"message"</span>, action <span class="op">=</span> <span class="st">"remove"</span>, index <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">index</span><span class="op">)</span>
    <span class="op">}</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">add</span>, <span class="op">{</span>
      <span class="fu"><a href="https://rdrr.io/pkg/shinydashboardPlus/man/userMessages.html">updateUserMessages</a></span><span class="op">(</span>
        <span class="st">"message"</span>, 
        action <span class="op">=</span> <span class="st">"add"</span>, 
        content <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
          author <span class="op">=</span> <span class="st">"David"</span>,
          date <span class="op">=</span> <span class="st">"Now"</span>,
          image <span class="op">=</span> <span class="st">"https://i.pinimg.com/originals/f1/15/df/f115dfc9cab063597b1221d015996b39.jpg"</span>,
          type <span class="op">=</span> <span class="st">"received"</span>,
          text <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tag.html">tagList</a></span><span class="op">(</span>
           <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html">sliderInput</a></span><span class="op">(</span>
            <span class="st">"obs"</span>, 
            <span class="st">"Number of observations:"</span>,
            min <span class="op">=</span> <span class="fl">0</span>, 
            max <span class="op">=</span> <span class="fl">1000</span>, 
            value <span class="op">=</span> <span class="fl">500</span>
           <span class="op">)</span>,
           <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/plotOutput.html">plotOutput</a></span><span class="op">(</span><span class="st">"distPlot"</span><span class="op">)</span>
          <span class="op">)</span>
        <span class="op">)</span>
      <span class="op">)</span>
    <span class="op">}</span><span class="op">)</span>
    
    <span class="va">output</span><span class="op">$</span><span class="va">distPlot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html">renderPlot</a></span><span class="op">(</span><span class="op">{</span>
     <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">obs</span><span class="op">)</span><span class="op">)</span>
    <span class="op">}</span><span class="op">)</span>
    
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">update</span>, <span class="op">{</span>
      <span class="fu"><a href="https://rdrr.io/pkg/shinydashboardPlus/man/userMessages.html">updateUserMessages</a></span><span class="op">(</span>
        <span class="st">"message"</span>, 
        action <span class="op">=</span> <span class="st">"update"</span>, 
        index <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">index</span>,
        content <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
         text <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/tag.html">tagList</a></span><span class="op">(</span>
          <span class="fu"><a href="https://rdrr.io/pkg/shinydashboardPlus/man/appButton.html">appButton</a></span><span class="op">(</span>
           inputId <span class="op">=</span> <span class="st">"reload"</span>,
           label <span class="op">=</span> <span class="st">"Click me!"</span>, 
           icon <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/icon.html">icon</a></span><span class="op">(</span><span class="st">"sync"</span><span class="op">)</span>, 
           <span class="fu"><a href="https://rdrr.io/pkg/shinydashboardPlus/man/dashboardBadge.html">dashboardBadge</a></span><span class="op">(</span><span class="fl">1</span>, color <span class="op">=</span> <span class="st">"orange"</span><span class="op">)</span>
          <span class="op">)</span>
         <span class="op">)</span>
        <span class="op">)</span>
      <span class="op">)</span>
    <span class="op">}</span><span class="op">)</span>
    
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">reload</span>, <span class="op">{</span>
     <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/showNotification.html">showNotification</a></span><span class="op">(</span><span class="st">"Yeah!"</span>, duration <span class="op">=</span> <span class="fl">1</span>, type <span class="op">=</span> <span class="st">"default"</span><span class="op">)</span>
    <span class="op">}</span><span class="op">)</span>
  <span class="op">}</span>
 <span class="op">)</span></code></pre></div>

</div>
</div>
</div>




<div class="chapter-nav">
<div class="prev"><a href="shiny-input-gems.html"><span class="header-section-number">14</span> Hidden gems about inputs</a></div>
<div class="next"><a href="custom-templates-selection.html"><span class="header-section-number">16</span> Template selection</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#shiny-custom-handler"><span class="header-section-number">15</span> Custom handlers: from R to JavaScript</a></li>
<li><a class="nav-link" href="#introduction-3"><span class="header-section-number">15.1</span> Introduction</a></li>
<li>
<a class="nav-link" href="#dynamically-manage-content"><span class="header-section-number">15.2</span> Dynamically manage content</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#issues-with-renderui"><span class="header-section-number">15.2.1</span> Issues with renderUI</a></li>
<li><a class="nav-link" href="#insertui"><span class="header-section-number">15.2.2</span> insertUI</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#toward-custom-ui-management-functions"><span class="header-section-number">15.3</span> Toward custom UI management functions</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#html-with-extra-dependencies"><span class="header-section-number">15.3.1</span> HTML with extra dependencies</a></li>
<li><a class="nav-link" href="#example-2"><span class="header-section-number">15.3.2</span> Example</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/DivadNojnarg/outstanding-shiny-ui/blob/master/shiny-custom-handler.Rmd">View source</a></li>
          <li><a id="book-edit" href="https://github.com/DivadNojnarg/outstanding-shiny-ui/edit/master/shiny-custom-handler.Rmd">Edit this page</a></li>
        </ul>
</div>
    </nav>
</div>
</div>
  

  

</div>
 <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Outstanding User Interfaces with Shiny</strong>" was written by David Granjon. It waslast built on 2020-11-05.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This website is produced by the <a class="text-light" href="https://bookdown.org">bookdown</a> bs4_book template.</p>
  </div>

</div></div>
</footer>
</body>
</html>
