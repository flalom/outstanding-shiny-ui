<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 8 Shiny’s input system | Outstanding User Interfaces with Shiny</title>
  <meta name="description" content="A book about deeply customizing Shiny app for production." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 8 Shiny’s input system | Outstanding User Interfaces with Shiny" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A book about deeply customizing Shiny app for production." />
  <meta name="github-repo" content="DivadNojnarg/outstanding-shiny-ui" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 Shiny’s input system | Outstanding User Interfaces with Shiny" />
  
  <meta name="twitter:description" content="A book about deeply customizing Shiny app for production." />
  

<meta name="author" content="David Granjon" />


<meta name="date" content="2020-10-26" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
<link rel="prev" href="shiny-intro.html"/>
<link rel="next" href="shiny-custom-handler.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Outstanding User Interfaces with Shiny</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#disclaimer"><i class="fa fa-check"></i>Disclaimer</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#is-this-book-for-me"><i class="fa fa-check"></i>Is this book for me?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#learning-objectives"><i class="fa fa-check"></i>Learning objectives</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#why-another-shiny-related-book"><i class="fa fa-check"></i>Why another Shiny related book?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#book-structure"><i class="fa fa-check"></i>Book structure</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#code-structure"><i class="fa fa-check"></i>Code structure</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#preliminary-exercices"><i class="fa fa-check"></i>Preliminary exercices</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#extra-material"><i class="fa fa-check"></i>Extra material</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#e-rum-2020"><i class="fa fa-check"></i>e-Rum 2020</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#rpharma-2020"><i class="fa fa-check"></i>R/Pharma 2020</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#about-rinterface"><i class="fa fa-check"></i>About RinteRface</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#packages"><i class="fa fa-check"></i>Packages</a></li>
</ul></li>
<li class="part"><span><b>Introduction</b></span></li>
<li class="chapter" data-level="1" data-path="web-intro.html"><a href="web-intro.html"><i class="fa fa-check"></i><b>1</b> Shiny and the Web</a><ul>
<li class="chapter" data-level="1.1" data-path="web-intro.html"><a href="web-intro.html#shiny-generates-html-code-from-r"><i class="fa fa-check"></i><b>1.1</b> Shiny generates HTML code from R</a></li>
<li class="chapter" data-level="1.2" data-path="web-intro.html"><a href="web-intro.html#web-intro-html"><i class="fa fa-check"></i><b>1.2</b> HTML 101</a><ul>
<li class="chapter" data-level="1.2.1" data-path="web-intro.html"><a href="web-intro.html#html-basics"><i class="fa fa-check"></i><b>1.2.1</b> HTML Basics</a></li>
<li class="chapter" data-level="1.2.2" data-path="web-intro.html"><a href="web-intro.html#tag-attributes"><i class="fa fa-check"></i><b>1.2.2</b> Tag attributes</a></li>
<li class="chapter" data-level="1.2.3" data-path="web-intro.html"><a href="web-intro.html#the-simplest-html-skeleton"><i class="fa fa-check"></i><b>1.2.3</b> The simplest HTML skeleton</a></li>
<li class="chapter" data-level="1.2.4" data-path="web-intro.html"><a href="web-intro.html#about-the-document-object-model-dom"><i class="fa fa-check"></i><b>1.2.4</b> About the Document Object Model (DOM)</a></li>
<li class="chapter" data-level="1.2.5" data-path="web-intro.html"><a href="web-intro.html#preliminary-introduction-to-css-and-javascript"><i class="fa fa-check"></i><b>1.2.5</b> Preliminary introduction to CSS and JavaScript</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="web-dependencies.html"><a href="web-dependencies.html"><i class="fa fa-check"></i><b>2</b> Discover Shiny dependencies</a><ul>
<li class="chapter" data-level="2.1" data-path="web-dependencies.html"><a href="web-dependencies.html#introduction"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="web-dependencies.html"><a href="web-dependencies.html#bootstrap"><i class="fa fa-check"></i><b>2.2</b> Bootstrap</a></li>
<li class="chapter" data-level="2.3" data-path="web-dependencies.html"><a href="web-dependencies.html#jquery-dom-manipulation"><i class="fa fa-check"></i><b>2.3</b> jQuery, DOM manipulation</a></li>
<li class="chapter" data-level="2.4" data-path="web-dependencies.html"><a href="web-dependencies.html#data-formating"><i class="fa fa-check"></i><b>2.4</b> Data formating</a></li>
<li class="chapter" data-level="2.5" data-path="web-dependencies.html"><a href="web-dependencies.html#custom-dependencies"><i class="fa fa-check"></i><b>2.5</b> Custom dependencies</a></li>
<li class="chapter" data-level="2.6" data-path="web-dependencies.html"><a href="web-dependencies.html#exercise"><i class="fa fa-check"></i><b>2.6</b> Exercise</a></li>
</ul></li>
<li class="part"><span><b>Unleash {htmltools}: from R to HTML</b></span></li>
<li class="chapter" data-level="3" data-path="htmltools-overview.html"><a href="htmltools-overview.html"><i class="fa fa-check"></i><b>3</b> htmltools overview</a><ul>
<li class="chapter" data-level="3.1" data-path="htmltools-overview.html"><a href="htmltools-overview.html#writing-html-tags-from-r"><i class="fa fa-check"></i><b>3.1</b> Writing HTML Tags from R</a></li>
<li class="chapter" data-level="3.2" data-path="htmltools-overview.html"><a href="htmltools-overview.html#notations"><i class="fa fa-check"></i><b>3.2</b> Notations</a></li>
<li class="chapter" data-level="3.3" data-path="htmltools-overview.html"><a href="htmltools-overview.html#adding-new-tags"><i class="fa fa-check"></i><b>3.3</b> Adding new tags</a></li>
<li class="chapter" data-level="3.4" data-path="htmltools-overview.html"><a href="htmltools-overview.html#alternative-way-to-write-tags"><i class="fa fa-check"></i><b>3.4</b> Alternative way to write tags</a></li>
<li class="chapter" data-level="3.5" data-path="htmltools-overview.html"><a href="htmltools-overview.html#playing-with-tags"><i class="fa fa-check"></i><b>3.5</b> Playing with tags</a><ul>
<li class="chapter" data-level="3.5.1" data-path="htmltools-overview.html"><a href="htmltools-overview.html#tags-structure"><i class="fa fa-check"></i><b>3.5.1</b> Tags structure</a></li>
<li class="chapter" data-level="3.5.2" data-path="htmltools-overview.html"><a href="htmltools-overview.html#useful-functions-for-tags"><i class="fa fa-check"></i><b>3.5.2</b> Useful functions for tags</a></li>
<li class="chapter" data-level="3.5.3" data-path="htmltools-overview.html"><a href="htmltools-overview.html#other-functions"><i class="fa fa-check"></i><b>3.5.3</b> Other functions</a></li>
<li class="chapter" data-level="3.5.4" data-path="htmltools-overview.html"><a href="htmltools-overview.html#conditionally-set-attributes"><i class="fa fa-check"></i><b>3.5.4</b> Conditionally set attributes</a></li>
<li class="chapter" data-level="3.5.5" data-path="htmltools-overview.html"><a href="htmltools-overview.html#using"><i class="fa fa-check"></i><b>3.5.5</b> Using %&gt;%</a></li>
<li class="chapter" data-level="3.5.6" data-path="htmltools-overview.html"><a href="htmltools-overview.html#programmatically-create-children-elements"><i class="fa fa-check"></i><b>3.5.6</b> Programmatically create children elements</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="htmltools-overview.html"><a href="htmltools-overview.html#exercises"><i class="fa fa-check"></i><b>3.6</b> Exercises</a><ul>
<li class="chapter" data-level="3.6.1" data-path="htmltools-overview.html"><a href="htmltools-overview.html#exercise-1-tags-structure-5-minutes"><i class="fa fa-check"></i><b>3.6.1</b> Exercise 1: tags structure (5 minutes)</a></li>
<li class="chapter" data-level="3.6.2" data-path="htmltools-overview.html"><a href="htmltools-overview.html#exercise-2-modifiying-tags-5-minutes"><i class="fa fa-check"></i><b>3.6.2</b> Exercise 2: modifiying tags (5 minutes)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="htmltools-dependencies.html"><a href="htmltools-dependencies.html"><i class="fa fa-check"></i><b>4</b> Dependency utilities</a><ul>
<li class="chapter" data-level="4.1" data-path="htmltools-dependencies.html"><a href="htmltools-dependencies.html#the-dirty-approach"><i class="fa fa-check"></i><b>4.1</b> The dirty approach</a></li>
<li class="chapter" data-level="4.2" data-path="htmltools-dependencies.html"><a href="htmltools-dependencies.html#the-clean-approach"><i class="fa fa-check"></i><b>4.2</b> The clean approach</a></li>
<li class="chapter" data-level="4.3" data-path="htmltools-dependencies.html"><a href="htmltools-dependencies.html#another-example-importing-html-dependencies-from-other-packages"><i class="fa fa-check"></i><b>4.3</b> Another example: Importing HTML dependencies from other packages</a></li>
<li class="chapter" data-level="4.4" data-path="htmltools-dependencies.html"><a href="htmltools-dependencies.html#suppress-dependencies"><i class="fa fa-check"></i><b>4.4</b> Suppress dependencies</a></li>
<li class="chapter" data-level="4.5" data-path="htmltools-dependencies.html"><a href="htmltools-dependencies.html#resolve-dependencies"><i class="fa fa-check"></i><b>4.5</b> Resolve dependencies</a></li>
<li class="chapter" data-level="4.6" data-path="htmltools-dependencies.html"><a href="htmltools-dependencies.html#insert-custom-script-in-the-head"><i class="fa fa-check"></i><b>4.6</b> Insert Custom script in the head</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="htmltools-other-tools.html"><a href="htmltools-other-tools.html"><i class="fa fa-check"></i><b>5</b> Other tools</a><ul>
<li class="chapter" data-level="5.1" data-path="htmltools-other-tools.html"><a href="htmltools-other-tools.html#css"><i class="fa fa-check"></i><b>5.1</b> CSS</a></li>
</ul></li>
<li class="part"><span><b>Deep dive in the Shiny input system</b></span></li>
<li class="chapter" data-level="6" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html"><i class="fa fa-check"></i><b>6</b> JavaScript for Shiny</a><ul>
<li class="chapter" data-level="6.1" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#shiny-javascript-sources"><i class="fa fa-check"></i><b>6.1</b> Shiny JavaScript sources</a></li>
<li class="chapter" data-level="6.2" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#introduction-to-javascript"><i class="fa fa-check"></i><b>6.2</b> Introduction to JavaScript</a></li>
<li class="chapter" data-level="6.3" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#setup"><i class="fa fa-check"></i><b>6.3</b> Setup</a><ul>
<li class="chapter" data-level="6.3.1" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#node"><i class="fa fa-check"></i><b>6.3.1</b> Node</a></li>
<li class="chapter" data-level="6.3.2" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#choose-a-good-ide"><i class="fa fa-check"></i><b>6.3.2</b> Choose a good IDE</a></li>
<li class="chapter" data-level="6.3.3" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#first-script"><i class="fa fa-check"></i><b>6.3.3</b> First Script</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#programming-with-js-basis"><i class="fa fa-check"></i><b>6.4</b> Programming with JS: basis</a><ul>
<li class="chapter" data-level="6.4.1" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#js-types"><i class="fa fa-check"></i><b>6.4.1</b> JS types</a></li>
<li class="chapter" data-level="6.4.2" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#variables"><i class="fa fa-check"></i><b>6.4.2</b> Variables</a></li>
<li class="chapter" data-level="6.4.3" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#conditions"><i class="fa fa-check"></i><b>6.4.3</b> Conditions</a></li>
<li class="chapter" data-level="6.4.4" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#objects"><i class="fa fa-check"></i><b>6.4.4</b> Objects</a></li>
<li class="chapter" data-level="6.4.5" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#iterations"><i class="fa fa-check"></i><b>6.4.5</b> Iterations</a></li>
<li class="chapter" data-level="6.4.6" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#functions"><i class="fa fa-check"></i><b>6.4.6</b> Functions</a></li>
<li class="chapter" data-level="6.4.7" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#event-listeners"><i class="fa fa-check"></i><b>6.4.7</b> Event listeners</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#jquery"><i class="fa fa-check"></i><b>6.5</b> jQuery</a><ul>
<li class="chapter" data-level="6.5.1" data-path="web-dependencies.html"><a href="web-dependencies.html#introduction"><i class="fa fa-check"></i><b>6.5.1</b> Introduction</a></li>
<li class="chapter" data-level="6.5.2" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#syntax"><i class="fa fa-check"></i><b>6.5.2</b> Syntax</a></li>
<li class="chapter" data-level="6.5.3" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#useful-functions"><i class="fa fa-check"></i><b>6.5.3</b> Useful functions</a></li>
<li class="chapter" data-level="6.5.4" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#chaining-jquery-methods"><i class="fa fa-check"></i><b>6.5.4</b> Chaining jQuery methods</a></li>
<li class="chapter" data-level="6.5.5" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#iterations-1"><i class="fa fa-check"></i><b>6.5.5</b> Iterations</a></li>
<li class="chapter" data-level="6.5.6" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#good-practice"><i class="fa fa-check"></i><b>6.5.6</b> Good practice</a></li>
<li class="chapter" data-level="6.5.7" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#events"><i class="fa fa-check"></i><b>6.5.7</b> Events</a></li>
<li class="chapter" data-level="6.5.8" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#extending-objects"><i class="fa fa-check"></i><b>6.5.8</b> Extending objects</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#shiny-js-inspector"><i class="fa fa-check"></i><b>6.6</b> Shiny, JavaScript and the HTML inspector</a><ul>
<li class="chapter" data-level="6.6.1" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#the-console-panel"><i class="fa fa-check"></i><b>6.6.1</b> The console panel</a></li>
<li class="chapter" data-level="6.6.2" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#debug-shinyjs-code-with-the-inspector"><i class="fa fa-check"></i><b>6.6.2</b> Debug Shiny/JS code with the inspector</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="htmltools-overview.html"><a href="htmltools-overview.html#exercises"><i class="fa fa-check"></i><b>6.7</b> Exercises</a><ul>
<li class="chapter" data-level="6.7.1" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#exercise-1-define-variables"><i class="fa fa-check"></i><b>6.7.1</b> Exercise 1: define variables</a></li>
<li class="chapter" data-level="6.7.2" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#exercise-2-define-objects"><i class="fa fa-check"></i><b>6.7.2</b> Exercise 2: define objects</a></li>
<li class="chapter" data-level="6.7.3" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#exercise-3-jquery"><i class="fa fa-check"></i><b>6.7.3</b> Exercise 3: jQuery</a></li>
<li class="chapter" data-level="6.7.4" data-path="survival-kit-javascript.html"><a href="survival-kit-javascript.html#exercise-4-a-pure-js-action-button"><i class="fa fa-check"></i><b>6.7.4</b> Exercise 4: a pure JS action button</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="shiny-intro.html"><a href="shiny-intro.html"><i class="fa fa-check"></i><b>7</b> Shiny’s internal: session and websockets</a><ul>
<li class="chapter" data-level="7.1" data-path="shiny-intro.html"><a href="shiny-intro.html#shiny-websocket"><i class="fa fa-check"></i><b>7.1</b> Websocket: R/JS bidirectional communication</a><ul>
<li class="chapter" data-level="7.1.1" data-path="shiny-intro.html"><a href="shiny-intro.html#shiny-websocket-server-side"><i class="fa fa-check"></i><b>7.1.1</b> Shiny: websocket server side</a></li>
<li class="chapter" data-level="7.1.2" data-path="shiny-intro.html"><a href="shiny-intro.html#shiny-websocket-client-side"><i class="fa fa-check"></i><b>7.1.2</b> Shiny: Websocket client side</a></li>
<li class="chapter" data-level="7.1.3" data-path="shiny-intro.html"><a href="shiny-intro.html#example"><i class="fa fa-check"></i><b>7.1.3</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="shiny-intro.html"><a href="shiny-intro.html#shiny-js-object"><i class="fa fa-check"></i><b>7.2</b> The Shiny JavaScript object</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="shiny-input-system.html"><a href="shiny-input-system.html"><i class="fa fa-check"></i><b>8</b> Shiny’s input system</a><ul>
<li class="chapter" data-level="8.1" data-path="shiny-input-system.html"><a href="shiny-input-system.html#input-bindings"><i class="fa fa-check"></i><b>8.1</b> Input bindings</a><ul>
<li class="chapter" data-level="8.1.1" data-path="shiny-input-system.html"><a href="shiny-input-system.html#input-structure"><i class="fa fa-check"></i><b>8.1.1</b> Input structure</a></li>
<li class="chapter" data-level="8.1.2" data-path="shiny-input-system.html"><a href="shiny-input-system.html#binding-shiny-inputs"><i class="fa fa-check"></i><b>8.1.2</b> Binding Shiny inputs</a></li>
<li class="chapter" data-level="8.1.3" data-path="shiny-input-system.html"><a href="shiny-input-system.html#edit-an-input-binding"><i class="fa fa-check"></i><b>8.1.3</b> Edit an input binding</a></li>
<li class="chapter" data-level="8.1.4" data-path="shiny-input-system.html"><a href="shiny-input-system.html#update-a-binding-from-the-client"><i class="fa fa-check"></i><b>8.1.4</b> Update a binding from the client</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="shiny-input-system.html"><a href="shiny-input-system.html#examples"><i class="fa fa-check"></i><b>8.2</b> Examples</a><ul>
<li class="chapter" data-level="8.2.1" data-path="shiny-input-system.html"><a href="shiny-input-system.html#shinydashboard-boxes-on-steroids"><i class="fa fa-check"></i><b>8.2.1</b> {shinydashboard} boxes on steroids</a></li>
<li class="chapter" data-level="8.2.2" data-path="shiny-input-system.html"><a href="shiny-input-system.html#going-further"><i class="fa fa-check"></i><b>8.2.2</b> Going further</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="shiny-input-system.html"><a href="shiny-input-system.html#utilities-to-quickly-define-new-inputs"><i class="fa fa-check"></i><b>8.3</b> Utilities to quickly define new inputs</a><ul>
<li class="chapter" data-level="8.3.1" data-path="web-dependencies.html"><a href="web-dependencies.html#introduction"><i class="fa fa-check"></i><b>8.3.1</b> Introduction</a></li>
<li class="chapter" data-level="8.3.2" data-path="shiny-input-system.html"><a href="shiny-input-system.html#examples-1"><i class="fa fa-check"></i><b>8.3.2</b> Examples</a></li>
<li class="chapter" data-level="8.3.3" data-path="shiny-input-system.html"><a href="shiny-input-system.html#custom-data-format"><i class="fa fa-check"></i><b>8.3.3</b> Custom data format</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="shiny-input-system.html"><a href="shiny-input-system.html#hidden-gems-about-inputs"><i class="fa fa-check"></i><b>8.4</b> Hidden gems about inputs</a><ul>
<li class="chapter" data-level="8.4.1" data-path="shiny-input-system.html"><a href="shiny-input-system.html#get-the-last-changed-input"><i class="fa fa-check"></i><b>8.4.1</b> Get the last changed input</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="shiny-input-system.html"><a href="shiny-input-system.html#recap-shiny-app-lifecycles"><i class="fa fa-check"></i><b>8.5</b> Recap: Shiny App lifecycles</a><ul>
<li class="chapter" data-level="8.5.1" data-path="shiny-input-system.html"><a href="shiny-input-system.html#app-initialization"><i class="fa fa-check"></i><b>8.5.1</b> App initialization</a></li>
<li class="chapter" data-level="8.5.2" data-path="shiny-input-system.html"><a href="shiny-input-system.html#update-input"><i class="fa fa-check"></i><b>8.5.2</b> Update input</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="shiny-custom-handler.html"><a href="shiny-custom-handler.html"><i class="fa fa-check"></i><b>9</b> Custom handlers: from R to JavaScript</a></li>
<li class="part"><span><b>Practice 1: a dashboard template</b></span></li>
<li class="chapter" data-level="10" data-path="custom-templates-selection.html"><a href="custom-templates-selection.html"><i class="fa fa-check"></i><b>10</b> Template selection</a></li>
<li class="chapter" data-level="11" data-path="custom-templates-dependencies.html"><a href="custom-templates-dependencies.html"><i class="fa fa-check"></i><b>11</b> Define dependencies</a><ul>
<li class="chapter" data-level="11.1" data-path="custom-templates-dependencies.html"><a href="custom-templates-dependencies.html#discover-the-project"><i class="fa fa-check"></i><b>11.1</b> Discover the project</a></li>
<li class="chapter" data-level="11.2" data-path="custom-templates-dependencies.html"><a href="custom-templates-dependencies.html#identify-mandatory-dependencies"><i class="fa fa-check"></i><b>11.2</b> Identify mandatory dependencies</a></li>
<li class="chapter" data-level="11.3" data-path="custom-templates-dependencies.html"><a href="custom-templates-dependencies.html#bundle-dependencies"><i class="fa fa-check"></i><b>11.3</b> Bundle dependencies</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="custom-templates-skeleton.html"><a href="custom-templates-skeleton.html"><i class="fa fa-check"></i><b>12</b> Template skeleton</a><ul>
<li class="chapter" data-level="12.1" data-path="custom-templates-skeleton.html"><a href="custom-templates-skeleton.html#identify-template-elements"><i class="fa fa-check"></i><b>12.1</b> Identify template elements</a></li>
<li class="chapter" data-level="12.2" data-path="custom-templates-skeleton.html"><a href="custom-templates-skeleton.html#design-the-page-layout"><i class="fa fa-check"></i><b>12.2</b> Design the page layout</a><ul>
<li class="chapter" data-level="12.2.1" data-path="custom-templates-skeleton.html"><a href="custom-templates-skeleton.html#the-page-wrapper"><i class="fa fa-check"></i><b>12.2.1</b> The page wrapper</a></li>
<li class="chapter" data-level="12.2.2" data-path="custom-templates-skeleton.html"><a href="custom-templates-skeleton.html#the-body-content"><i class="fa fa-check"></i><b>12.2.2</b> The body content</a></li>
<li class="chapter" data-level="12.2.3" data-path="custom-templates-skeleton.html"><a href="custom-templates-skeleton.html#the-footer"><i class="fa fa-check"></i><b>12.2.3</b> The footer</a></li>
<li class="chapter" data-level="12.2.4" data-path="custom-templates-skeleton.html"><a href="custom-templates-skeleton.html#the-navbar-or-header"><i class="fa fa-check"></i><b>12.2.4</b> The navbar (or header)</a></li>
<li class="chapter" data-level="12.2.5" data-path="custom-templates-skeleton.html"><a href="custom-templates-skeleton.html#card-containers"><i class="fa fa-check"></i><b>12.2.5</b> Card containers</a></li>
<li class="chapter" data-level="12.2.6" data-path="custom-templates-skeleton.html"><a href="custom-templates-skeleton.html#ribbons-card-components"><i class="fa fa-check"></i><b>12.2.6</b> Ribbons: card components</a></li>
<li class="chapter" data-level="12.2.7" data-path="custom-templates-skeleton.html"><a href="custom-templates-skeleton.html#icons"><i class="fa fa-check"></i><b>12.2.7</b> Icons</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="htmltools-overview.html"><a href="htmltools-overview.html#exercises"><i class="fa fa-check"></i><b>12.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="custom-templates-testing.html"><a href="custom-templates-testing.html"><i class="fa fa-check"></i><b>13</b> Testing and validating templates elements</a><ul>
<li class="chapter" data-level="13.1" data-path="custom-templates-testing.html"><a href="custom-templates-testing.html#validate-template-functions"><i class="fa fa-check"></i><b>13.1</b> Validate template functions</a><ul>
<li class="chapter" data-level="13.1.1" data-path="custom-templates-testing.html"><a href="custom-templates-testing.html#create-your-own-validations"><i class="fa fa-check"></i><b>13.1.1</b> Create your own validations</a></li>
<li class="chapter" data-level="13.1.2" data-path="custom-templates-testing.html"><a href="custom-templates-testing.html#existing-utils-functions"><i class="fa fa-check"></i><b>13.1.2</b> Existing utils functions</a></li>
<li class="chapter" data-level="13.1.3" data-path="custom-templates-testing.html"><a href="custom-templates-testing.html#example-refine-navbar-menu-items"><i class="fa fa-check"></i><b>13.1.3</b> Example: refine navbar menu items</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="custom-templates-testing.html"><a href="custom-templates-testing.html#testing-templates-elements"><i class="fa fa-check"></i><b>13.2</b> Testing templates elements</a><ul>
<li class="chapter" data-level="13.2.1" data-path="custom-templates-testing.html"><a href="custom-templates-testing.html#testing-template-behavior"><i class="fa fa-check"></i><b>13.2.1</b> Testing template behavior</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="custom-templates-testing.html"><a href="custom-templates-testing.html#testing-javascript"><i class="fa fa-check"></i><b>13.3</b> Testing JavaScript</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="custom-templates-inputs.html"><a href="custom-templates-inputs.html"><i class="fa fa-check"></i><b>14</b> Develop custom input widgets</a><ul>
<li class="chapter" data-level="14.1" data-path="custom-templates-inputs.html"><a href="custom-templates-inputs.html#tabler-action-button"><i class="fa fa-check"></i><b>14.1</b> Tabler action button</a><ul>
<li class="chapter" data-level="14.1.1" data-path="custom-templates-inputs.html"><a href="custom-templates-inputs.html#reminders-about-the-action-button"><i class="fa fa-check"></i><b>14.1.1</b> Reminders about the action button</a></li>
<li class="chapter" data-level="14.1.2" data-path="custom-templates-inputs.html"><a href="custom-templates-inputs.html#application-to-tabler"><i class="fa fa-check"></i><b>14.1.2</b> Application to Tabler</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="custom-templates-inputs.html"><a href="custom-templates-inputs.html#toggle-switch"><i class="fa fa-check"></i><b>14.2</b> Toggle Switch</a></li>
<li class="chapter" data-level="14.3" data-path="custom-templates-inputs.html"><a href="custom-templates-inputs.html#navbar-menu-input"><i class="fa fa-check"></i><b>14.3</b> Navbar menu input</a></li>
<li class="chapter" data-level="14.4" data-path="htmltools-overview.html"><a href="htmltools-overview.html#exercises"><i class="fa fa-check"></i><b>14.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="custom-templates-interactivity.html"><a href="custom-templates-interactivity.html"><i class="fa fa-check"></i><b>15</b> Adding more interactivity</a><ul>
<li class="chapter" data-level="15.1" data-path="custom-templates-interactivity.html"><a href="custom-templates-interactivity.html#custom-progress-bars"><i class="fa fa-check"></i><b>15.1</b> Custom progress bars</a></li>
<li class="chapter" data-level="15.2" data-path="custom-templates-interactivity.html"><a href="custom-templates-interactivity.html#user-feedback-toasts"><i class="fa fa-check"></i><b>15.2</b> User feedback: toasts</a><ul>
<li class="chapter" data-level="15.2.1" data-path="custom-templates-interactivity.html"><a href="custom-templates-interactivity.html#toast-skeleton"><i class="fa fa-check"></i><b>15.2.1</b> Toast skeleton</a></li>
<li class="chapter" data-level="15.2.2" data-path="custom-templates-interactivity.html"><a href="custom-templates-interactivity.html#the-toast-api"><i class="fa fa-check"></i><b>15.2.2</b> The toast API</a></li>
<li class="chapter" data-level="15.2.3" data-path="custom-templates-interactivity.html"><a href="custom-templates-interactivity.html#r-implementation"><i class="fa fa-check"></i><b>15.2.3</b> R implementation</a></li>
<li class="chapter" data-level="15.2.4" data-path="custom-templates-interactivity.html"><a href="custom-templates-interactivity.html#wrap-up"><i class="fa fa-check"></i><b>15.2.4</b> Wrap up</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="custom-templates-interactivity.html"><a href="custom-templates-interactivity.html#transform-an-element-in-a-custom-action-button"><i class="fa fa-check"></i><b>15.3</b> Transform an element in a custom action button</a></li>
<li class="chapter" data-level="15.4" data-path="custom-templates-interactivity.html"><a href="custom-templates-interactivity.html#tab-events"><i class="fa fa-check"></i><b>15.4</b> Tab events</a><ul>
<li class="chapter" data-level="15.4.1" data-path="custom-templates-interactivity.html"><a href="custom-templates-interactivity.html#insert-tabs"><i class="fa fa-check"></i><b>15.4.1</b> Insert/Remove tabs in tabsetpanel</a></li>
</ul></li>
<li class="chapter" data-level="15.5" data-path="htmltools-overview.html"><a href="htmltools-overview.html#exercises"><i class="fa fa-check"></i><b>15.5</b> Exercises</a></li>
</ul></li>
<li class="part"><span><b>Toward a better workflow</b></span></li>
<li class="chapter" data-level="16" data-path="workflow-charpente.html"><a href="workflow-charpente.html"><i class="fa fa-check"></i><b>16</b> Introduction to {charpente}</a><ul>
<li class="chapter" data-level="16.1" data-path="shiny-input-system.html"><a href="shiny-input-system.html#motivations"><i class="fa fa-check"></i><b>16.1</b> Motivations</a></li>
<li class="chapter" data-level="16.2" data-path="workflow-charpente.html"><a href="workflow-charpente.html#step-by-step"><i class="fa fa-check"></i><b>16.2</b> Step by step</a></li>
</ul></li>
<li class="part"><span><b>Beautify with CSS and SASS</b></span></li>
<li class="chapter" data-level="17" data-path="beautify-with-fresh.html"><a href="beautify-with-fresh.html"><i class="fa fa-check"></i><b>17</b> Beautify with fresh</a><ul>
<li class="chapter" data-level="17.1" data-path="beautify-with-fresh.html"><a href="beautify-with-fresh.html#fresh-the-big-picture"><i class="fa fa-check"></i><b>17.1</b> {fresh}, the big picture</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Outstanding User Interfaces with Shiny</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="shiny-input-system" class="section level1">
<h1><span class="header-section-number">Chapter 8</span> Shiny’s input system</h1>
<p>Shiny inputs are key elements of Shiny apps since they are a way for the end-user to interact with the app. You may know <code>sliderInput</code>, <code>numericInput</code>, <code>checkboxInput</code> but sometimes you may need fancier elements like <code>knobInput</code> from <a href="https://github.com/dreamRs/shinyWidgets/blob/master/R/input-knob.R">shinyWidgets</a>, as depicted on Figure <a href="shiny-input-system.html#fig:fancy-inputs">8.1</a> or even more sophisticated inputs like the <code>smartSelect</code> of <a href="https://github.com/RinteRface/shinyMobile/blob/master/R/f7-inputs.R">shinyMobile</a> (Figure <a href="shiny-input-system.html#fig:fancy-inputs">8.1</a>, right panel). Have you ever wondered what are the mechanisms behind inputs? Have you ever dreamt to develop your own?</p>
<p>The goal of this section is to understand how Shiny inputs work and how to create new ones.</p>
<div class="figure"><span id="fig:fancy-inputs"></span>
<img src="images/survival-kit/jquery-knobs.png" alt="Custom shiny inputs. left: knobInput from shinyWidgets; right: smart select from shinyMobile" width="50%" /><img src="images/survival-kit/smart-select.png" alt="Custom shiny inputs. left: knobInput from shinyWidgets; right: smart select from shinyMobile" width="50%" />
<p class="caption">
FIGURE 8.1: Custom shiny inputs. left: knobInput from shinyWidgets; right: smart select from shinyMobile
</p>
</div>
<div id="input-bindings" class="section level2">
<h2><span class="header-section-number">8.1</span> Input bindings</h2>
<p>When we run our app, most of the time it works just fine! The question is, how are the inputs (and outputs) handled to allow this to happen? Upon initialization, Shiny runs several JavaScript functions. Some are accessible to the programmer (see a usecase <a href="https://stackoverflow.com/questions/51633326/dateinput-not-working-on-dt-in-shiny">here</a>). To illustrate what they do, let’s run the app below.</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="shiny-input-system.html#cb189-1"></a><span class="kw">library</span>(shiny)</span>
<span id="cb189-2"><a href="shiny-input-system.html#cb189-2"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb189-3"><a href="shiny-input-system.html#cb189-3"></a>  <span class="kw">sliderInput</span>(<span class="st">&quot;obs&quot;</span>, <span class="st">&quot;Number of observations:&quot;</span>,</span>
<span id="cb189-4"><a href="shiny-input-system.html#cb189-4"></a>              <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="dv">1000</span>, <span class="dt">value =</span> <span class="dv">500</span></span>
<span id="cb189-5"><a href="shiny-input-system.html#cb189-5"></a>  ),</span>
<span id="cb189-6"><a href="shiny-input-system.html#cb189-6"></a>  <span class="kw">plotOutput</span>(<span class="st">&quot;distPlot&quot;</span>)</span>
<span id="cb189-7"><a href="shiny-input-system.html#cb189-7"></a>)</span>
<span id="cb189-8"><a href="shiny-input-system.html#cb189-8"></a></span>
<span id="cb189-9"><a href="shiny-input-system.html#cb189-9"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session) {</span>
<span id="cb189-10"><a href="shiny-input-system.html#cb189-10"></a>  output<span class="op">$</span>distPlot &lt;-<span class="st"> </span><span class="kw">renderPlot</span>({</span>
<span id="cb189-11"><a href="shiny-input-system.html#cb189-11"></a>    <span class="kw">hist</span>(<span class="kw">rnorm</span>(input<span class="op">$</span>obs))</span>
<span id="cb189-12"><a href="shiny-input-system.html#cb189-12"></a>  })</span>
<span id="cb189-13"><a href="shiny-input-system.html#cb189-13"></a>}</span>
<span id="cb189-14"><a href="shiny-input-system.html#cb189-14"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
<p>We then open the HTML inspector and run <code>Shiny.unbindAll(document)</code> (document is the scope, that is where to search). Try to change the slider input. You will notice that nothing happens. Now let’s type <code>Shiny.bindAll(document)</code> and update the slider value. Moving the slider successfully update the plot. Magic isn’t it? This simply shows that when inputs are not bound, nothing happens so binding inputs is necessary.</p>
<p>We consider another example with multiple inputs.</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="shiny-input-system.html#cb190-1"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb190-2"><a href="shiny-input-system.html#cb190-2"></a>  <span class="kw">actionButton</span>(<span class="st">&quot;unbind&quot;</span>, <span class="st">&quot;Unbind inputs&quot;</span>, <span class="dt">onclick =</span> <span class="st">&quot;Shiny.unbindAll();&quot;</span>),</span>
<span id="cb190-3"><a href="shiny-input-system.html#cb190-3"></a>  <span class="kw">actionButton</span>(<span class="st">&quot;bind&quot;</span>, <span class="st">&quot;Bind inputs&quot;</span>, <span class="dt">onclick =</span> <span class="st">&quot;Shiny.bindAll();&quot;</span>),</span>
<span id="cb190-4"><a href="shiny-input-system.html#cb190-4"></a>  <span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="cf">function</span>(i) {</span>
<span id="cb190-5"><a href="shiny-input-system.html#cb190-5"></a>    <span class="kw">textInput</span>(<span class="kw">paste0</span>(<span class="st">&quot;text_&quot;</span>, i), <span class="kw">paste</span>(<span class="st">&quot;Text&quot;</span>, i))</span>
<span id="cb190-6"><a href="shiny-input-system.html#cb190-6"></a>  }),</span>
<span id="cb190-7"><a href="shiny-input-system.html#cb190-7"></a>  <span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="cf">function</span>(i) {</span>
<span id="cb190-8"><a href="shiny-input-system.html#cb190-8"></a>    <span class="kw">uiOutput</span>(<span class="kw">paste0</span>(<span class="st">&quot;val_&quot;</span>, i))</span>
<span id="cb190-9"><a href="shiny-input-system.html#cb190-9"></a>  })</span>
<span id="cb190-10"><a href="shiny-input-system.html#cb190-10"></a>)</span>
<span id="cb190-11"><a href="shiny-input-system.html#cb190-11"></a></span>
<span id="cb190-12"><a href="shiny-input-system.html#cb190-12"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session) {</span>
<span id="cb190-13"><a href="shiny-input-system.html#cb190-13"></a>  <span class="kw">lapply</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="cf">function</span>(i) {</span>
<span id="cb190-14"><a href="shiny-input-system.html#cb190-14"></a>    output[[<span class="kw">paste0</span>(<span class="st">&quot;val_&quot;</span>, i)]] &lt;-<span class="st"> </span><span class="kw">renderPrint</span>(input[[<span class="kw">paste0</span>(<span class="st">&quot;text_&quot;</span>, i)]])</span>
<span id="cb190-15"><a href="shiny-input-system.html#cb190-15"></a>  })</span>
<span id="cb190-16"><a href="shiny-input-system.html#cb190-16"></a>}</span>
<span id="cb190-17"><a href="shiny-input-system.html#cb190-17"></a></span>
<span id="cb190-18"><a href="shiny-input-system.html#cb190-18"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
<p>Let’s see below what is an input binding and how it works.</p>
<div id="input-structure" class="section level3">
<h3><span class="header-section-number">8.1.1</span> Input structure</h3>
<p>An input element is given by the <code>&lt;input&gt;</code> tag as well as several attributes.</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb191-1"><a href="shiny-input-system.html#cb191-1"></a><span class="kw">&lt;input</span><span class="ot"> id</span> <span class="ot">=</span> <span class="st">inputId</span><span class="ot"> type</span> <span class="ot">=</span> <span class="st">&quot;text&quot;</span><span class="ot"> class</span> <span class="ot">=</span> <span class="st">&quot;input-text&quot;</span><span class="ot"> value</span> <span class="ot">=</span> <span class="st">value</span><span class="kw">&gt;</span></span></code></pre></div>
<ul>
<li>id guarantees the input uniqueness. We will see very soon that all instances of the same input share a unique input binding, therefore id is mandatory.</li>
<li><a href="https://www.w3schools.com/tags/att_input_type.asp">type</a></li>
<li>class is targeted by CSS and JavaScript</li>
<li>value holds the input value</li>
</ul>
</div>
<div id="binding-shiny-inputs" class="section level3">
<h3><span class="header-section-number">8.1.2</span> Binding Shiny inputs</h3>
<p>An input binding allows Shiny to identify each instance of a given input and what you may do with this input. For instance, a slider input must update whenever the range is dragged or when the left and right arrows of the keyboard are pressed. It relies on a class defined in the <code>input_binding.js</code> <a href="https://github.com/rstudio/shiny/blob/master/srcjs/input_binding.js">file</a>.</p>
<p>Let’s describe each method chronologically. For better convenience, the book side package contains step by step demonstrations which may be found <a href="https://github.com/DivadNojnarg/outstanding-shiny-ui-code/blob/master/R/inputs.R">here</a>. Each example is called by the <code>customTextInputExample</code>, which takes the input binding step as only parameter. For instance <code>customTextInputExample(1)</code> will invoke the first step.</p>
<div id="find-the-input" class="section level4">
<h4><span class="header-section-number">8.1.2.1</span> Find the input</h4>
<p>The first step, is critical which is to locate the input in the DOM. On the R side, we define an input, with a specific attribute that will serve as a receptor for the binding. For most of inputs, this may be handled by the type attribute. In other cases, this may be the class, like for the <code>actionButton</code>. On the JS side, we need a method that will identify this receptor. Moreover, two different types of inputs (for instance <code>radioButton</code> and <code>selectInput</code>) cannot have the same receptor for conflict reasons, whereas two instances of the same input type can (if your app contains 10 sliders, they all share the same input binding!). The receptor identifier is provided by the <code>find</code> method of the <code>InputBinding</code> class. This method must be applied on a scope, that is the <code>document</code>. <code>find</code> accepts any valid jQuery selector. Note the <code>console.log</code> only here for debugging purpose.</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb192-1"><a href="shiny-input-system.html#cb192-1"></a>find<span class="op">:</span> <span class="kw">function</span>(scope) <span class="op">{</span></span>
<span id="cb192-2"><a href="shiny-input-system.html#cb192-2"></a>  <span class="va">console</span>.<span class="at">log</span>(<span class="at">$</span>(scope).<span class="at">find</span>(<span class="st">&#39;.input-text&#39;</span>))<span class="op">;</span></span>
<span id="cb192-3"><a href="shiny-input-system.html#cb192-3"></a>  <span class="cf">return</span> <span class="at">$</span>(scope).<span class="at">find</span>(<span class="st">&#39;.input-text&#39;</span>)<span class="op">;</span></span>
<span id="cb192-4"><a href="shiny-input-system.html#cb192-4"></a><span class="op">}</span></span></code></pre></div>
<p>Figure <a href="shiny-input-system.html#fig:shiny-find-inputs">8.2</a> summarizes this important step.</p>
<div class="figure"><span id="fig:shiny-find-inputs"></span>
<img src="images/survival-kit/shiny-find-inputs.png" alt="How to find inputs?" width="100%" />
<p class="caption">
FIGURE 8.2: How to find inputs?
</p>
</div>
<p>Below, we are going to create a new binding for the <code>textInput</code>, with only two methods mentioned in the previous section, that is <code>find</code> and <code>getValue</code>. For that, we need to create a customized text input, <code>customTextInput</code> to make it unique. We now add the <code>input-text</code> class and make our own input binding pointing to that specific class.</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="shiny-input-system.html#cb193-1"></a>customTextInput &lt;-<span class="st"> </span><span class="cf">function</span> (inputId, label, <span class="dt">value =</span> <span class="st">&quot;&quot;</span>, <span class="dt">width =</span> <span class="ot">NULL</span>, <span class="dt">placeholder =</span> <span class="ot">NULL</span>) {</span>
<span id="cb193-2"><a href="shiny-input-system.html#cb193-2"></a>  </span>
<span id="cb193-3"><a href="shiny-input-system.html#cb193-3"></a>  <span class="co"># this external wrapper ensure to control the input width</span></span>
<span id="cb193-4"><a href="shiny-input-system.html#cb193-4"></a>  <span class="kw">div</span>(</span>
<span id="cb193-5"><a href="shiny-input-system.html#cb193-5"></a>    <span class="dt">class =</span> <span class="st">&quot;form-group shiny-input-container&quot;</span>, </span>
<span id="cb193-6"><a href="shiny-input-system.html#cb193-6"></a>    <span class="dt">style =</span> <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.null</span>(width)) {</span>
<span id="cb193-7"><a href="shiny-input-system.html#cb193-7"></a>      <span class="kw">paste0</span>(<span class="st">&quot;width: &quot;</span>, <span class="kw">validateCssUnit</span>(width), <span class="st">&quot;;&quot;</span>)</span>
<span id="cb193-8"><a href="shiny-input-system.html#cb193-8"></a>    },</span>
<span id="cb193-9"><a href="shiny-input-system.html#cb193-9"></a>    <span class="co"># input label</span></span>
<span id="cb193-10"><a href="shiny-input-system.html#cb193-10"></a>    <span class="kw">shinyInputLabel</span>(inputId, label), </span>
<span id="cb193-11"><a href="shiny-input-system.html#cb193-11"></a>    </span>
<span id="cb193-12"><a href="shiny-input-system.html#cb193-12"></a>    <span class="co"># input element + JS dependencies</span></span>
<span id="cb193-13"><a href="shiny-input-system.html#cb193-13"></a>    <span class="kw">tagList</span>(</span>
<span id="cb193-14"><a href="shiny-input-system.html#cb193-14"></a>      <span class="kw">customTextInputDeps</span>(),</span>
<span id="cb193-15"><a href="shiny-input-system.html#cb193-15"></a>      tags<span class="op">$</span><span class="kw">input</span>(</span>
<span id="cb193-16"><a href="shiny-input-system.html#cb193-16"></a>        <span class="dt">id =</span> inputId,</span>
<span id="cb193-17"><a href="shiny-input-system.html#cb193-17"></a>        <span class="dt">type =</span> <span class="st">&quot;text&quot;</span>,</span>
<span id="cb193-18"><a href="shiny-input-system.html#cb193-18"></a>        <span class="dt">class =</span> <span class="st">&quot;form-control input-text&quot;</span>,</span>
<span id="cb193-19"><a href="shiny-input-system.html#cb193-19"></a>        <span class="dt">value =</span> value,</span>
<span id="cb193-20"><a href="shiny-input-system.html#cb193-20"></a>        <span class="dt">placeholder =</span> placeholder</span>
<span id="cb193-21"><a href="shiny-input-system.html#cb193-21"></a>      )</span>
<span id="cb193-22"><a href="shiny-input-system.html#cb193-22"></a>    )</span>
<span id="cb193-23"><a href="shiny-input-system.html#cb193-23"></a>  )</span>
<span id="cb193-24"><a href="shiny-input-system.html#cb193-24"></a>}</span></code></pre></div>
<p>The last part of the code contains a <code>tagList</code> with two elements:</p>
<ul>
<li>The element input binding</li>
<li>The input tag</li>
</ul>
<p>Below is an example of how we managed the dependency creation in our side package.
Considering multiple inputs, we will add more script to the dependency by passing a vector to the script parameter.</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="shiny-input-system.html#cb194-1"></a>customTextInputDeps &lt;-<span class="st"> </span><span class="cf">function</span>() {</span>
<span id="cb194-2"><a href="shiny-input-system.html#cb194-2"></a>  <span class="kw">htmlDependency</span>(</span>
<span id="cb194-3"><a href="shiny-input-system.html#cb194-3"></a>    <span class="dt">name =</span> <span class="st">&quot;customTextBindings&quot;</span>,</span>
<span id="cb194-4"><a href="shiny-input-system.html#cb194-4"></a>    <span class="dt">version =</span> <span class="st">&quot;1.0.0&quot;</span>,</span>
<span id="cb194-5"><a href="shiny-input-system.html#cb194-5"></a>    <span class="dt">src =</span> <span class="kw">c</span>(<span class="dt">file =</span> <span class="kw">system.file</span>(<span class="st">&quot;chapter5/input-bindings&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;OSUICode&quot;</span>)),</span>
<span id="cb194-6"><a href="shiny-input-system.html#cb194-6"></a>    <span class="dt">script =</span> <span class="st">&quot;customTextInputBinding.js&quot;</span></span>
<span id="cb194-7"><a href="shiny-input-system.html#cb194-7"></a>  )</span>
<span id="cb194-8"><a href="shiny-input-system.html#cb194-8"></a>}</span></code></pre></div>
<p>In the <a href="https://github.com/RinteRface/shinyMobile/tree/master/inst/framework7-5.5.0">shinyMobile</a> package, we chose a more robust approach. All bindings are contained in a folder and compressed so that we generate only one minified file containing all collapsed bindings.</p>
<p>Figure <a href="shiny-input-system.html#fig:text-input">8.3</a> shows the main elements of the <code>textInput</code> widget. In the above code, <code>shinyInputLabel</code> is a Shiny internal function that creates the numeric input label, or in other word the text displayed next to it. The core input element is wrapped by <code>tags$input</code>. No worry if the structure seems unclear, we will give more details about shiny tags in the Chapter <a href="htmltools-overview.html#htmltools-overview">3</a>.</p>
<div class="figure"><span id="fig:text-input"></span>
<img src="images/survival-kit/text-input.png" alt="Shiny's textInput elements" width="100%" />
<p class="caption">
FIGURE 8.3: Shiny’s textInput elements
</p>
</div>
<p>We invite the reader to run the first example below and open the HTML inspector and look at the <code>console.log</code> result.</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="shiny-input-system.html#cb195-1"></a><span class="kw">customTextInputExample</span>(<span class="dv">1</span>)</span></code></pre></div>
<p>Results are shown on Figure <a href="shiny-input-system.html#fig:shiny-find-inputs-result">8.4</a>. If the corresponding input is found, you should see the corresponding tag element in the HTML inspector console.</p>
<div class="figure"><span id="fig:shiny-find-inputs-result"></span>
<img src="images/survival-kit/shiny-find-inputs-result.png" alt="find method output" width="100%" />
<p class="caption">
FIGURE 8.4: find method output
</p>
</div>
</div>
<div id="initialize-inputs" class="section level4">
<h4><span class="header-section-number">8.1.2.2</span> Initialize inputs</h4>
<p>Upon initialization, Shiny calls the <code>initializeInputs</code> function that takes all input bindings and call their <code>initialize</code> method before binding all inputs. Note that once an input has been initialized it has a <code>_shiny_initialized</code> tag to avoid initializing it twice. The initialize method is not always defined but some elements require to be explicitly initialized or activated. For instance the <a href="https://framework7.io">Framework7</a> API, on top of which <a href="https://github.com/RinteRface/shinyMobile">shinyMobile</a> is built, require to instantiate all elements. Below is an example for the <a href="https://framework7.io/docs/toggle.html">toggle</a> input:</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb196-1"><a href="shiny-input-system.html#cb196-1"></a><span class="co">// what is expected</span></span>
<span id="cb196-2"><a href="shiny-input-system.html#cb196-2"></a><span class="kw">let</span> toggle <span class="op">=</span> <span class="va">app</span>.<span class="va">toggle</span>.<span class="at">create</span>(<span class="op">{</span></span>
<span id="cb196-3"><a href="shiny-input-system.html#cb196-3"></a>  <span class="dt">el</span><span class="op">:</span> <span class="st">&#39;.toggle&#39;</span><span class="op">,</span></span>
<span id="cb196-4"><a href="shiny-input-system.html#cb196-4"></a>  <span class="dt">on</span><span class="op">:</span> <span class="op">{</span></span>
<span id="cb196-5"><a href="shiny-input-system.html#cb196-5"></a>    <span class="dt">change</span><span class="op">:</span> <span class="kw">function</span> () <span class="op">{</span></span>
<span id="cb196-6"><a href="shiny-input-system.html#cb196-6"></a>      <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;Toggle changed&#39;</span>)</span>
<span id="cb196-7"><a href="shiny-input-system.html#cb196-7"></a>    <span class="op">}</span></span>
<span id="cb196-8"><a href="shiny-input-system.html#cb196-8"></a>  <span class="op">}</span></span>
<span id="cb196-9"><a href="shiny-input-system.html#cb196-9"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p><code>el: '.toggle'</code> means that we are looking at the element(s) having the <code>toggle</code> class. <code>app.toggle.create</code> is internal to the Framework7 API. The corresponding shinyMobile input binding starts as follows.</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb197-1"><a href="shiny-input-system.html#cb197-1"></a><span class="kw">var</span> f7ToggleBinding <span class="op">=</span> <span class="kw">new</span> <span class="va">Shiny</span>.<span class="at">InputBinding</span>()<span class="op">;</span></span>
<span id="cb197-2"><a href="shiny-input-system.html#cb197-2"></a>  <span class="va">$</span>.<span class="at">extend</span>(f7ToggleBinding<span class="op">,</span> <span class="op">{</span></span>
<span id="cb197-3"><a href="shiny-input-system.html#cb197-3"></a>    <span class="dt">initialize</span><span class="op">:</span> <span class="kw">function</span>(el) <span class="op">{</span></span>
<span id="cb197-4"><a href="shiny-input-system.html#cb197-4"></a>      <span class="va">app</span>.<span class="va">toggle</span>.<span class="at">create</span>(<span class="op">{</span><span class="dt">el</span><span class="op">:</span> el<span class="op">}</span>)<span class="op">;</span></span>
<span id="cb197-5"><a href="shiny-input-system.html#cb197-5"></a>    <span class="op">},</span></span>
<span id="cb197-6"><a href="shiny-input-system.html#cb197-6"></a>    <span class="co">// other methods</span></span>
<span id="cb197-7"><a href="shiny-input-system.html#cb197-7"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>Once initialized, we may use all specific methods provided by the API. <a href="https://framework7.io">Framework7</a> is clearly a gold mine, as its API provides many possible options for many inputs / widgets.</p>
</div>
<div id="get-the-value" class="section level4">
<h4><span class="header-section-number">8.1.2.3</span> Get the value</h4>
<p><code>getValue(el)</code> returns the input value. The way to obtain the value is different for almost all inputs. For instance, the <code>textInput</code> is pretty simple since the value is located in the <code>value</code> attribute. <code>el</code> refers to the element holding the id attribute and recognized by the <code>find</code> method. Figure <a href="shiny-input-system.html#fig:shiny-el">8.5</a> shows the result of a <code>console.log($(el));</code>.</p>
<div class="figure"><span id="fig:shiny-el"></span>
<img src="images/survival-kit/shiny-el.png" alt="About el" width="100%" />
<p class="caption">
FIGURE 8.5: About el
</p>
</div>
<div class="sourceCode" id="cb198"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb198-1"><a href="shiny-input-system.html#cb198-1"></a>getValue<span class="op">:</span> <span class="kw">function</span>(el) <span class="op">{</span></span>
<span id="cb198-2"><a href="shiny-input-system.html#cb198-2"></a>  <span class="va">console</span>.<span class="at">log</span>(<span class="at">$</span>(el))<span class="op">;</span></span>
<span id="cb198-3"><a href="shiny-input-system.html#cb198-3"></a>  <span class="cf">return</span> <span class="at">$</span>(el).<span class="at">val</span>()<span class="op">;</span></span>
<span id="cb198-4"><a href="shiny-input-system.html#cb198-4"></a><span class="op">}</span></span></code></pre></div>
<p>To get the value, we apply the jQuery method <code>val</code> on the <code>$(el)</code> element and return the result.</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="shiny-input-system.html#cb199-1"></a><span class="kw">customTextInputExample</span>(<span class="dv">2</span>)</span></code></pre></div>
<p>This time, the input value is returned. Notice that when you try to change the text content, the output value does not update as we would normally expect. We are actually missing a couple of methods so that the binding is fully working. We will introduce them in the following sections!</p>
</div>
<div id="set-and-update" class="section level4">
<h4><span class="header-section-number">8.1.2.4</span> Set and update</h4>
<p><code>setValue(el, value)</code> is used to set the value of the current input. This method is necessary so that the input value may be updated. It has to be used in combination with <code>receiveMessage(el, data)</code>, which is the JavaScript part of all the R <code>updateInput</code> functions. We usually call the <code>setValue</code> method inside.</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb200-1"><a href="shiny-input-system.html#cb200-1"></a>setValue<span class="op">:</span> <span class="kw">function</span>(el<span class="op">,</span> value) <span class="op">{</span></span>
<span id="cb200-2"><a href="shiny-input-system.html#cb200-2"></a>  <span class="at">$</span>(el).<span class="at">val</span>(value)<span class="op">;</span></span>
<span id="cb200-3"><a href="shiny-input-system.html#cb200-3"></a><span class="op">}</span></span></code></pre></div>
<p>Let’s create a function to update our custom text input. Call it <code>updateCustomTextInput</code>. It requires at least 3 parameters:</p>
<ul>
<li>inputId tells which input to update.</li>
<li>value is the new value. This will be taken by the <code>setValue</code> JS method in the input binding</li>
<li>session is the Shiny session object mentioned earlier. We will use the <code>sendInputMessage</code> to send values from R to JavaScript. The <code>receiveMessage</code> method will apply <code>setValue</code> with the data received from R.</li>
</ul>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="shiny-input-system.html#cb201-1"></a>updateCustomTextInput &lt;-<span class="st"> </span><span class="cf">function</span>(inputId, <span class="dt">value =</span> <span class="ot">NULL</span>, <span class="dt">session =</span> <span class="kw">getDefaultReactiveDomain</span>()) {</span>
<span id="cb201-2"><a href="shiny-input-system.html#cb201-2"></a>  session<span class="op">$</span><span class="kw">sendInputMessage</span>(inputId, <span class="dt">message =</span> value)</span>
<span id="cb201-3"><a href="shiny-input-system.html#cb201-3"></a>}</span></code></pre></div>
<p>We add <code>setValue</code> and <code>receiveMessage</code> to custom input binding.</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="shiny-input-system.html#cb202-1"></a><span class="kw">updateCustomTextInputExample</span>(<span class="dv">3</span>)</span></code></pre></div>
<p>Figure <a href="shiny-input-system.html#fig:shiny-update-inputs">8.6</a> illustrates the main mechanisms.</p>
<div class="figure"><span id="fig:shiny-update-inputs"></span>
<img src="images/survival-kit/shiny-update-inputs.png" alt="Events following a click on the update button. This figure demonstrates how R and JS communicate, through the websocket." width="100%" />
<p class="caption">
FIGURE 8.6: Events following a click on the update button. This figure demonstrates how R and JS communicate, through the websocket.
</p>
</div>
<p>If we have to pass multiple elements to update, we would have to change the <code>updateCustomTextInput</code> function such as:</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="shiny-input-system.html#cb203-1"></a>updateCustomTextInput &lt;-<span class="st"> </span><span class="cf">function</span>(inputId, <span class="dt">value =</span> <span class="ot">NULL</span>, <span class="dt">placeholder =</span> <span class="ot">NULL</span>, <span class="dt">session =</span> <span class="kw">getDefaultReactiveDomain</span>()) {</span>
<span id="cb203-2"><a href="shiny-input-system.html#cb203-2"></a>  message &lt;-<span class="st"> </span><span class="kw">dropNulls</span>(</span>
<span id="cb203-3"><a href="shiny-input-system.html#cb203-3"></a>    <span class="kw">list</span>(</span>
<span id="cb203-4"><a href="shiny-input-system.html#cb203-4"></a>      <span class="dt">value =</span> value,</span>
<span id="cb203-5"><a href="shiny-input-system.html#cb203-5"></a>      <span class="dt">placeholder =</span> placeholder</span>
<span id="cb203-6"><a href="shiny-input-system.html#cb203-6"></a>    )</span>
<span id="cb203-7"><a href="shiny-input-system.html#cb203-7"></a>  )</span>
<span id="cb203-8"><a href="shiny-input-system.html#cb203-8"></a>  session<span class="op">$</span><span class="kw">sendInputMessage</span>(inputId, message)</span>
<span id="cb203-9"><a href="shiny-input-system.html#cb203-9"></a>}</span></code></pre></div>
<p><code>dropNulls</code> is an internal function ensuring that the list does not contain NULL elements. We send a list from R, which is then serialized to a JSON object. In the <code>receiveMessage</code> method, properties like <code>value</code> may be accessed using the . notation:</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb204-1"><a href="shiny-input-system.html#cb204-1"></a>receiveMessage<span class="op">:</span> <span class="kw">function</span>(el<span class="op">,</span> data) <span class="op">{</span></span>
<span id="cb204-2"><a href="shiny-input-system.html#cb204-2"></a>  <span class="va">console</span>.<span class="at">log</span>(data)<span class="op">;</span></span>
<span id="cb204-3"><a href="shiny-input-system.html#cb204-3"></a>  <span class="cf">if</span> (<span class="va">data</span>.<span class="at">hasOwnProperty</span>(<span class="st">&#39;value&#39;</span>)) <span class="op">{</span></span>
<span id="cb204-4"><a href="shiny-input-system.html#cb204-4"></a>    <span class="kw">this</span>.<span class="at">setValue</span>(el<span class="op">,</span> <span class="va">data</span>.<span class="at">value</span>)<span class="op">;</span></span>
<span id="cb204-5"><a href="shiny-input-system.html#cb204-5"></a>  <span class="op">}</span></span>
<span id="cb204-6"><a href="shiny-input-system.html#cb204-6"></a>  <span class="co">// other parameters to update...</span></span>
<span id="cb204-7"><a href="shiny-input-system.html#cb204-7"></a><span class="op">}</span></span></code></pre></div>
<p>So far so good! We managed to update the text input value. Yet, after clicking the button, the output value does not change. We are going to fix this missing step in the next section.</p>
</div>
<div id="subscribe" class="section level4">
<h4><span class="header-section-number">8.1.2.5</span> Subscribe</h4>
<p><code>subscribe(el, callback)</code> listens to events defining Shiny to update the input value and make it available in the app. Some API like Bootstrap explicitly mention those events (like <code>hide.bs.tab</code>, <code>shown.bs.tab</code>, …).
Going back to our custom text input, what event would make it change?</p>
<ul>
<li>After a key is release on the keyboard. We may listen to <code>keyup</code></li>
<li>After copying and pasting any text in the input field or dictating text. The <code>input</code> event may be helpful</li>
</ul>
<p>We may add those <a href="https://javascript.info/events-change-input">events</a> to our binding using an event listener seen at the end of Chapter <a href="survival-kit-javascript.html#survival-kit-javascript">6</a>.</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb205-1"><a href="shiny-input-system.html#cb205-1"></a><span class="at">$</span>(el).<span class="at">on</span>(<span class="st">&#39;keyup.customTextBinding input.customTextBinding&#39;</span><span class="op">,</span> <span class="kw">function</span>(event) <span class="op">{</span></span>
<span id="cb205-2"><a href="shiny-input-system.html#cb205-2"></a>  <span class="at">callback</span>(<span class="kw">true</span>)<span class="op">;</span></span>
<span id="cb205-3"><a href="shiny-input-system.html#cb205-3"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p><code>callback</code> ensures that the new value is captured by Shiny. We will come back later on the callback parameter.</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="shiny-input-system.html#cb206-1"></a><span class="kw">updateCustomTextInputExample</span>(<span class="dv">4</span>)</span></code></pre></div>
<p>Hooray! The output result is successfully changed when the input value is manually updated. However, nothing happens when we click on the update button. What did we miss? Looking back at the <code>receiveMessage</code> method, we changed the input value but how does Shiny knows that this step was successful? To check that no event is raised, we put a <code>console.log(event);</code> in the <code>subscribe</code> method. Any action like removing the text content or adding new text triggers event but clicking on the action button does not. Therefore, we must trigger an event and add it to the <code>subscribe</code> method. We may choose the <code>change</code> event, that triggers when an element is updated.</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb207-1"><a href="shiny-input-system.html#cb207-1"></a><span class="at">$</span>(el).<span class="at">on</span>(<span class="st">&#39;change.customTextBinding&#39;</span><span class="op">,</span> <span class="kw">function</span>(event) <span class="op">{</span></span>
<span id="cb207-2"><a href="shiny-input-system.html#cb207-2"></a>  <span class="at">callback</span>(<span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb207-3"><a href="shiny-input-system.html#cb207-3"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>Let’s try again.</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="shiny-input-system.html#cb208-1"></a><span class="kw">updateCustomTextInputExample</span>(<span class="dv">5</span>)</span></code></pre></div>
<p>Perfect? Not exactly.</p>
</div>
<div id="setting-rate-policies" class="section level4">
<h4><span class="header-section-number">8.1.2.6</span> Setting rate policies</h4>
<p>It would be better to only change the input value once the keyboard is completely released for some time (and not each time a key is released). This is what we call debouncing, which allows a delay before telling Shiny to read the new value, and is achieved using the <code>getRatePolicy</code> method. Additionally, we must also pass <code>true</code> to the <code>callback</code> in the subscribe method, in order to apply our specific rate policy (<a href="https://davidwalsh.name/javascript-debounce-function">debounce</a>, throttle). This is useful for instance when we don’t want to flood the server with useless update requests. For example when using a slider, we only want to send the value as soon as the range stops moving and not all intermediate values. Those elements are defined <a href="https://github.com/rstudio/shiny/blob/master/srcjs/input_rate.js">here</a>.</p>
<p>Run the app below and try to manually change the text input value by adding a couple of letters as fast as you can. What do you notice? We see the output value only updates when we release the keyboard.</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="shiny-input-system.html#cb209-1"></a><span class="kw">customTextInputExample</span>(<span class="dv">6</span>)</span></code></pre></div>
<p>You may adjust the delay according to your needs, but we caution to not set the delay too long as this becomes problematic too.</p>
</div>
<div id="register-an-input-binding" class="section level4">
<h4><span class="header-section-number">8.1.2.7</span> Register an input binding</h4>
<p>At the end of the input binding definition, we register it for Shiny.</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb210-1"><a href="shiny-input-system.html#cb210-1"></a><span class="kw">let</span> myBinding <span class="op">=</span> <span class="kw">new</span> <span class="va">Shiny</span>.<span class="at">inputBinding</span>()<span class="op">;</span></span>
<span id="cb210-2"><a href="shiny-input-system.html#cb210-2"></a>  <span class="va">$</span>.<span class="at">extend</span>(myBinding<span class="op">,</span> <span class="op">{</span></span>
<span id="cb210-3"><a href="shiny-input-system.html#cb210-3"></a>  <span class="co">// methods go here</span></span>
<span id="cb210-4"><a href="shiny-input-system.html#cb210-4"></a><span class="op">}</span>)<span class="op">;</span></span>
<span id="cb210-5"><a href="shiny-input-system.html#cb210-5"></a></span>
<span id="cb210-6"><a href="shiny-input-system.html#cb210-6"></a><span class="va">Shiny</span>.<span class="va">inputBindings</span>.<span class="at">register</span>(myBinding<span class="op">,</span> <span class="st">&#39;reference&#39;</span>)<span class="op">;</span></span></code></pre></div>
<p>Although the Shiny <a href="https://shiny.rstudio.com/articles/building-inputs.html">documentation</a> mentions a <code>Shiny.inputBindings.setPriority</code> method to handle conflicting bindings, this case almost never happens.</p>
</div>
</div>
<div id="edit-an-input-binding" class="section level3">
<h3><span class="header-section-number">8.1.3</span> Edit an input binding</h3>
<p>In some cases, we would like to access the input binding and change it’s default behavior, even though not always recommended, since it will affect <strong>all</strong> related inputs. As bindings are contained in a registry, namely <code>Shiny.inputBindings</code>, one may seamlessly access and modify them. This is a 5 steps process:</p>
<ol style="list-style-type: decimal">
<li>Wait for the <code>shiny:connected</code> <a href="https://shiny.rstudio.com/articles/js-events.html">event</a></li>
<li>Unbind all inputs with <code>Shiny.unbindAll()</code></li>
<li>Access the binding registry, <code>Shiny.inputBindings</code></li>
<li>Extend the binding and edit its content with <code>$.extend(... {...})</code></li>
<li>Apply the new changes with <code>Shiny.bindAll()</code></li>
</ol>
<div class="sourceCode" id="cb211"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb211-1"><a href="shiny-input-system.html#cb211-1"></a><span class="at">$</span>(<span class="kw">function</span>() <span class="op">{</span></span>
<span id="cb211-2"><a href="shiny-input-system.html#cb211-2"></a>  <span class="at">$</span>(document).<span class="at">on</span>(<span class="st">&#39;shiny:connected&#39;</span><span class="op">,</span> <span class="kw">function</span>(event) <span class="op">{</span></span>
<span id="cb211-3"><a href="shiny-input-system.html#cb211-3"></a>    <span class="va">Shiny</span>.<span class="at">unbindAll</span>()<span class="op">;</span></span>
<span id="cb211-4"><a href="shiny-input-system.html#cb211-4"></a>    <span class="va">$</span>.<span class="at">extend</span>(Shiny</span>
<span id="cb211-5"><a href="shiny-input-system.html#cb211-5"></a>      .<span class="at">inputBindings</span></span>
<span id="cb211-6"><a href="shiny-input-system.html#cb211-6"></a>      .<span class="at">bindingNames</span>[<span class="st">&#39;shiny.actionButtonInput&#39;</span>]</span>
<span id="cb211-7"><a href="shiny-input-system.html#cb211-7"></a>      .<span class="at">binding</span><span class="op">,</span> <span class="op">{</span></span>
<span id="cb211-8"><a href="shiny-input-system.html#cb211-8"></a>        <span class="co">// do whathever you want to edit existing methods</span></span>
<span id="cb211-9"><a href="shiny-input-system.html#cb211-9"></a>      <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb211-10"><a href="shiny-input-system.html#cb211-10"></a>    <span class="va">Shiny</span>.<span class="at">bindAll</span>()<span class="op">;</span></span>
<span id="cb211-11"><a href="shiny-input-system.html#cb211-11"></a>  <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb211-12"><a href="shiny-input-system.html#cb211-12"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
</div>
<div id="update-a-binding-from-the-client" class="section level3">
<h3><span class="header-section-number">8.1.4</span> Update a binding from the client</h3>
<p>The interest of <code>receiveMessage</code> and <code>setValue</code> is to be able to update the input
from the server side, that is R, through the <code>session$sendInputMessage</code>. Yet,
this task might be done directly on the client, thereby lowering the load on the server.
We consider the following example: a shiny app contains 2 actions buttons, clicking on the first one
increases the value of the second by 10. This won’t be possible with the classic approach since a button click
only increases by 1. How do we proceed?</p>
<ol style="list-style-type: decimal">
<li>We first set an event listener on the first button.</li>
<li>We target the second button and get the input binding with <code>$obj.data('shiny-input-binding')</code></li>
<li>We recover the current value</li>
<li>We call the <code>setValue</code> method of the input binding adding 10 to the current value</li>
<li>Importantly, to let Shiny update the value on the R side, we must trigger an event that will be detected in the <code>subscribe</code> method of the action button input binding. The action button only has 1 event listener but other may be added. Don’t forget that triggering a <code>click</code> event would also increment the button value by 1! In the following we have to customize the <code>subscribe</code> method to work around</li>
</ol>
<div class="sourceCode" id="cb212"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb212-1"><a href="shiny-input-system.html#cb212-1"></a><span class="at">$</span>(<span class="kw">function</span>() <span class="op">{</span></span>
<span id="cb212-2"><a href="shiny-input-system.html#cb212-2"></a>  <span class="co">// each time we click on #test (a button)</span></span>
<span id="cb212-3"><a href="shiny-input-system.html#cb212-3"></a>  <span class="at">$</span>(<span class="st">&#39;#button1&#39;</span>).<span class="at">on</span>(<span class="st">&#39;click&#39;</span><span class="op">,</span> <span class="kw">function</span>() <span class="op">{</span></span>
<span id="cb212-4"><a href="shiny-input-system.html#cb212-4"></a>    <span class="kw">var</span> $obj <span class="op">=</span> <span class="at">$</span>(<span class="st">&#39;#button2&#39;</span>)<span class="op">;</span></span>
<span id="cb212-5"><a href="shiny-input-system.html#cb212-5"></a>    <span class="kw">var</span> inputBinding <span class="op">=</span> <span class="va">$obj</span>.<span class="at">data</span>(<span class="st">&#39;shiny-input-binding&#39;</span>)<span class="op">;</span></span>
<span id="cb212-6"><a href="shiny-input-system.html#cb212-6"></a>    <span class="kw">var</span> val <span class="op">=</span> <span class="va">$obj</span>.<span class="at">data</span>(<span class="st">&#39;val&#39;</span>) <span class="op">||</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb212-7"><a href="shiny-input-system.html#cb212-7"></a>    <span class="va">inputBinding</span>.<span class="at">setValue</span>($obj<span class="op">,</span> val <span class="op">+</span> <span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb212-8"><a href="shiny-input-system.html#cb212-8"></a>    <span class="va">$obj</span>.<span class="at">trigger</span>(<span class="st">&#39;event&#39;</span>)<span class="op">;</span></span>
<span id="cb212-9"><a href="shiny-input-system.html#cb212-9"></a>  <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb212-10"><a href="shiny-input-system.html#cb212-10"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>If you click on the second button, the value increments only by 1 and the plot will be only visible after 10 clicks, while only 1 click is necessary on the first button. The reset button resets the second action button value to 0. It implements the feature discussed in the previous part, where we extend the button binding to add a <code>reset</code> method and edit the <code>subscribe</code> method to add a <code>change</code> event listener, simply telling shiny to get the new value. Contrary to <code>click</code>, <code>change</code> does not increment the button value.</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb213-1"><a href="shiny-input-system.html#cb213-1"></a><span class="va">$</span>.<span class="at">extend</span>(<span class="va">Shiny</span>.<span class="va">inputBindings</span>.<span class="at">bindingNames</span>[<span class="st">&#39;shiny.actionButtonInput&#39;</span>].<span class="at">binding</span><span class="op">,</span> <span class="op">{</span></span>
<span id="cb213-2"><a href="shiny-input-system.html#cb213-2"></a>  <span class="dt">reset</span><span class="op">:</span> <span class="kw">function</span>(el) <span class="op">{</span></span>
<span id="cb213-3"><a href="shiny-input-system.html#cb213-3"></a>   <span class="at">$</span>(el).<span class="at">data</span>(<span class="st">&#39;val&#39;</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb213-4"><a href="shiny-input-system.html#cb213-4"></a>  <span class="op">},</span></span>
<span id="cb213-5"><a href="shiny-input-system.html#cb213-5"></a>  <span class="dt">subscribe</span><span class="op">:</span> <span class="kw">function</span>(el<span class="op">,</span> callback) <span class="op">{</span></span>
<span id="cb213-6"><a href="shiny-input-system.html#cb213-6"></a>    <span class="at">$</span>(el).<span class="at">on</span>(<span class="st">&#39;click.actionButtonInputBinding&#39;</span><span class="op">,</span> <span class="kw">function</span>(e) <span class="op">{</span></span>
<span id="cb213-7"><a href="shiny-input-system.html#cb213-7"></a>      <span class="kw">var</span> $el <span class="op">=</span> <span class="at">$</span>(<span class="kw">this</span>)<span class="op">;</span></span>
<span id="cb213-8"><a href="shiny-input-system.html#cb213-8"></a>      <span class="kw">var</span> val <span class="op">=</span> <span class="va">$el</span>.<span class="at">data</span>(<span class="st">&#39;val&#39;</span>) <span class="op">||</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb213-9"><a href="shiny-input-system.html#cb213-9"></a>      <span class="va">$el</span>.<span class="at">data</span>(<span class="st">&#39;val&#39;</span><span class="op">,</span> val <span class="op">+</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb213-10"><a href="shiny-input-system.html#cb213-10"></a></span>
<span id="cb213-11"><a href="shiny-input-system.html#cb213-11"></a>      <span class="at">callback</span>()<span class="op">;</span></span>
<span id="cb213-12"><a href="shiny-input-system.html#cb213-12"></a>    <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb213-13"><a href="shiny-input-system.html#cb213-13"></a>            </span>
<span id="cb213-14"><a href="shiny-input-system.html#cb213-14"></a>    <span class="co">// this does not trigger any click and won&#39;t change the button value            </span></span>
<span id="cb213-15"><a href="shiny-input-system.html#cb213-15"></a>    <span class="at">$</span>(el).<span class="at">on</span>(<span class="st">&#39;change.actionButtonInputBinding&#39;</span><span class="op">,</span> <span class="kw">function</span>(e) <span class="op">{</span></span>
<span id="cb213-16"><a href="shiny-input-system.html#cb213-16"></a>      <span class="at">callback</span>()<span class="op">;</span></span>
<span id="cb213-17"><a href="shiny-input-system.html#cb213-17"></a>    <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb213-18"><a href="shiny-input-system.html#cb213-18"></a>  <span class="op">}</span></span>
<span id="cb213-19"><a href="shiny-input-system.html#cb213-19"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>Below is the working app.</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="shiny-input-system.html#cb214-1"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb214-2"><a href="shiny-input-system.html#cb214-2"></a>  tags<span class="op">$</span><span class="kw">head</span>(</span>
<span id="cb214-3"><a href="shiny-input-system.html#cb214-3"></a>    tags<span class="op">$</span><span class="kw">script</span>(</span>
<span id="cb214-4"><a href="shiny-input-system.html#cb214-4"></a>      <span class="st">&quot;$(function() {</span></span>
<span id="cb214-5"><a href="shiny-input-system.html#cb214-5"></a><span class="st">        $(document).on(&#39;shiny:connected&#39;, function(event) {</span></span>
<span id="cb214-6"><a href="shiny-input-system.html#cb214-6"></a><span class="st">          Shiny.unbindAll();</span></span>
<span id="cb214-7"><a href="shiny-input-system.html#cb214-7"></a><span class="st">          $.extend(Shiny</span></span>
<span id="cb214-8"><a href="shiny-input-system.html#cb214-8"></a><span class="st">            .inputBindings</span></span>
<span id="cb214-9"><a href="shiny-input-system.html#cb214-9"></a><span class="st">            .bindingNames[&#39;shiny.actionButtonInput&#39;]</span></span>
<span id="cb214-10"><a href="shiny-input-system.html#cb214-10"></a><span class="st">            .binding, {</span></span>
<span id="cb214-11"><a href="shiny-input-system.html#cb214-11"></a><span class="st">              reset: function(el) {</span></span>
<span id="cb214-12"><a href="shiny-input-system.html#cb214-12"></a><span class="st">               $(el).data(&#39;val&#39;, 0);</span></span>
<span id="cb214-13"><a href="shiny-input-system.html#cb214-13"></a><span class="st">              },</span></span>
<span id="cb214-14"><a href="shiny-input-system.html#cb214-14"></a><span class="st">              subscribe: function(el, callback) {</span></span>
<span id="cb214-15"><a href="shiny-input-system.html#cb214-15"></a><span class="st">                $(el).on(&#39;click.actionButtonInputBinding&#39;, function(e) {</span></span>
<span id="cb214-16"><a href="shiny-input-system.html#cb214-16"></a><span class="st">                  var $el = $(this);</span></span>
<span id="cb214-17"><a href="shiny-input-system.html#cb214-17"></a><span class="st">                  var val = $el.data(&#39;val&#39;) || 0;</span></span>
<span id="cb214-18"><a href="shiny-input-system.html#cb214-18"></a><span class="st">                  $el.data(&#39;val&#39;, val + 1);</span></span>
<span id="cb214-19"><a href="shiny-input-system.html#cb214-19"></a></span>
<span id="cb214-20"><a href="shiny-input-system.html#cb214-20"></a><span class="st">                  callback();</span></span>
<span id="cb214-21"><a href="shiny-input-system.html#cb214-21"></a><span class="st">                });</span></span>
<span id="cb214-22"><a href="shiny-input-system.html#cb214-22"></a><span class="st">                </span></span>
<span id="cb214-23"><a href="shiny-input-system.html#cb214-23"></a><span class="st">                $(el).on(&#39;change.actionButtonInputBinding&#39;, function(e) {</span></span>
<span id="cb214-24"><a href="shiny-input-system.html#cb214-24"></a><span class="st">                  debugger;</span></span>
<span id="cb214-25"><a href="shiny-input-system.html#cb214-25"></a><span class="st">                  callback();</span></span>
<span id="cb214-26"><a href="shiny-input-system.html#cb214-26"></a><span class="st">                });</span></span>
<span id="cb214-27"><a href="shiny-input-system.html#cb214-27"></a><span class="st">              </span></span>
<span id="cb214-28"><a href="shiny-input-system.html#cb214-28"></a><span class="st">              }</span></span>
<span id="cb214-29"><a href="shiny-input-system.html#cb214-29"></a><span class="st">            });</span></span>
<span id="cb214-30"><a href="shiny-input-system.html#cb214-30"></a><span class="st">          Shiny.bindAll();</span></span>
<span id="cb214-31"><a href="shiny-input-system.html#cb214-31"></a><span class="st">        });</span></span>
<span id="cb214-32"><a href="shiny-input-system.html#cb214-32"></a><span class="st">      </span></span>
<span id="cb214-33"><a href="shiny-input-system.html#cb214-33"></a><span class="st">        $(&#39;#button1&#39;).on(&#39;click&#39;, function() {</span></span>
<span id="cb214-34"><a href="shiny-input-system.html#cb214-34"></a><span class="st">          var $obj = $(&#39;#button2&#39;);</span></span>
<span id="cb214-35"><a href="shiny-input-system.html#cb214-35"></a><span class="st">          var inputBinding = $obj.data(&#39;shiny-input-binding&#39;);</span></span>
<span id="cb214-36"><a href="shiny-input-system.html#cb214-36"></a><span class="st">          var val = $obj.data(&#39;val&#39;) || 0;</span></span>
<span id="cb214-37"><a href="shiny-input-system.html#cb214-37"></a><span class="st">          inputBinding.setValue($obj, val + 10);</span></span>
<span id="cb214-38"><a href="shiny-input-system.html#cb214-38"></a><span class="st">          $obj.trigger(&#39;change&#39;); </span></span>
<span id="cb214-39"><a href="shiny-input-system.html#cb214-39"></a><span class="st">        });</span></span>
<span id="cb214-40"><a href="shiny-input-system.html#cb214-40"></a><span class="st">        $(&#39;#reset&#39;).on(&#39;click&#39;, function() {</span></span>
<span id="cb214-41"><a href="shiny-input-system.html#cb214-41"></a><span class="st">          var $obj = $(&#39;#button2&#39;);</span></span>
<span id="cb214-42"><a href="shiny-input-system.html#cb214-42"></a><span class="st">          var inputBinding = $obj.data(&#39;shiny-input-binding&#39;);</span></span>
<span id="cb214-43"><a href="shiny-input-system.html#cb214-43"></a><span class="st">          inputBinding.reset($obj);</span></span>
<span id="cb214-44"><a href="shiny-input-system.html#cb214-44"></a><span class="st">          $obj.trigger(&#39;change&#39;);</span></span>
<span id="cb214-45"><a href="shiny-input-system.html#cb214-45"></a><span class="st">        });</span></span>
<span id="cb214-46"><a href="shiny-input-system.html#cb214-46"></a><span class="st">      });</span></span>
<span id="cb214-47"><a href="shiny-input-system.html#cb214-47"></a><span class="st">      &quot;</span></span>
<span id="cb214-48"><a href="shiny-input-system.html#cb214-48"></a>    )</span>
<span id="cb214-49"><a href="shiny-input-system.html#cb214-49"></a>  ),</span>
<span id="cb214-50"><a href="shiny-input-system.html#cb214-50"></a>  <span class="kw">actionButton</span>(<span class="st">&quot;button1&quot;</span>, <span class="kw">icon</span>(<span class="st">&quot;plus&quot;</span>)),</span>
<span id="cb214-51"><a href="shiny-input-system.html#cb214-51"></a>  <span class="kw">actionButton</span>(<span class="st">&quot;button2&quot;</span>, <span class="kw">uiOutput</span>(<span class="st">&quot;val&quot;</span>)),</span>
<span id="cb214-52"><a href="shiny-input-system.html#cb214-52"></a>  <span class="kw">actionButton</span>(<span class="st">&quot;reset&quot;</span>, <span class="kw">icon</span>(<span class="st">&quot;undo&quot;</span>)),</span>
<span id="cb214-53"><a href="shiny-input-system.html#cb214-53"></a>  <span class="kw">plotOutput</span>(<span class="st">&quot;plot&quot;</span>)</span>
<span id="cb214-54"><a href="shiny-input-system.html#cb214-54"></a>)</span>
<span id="cb214-55"><a href="shiny-input-system.html#cb214-55"></a></span>
<span id="cb214-56"><a href="shiny-input-system.html#cb214-56"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output) {</span>
<span id="cb214-57"><a href="shiny-input-system.html#cb214-57"></a>  output<span class="op">$</span>val &lt;-<span class="st"> </span><span class="kw">renderUI</span>({</span>
<span id="cb214-58"><a href="shiny-input-system.html#cb214-58"></a>    <span class="kw">paste</span>(<span class="st">&quot;Value: &quot;</span>, input<span class="op">$</span>button2)</span>
<span id="cb214-59"><a href="shiny-input-system.html#cb214-59"></a>  })</span>
<span id="cb214-60"><a href="shiny-input-system.html#cb214-60"></a>  </span>
<span id="cb214-61"><a href="shiny-input-system.html#cb214-61"></a>  output<span class="op">$</span>plot &lt;-<span class="st"> </span><span class="kw">renderPlot</span>({</span>
<span id="cb214-62"><a href="shiny-input-system.html#cb214-62"></a>    <span class="kw">validate</span>(<span class="kw">need</span>(input<span class="op">$</span>button2 <span class="op">&gt;=</span><span class="st"> </span><span class="dv">10</span>, <span class="dt">message =</span> <span class="st">&quot;Only visible after 10 clicks on the second button&quot;</span>))</span>
<span id="cb214-63"><a href="shiny-input-system.html#cb214-63"></a>    <span class="kw">hist</span>(<span class="kw">rnorm</span>(<span class="dv">100</span>))</span>
<span id="cb214-64"><a href="shiny-input-system.html#cb214-64"></a>  })</span>
<span id="cb214-65"><a href="shiny-input-system.html#cb214-65"></a>  </span>
<span id="cb214-66"><a href="shiny-input-system.html#cb214-66"></a>  <span class="kw">observeEvent</span>(input<span class="op">$</span>button2, {</span>
<span id="cb214-67"><a href="shiny-input-system.html#cb214-67"></a>    <span class="cf">if</span> (input<span class="op">$</span>button2 <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) {</span>
<span id="cb214-68"><a href="shiny-input-system.html#cb214-68"></a>      <span class="kw">showNotification</span>(</span>
<span id="cb214-69"><a href="shiny-input-system.html#cb214-69"></a>        <span class="st">&quot;Button successfuly reset&quot;</span>,</span>
<span id="cb214-70"><a href="shiny-input-system.html#cb214-70"></a>        <span class="dt">type =</span> <span class="st">&quot;warning&quot;</span></span>
<span id="cb214-71"><a href="shiny-input-system.html#cb214-71"></a>      )</span>
<span id="cb214-72"><a href="shiny-input-system.html#cb214-72"></a>    }</span>
<span id="cb214-73"><a href="shiny-input-system.html#cb214-73"></a>  })</span>
<span id="cb214-74"><a href="shiny-input-system.html#cb214-74"></a>}</span>
<span id="cb214-75"><a href="shiny-input-system.html#cb214-75"></a></span>
<span id="cb214-76"><a href="shiny-input-system.html#cb214-76"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
<p>This trick has been extensively used in the <a href="https://community.rstudio.com/t/shiny-contest-submission-a-virtual-lab-for-teaching-physiology/25348">virtual physiology simulator</a> to trigger <a href="https://dgranjon.shinyapps.io/entry_level/">animations</a>.</p>
</div>
</div>
<div id="examples" class="section level2">
<h2><span class="header-section-number">8.2</span> Examples</h2>
<div id="shinydashboard-boxes-on-steroids" class="section level3">
<h3><span class="header-section-number">8.2.1</span> {shinydashboard} boxes on steroids</h3>
<p>The Shiny input binding system is too convenient to be only used for input elements. In {shinydashboard}, you may know the <code>box</code> function. Boxes are containers with a title, body, footer, as well as optional elements. It would be nice to capture the state of the box in an input, so as to trigger other actions as soon as this input changes. Since an input value is unique, we must add an <code>inputId</code> parameter to the box function. You may inspect the code <a href="https://github.com/DivadNojnarg/outstanding-shiny-ui-code/blob/master/R/box2.R">here</a>.</p>
<p>Since we may collapse and uncollapse the box, we create the <code>updateBox2</code> function, which will toggle it:</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="shiny-input-system.html#cb215-1"></a>updateBox2 &lt;-<span class="st"> </span><span class="cf">function</span>(inputId, <span class="dt">session =</span> <span class="kw">getDefaultReactiveDomain</span>()) {</span>
<span id="cb215-2"><a href="shiny-input-system.html#cb215-2"></a>  session<span class="op">$</span><span class="kw">sendInputMessage</span>(inputId, <span class="dt">message =</span> <span class="ot">NULL</span>)</span>
<span id="cb215-3"><a href="shiny-input-system.html#cb215-3"></a>}</span></code></pre></div>
<p>When collapsed, a box gets the <code>collapsed-box</code> class. Note: this will be useful for the input binding. As mentioned above, it is also necessary to know when to tell Shiny to update the value with the <code>subscribe</code> method. Most of the time, the change event might be sufficient, but as shinydashboard is built on top of <a href="https://adminlte.io/docs/2.4/js-box-widget">AdminLTE2</a>, it has an API to control the box behavior. We identify 2 events corresponding to the collapsible action:</p>
<ul>
<li>expanded.boxwidget (Triggered after the box is expanded)</li>
<li>collapsed.boxwidget (Triggered after the box is collapsed)</li>
</ul>
<p>Unfortunately, after further investigations, those events are not possible to use since the AdminLTE code does not trigger them in the main JS <a href="https://github.com/rstudio/shinydashboard/blob/master/srcjs/AdminLTE/app.js">code</a> (see the collapse method line 577-612). There are other solutions, as shown below with the <code>click</code> event. To toggle the box, we use the <code>toggleBox</code> method.</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb216-1"><a href="shiny-input-system.html#cb216-1"></a><span class="kw">let</span> boxBinding <span class="op">=</span> <span class="kw">new</span> <span class="va">Shiny</span>.<span class="at">InputBinding</span>()<span class="op">;</span></span>
<span id="cb216-2"><a href="shiny-input-system.html#cb216-2"></a><span class="va">$</span>.<span class="at">extend</span>(boxBinding<span class="op">,</span> <span class="op">{</span></span>
<span id="cb216-3"><a href="shiny-input-system.html#cb216-3"></a>  <span class="dt">find</span><span class="op">:</span> <span class="kw">function</span>(scope) <span class="op">{</span></span>
<span id="cb216-4"><a href="shiny-input-system.html#cb216-4"></a>    <span class="cf">return</span> <span class="at">$</span>(scope).<span class="at">find</span>(<span class="st">&#39;.box&#39;</span>)<span class="op">;</span></span>
<span id="cb216-5"><a href="shiny-input-system.html#cb216-5"></a>  <span class="op">},</span></span>
<span id="cb216-6"><a href="shiny-input-system.html#cb216-6"></a>  <span class="dt">getValue</span><span class="op">:</span> <span class="kw">function</span>(el) <span class="op">{</span></span>
<span id="cb216-7"><a href="shiny-input-system.html#cb216-7"></a>    <span class="kw">let</span> isCollapsed <span class="op">=</span> <span class="at">$</span>(el).<span class="at">hasClass</span>(<span class="st">&#39;collapsed-box&#39;</span>)</span>
<span id="cb216-8"><a href="shiny-input-system.html#cb216-8"></a>    <span class="cf">return</span> <span class="op">{</span><span class="dt">collapsed</span><span class="op">:</span> isCollapsed<span class="op">};</span> <span class="co">// this will be a list in R</span></span>
<span id="cb216-9"><a href="shiny-input-system.html#cb216-9"></a>  <span class="op">},</span></span>
<span id="cb216-10"><a href="shiny-input-system.html#cb216-10"></a>  <span class="dt">setValue</span><span class="op">:</span> <span class="kw">function</span>(el<span class="op">,</span> value) <span class="op">{</span></span>
<span id="cb216-11"><a href="shiny-input-system.html#cb216-11"></a>    <span class="at">$</span>(el).<span class="at">toggleBox</span>()<span class="op">;</span></span>
<span id="cb216-12"><a href="shiny-input-system.html#cb216-12"></a>  <span class="op">},</span> </span>
<span id="cb216-13"><a href="shiny-input-system.html#cb216-13"></a>  <span class="dt">receiveMessage</span><span class="op">:</span> <span class="kw">function</span>(el<span class="op">,</span> data) <span class="op">{</span></span>
<span id="cb216-14"><a href="shiny-input-system.html#cb216-14"></a>    <span class="kw">this</span>.<span class="at">setValue</span>(el<span class="op">,</span> data)<span class="op">;</span></span>
<span id="cb216-15"><a href="shiny-input-system.html#cb216-15"></a>    <span class="at">$</span>(el).<span class="at">trigger</span>(<span class="st">&#39;change&#39;</span>)<span class="op">;</span></span>
<span id="cb216-16"><a href="shiny-input-system.html#cb216-16"></a>  <span class="op">},</span></span>
<span id="cb216-17"><a href="shiny-input-system.html#cb216-17"></a>  <span class="dt">subscribe</span><span class="op">:</span> <span class="kw">function</span>(el<span class="op">,</span> callback) <span class="op">{</span></span>
<span id="cb216-18"><a href="shiny-input-system.html#cb216-18"></a>    <span class="at">$</span>(el).<span class="at">on</span>(<span class="st">&#39;click&#39;</span><span class="op">,</span> <span class="st">&#39;[data-widget=&quot;collapse&quot;]&#39;</span><span class="op">,</span> <span class="kw">function</span>(event) <span class="op">{</span></span>
<span id="cb216-19"><a href="shiny-input-system.html#cb216-19"></a>      <span class="at">setTimeout</span>(<span class="kw">function</span>() <span class="op">{</span></span>
<span id="cb216-20"><a href="shiny-input-system.html#cb216-20"></a>        <span class="at">callback</span>()<span class="op">;</span></span>
<span id="cb216-21"><a href="shiny-input-system.html#cb216-21"></a>      <span class="op">},</span> <span class="dv">550</span>)<span class="op">;</span></span>
<span id="cb216-22"><a href="shiny-input-system.html#cb216-22"></a>    <span class="op">}</span>)<span class="op">;</span> </span>
<span id="cb216-23"><a href="shiny-input-system.html#cb216-23"></a>    </span>
<span id="cb216-24"><a href="shiny-input-system.html#cb216-24"></a>    <span class="at">$</span>(el).<span class="at">on</span>(<span class="st">&#39;change&#39;</span><span class="op">,</span> <span class="kw">function</span>(event) <span class="op">{</span></span>
<span id="cb216-25"><a href="shiny-input-system.html#cb216-25"></a>      <span class="at">setTimeout</span>(<span class="kw">function</span>() <span class="op">{</span></span>
<span id="cb216-26"><a href="shiny-input-system.html#cb216-26"></a>        <span class="at">callback</span>()<span class="op">;</span></span>
<span id="cb216-27"><a href="shiny-input-system.html#cb216-27"></a>      <span class="op">},</span> <span class="dv">550</span>)<span class="op">;</span></span>
<span id="cb216-28"><a href="shiny-input-system.html#cb216-28"></a>    <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb216-29"><a href="shiny-input-system.html#cb216-29"></a>  <span class="op">},</span></span>
<span id="cb216-30"><a href="shiny-input-system.html#cb216-30"></a>  <span class="dt">unsubscribe</span><span class="op">:</span> <span class="kw">function</span>(el) <span class="op">{</span></span>
<span id="cb216-31"><a href="shiny-input-system.html#cb216-31"></a>    <span class="at">$</span>(el).<span class="at">off</span>(<span class="st">&#39;.boxBinding&#39;</span>)<span class="op">;</span></span>
<span id="cb216-32"><a href="shiny-input-system.html#cb216-32"></a>  <span class="op">}</span></span>
<span id="cb216-33"><a href="shiny-input-system.html#cb216-33"></a><span class="op">}</span>)<span class="op">;</span></span>
<span id="cb216-34"><a href="shiny-input-system.html#cb216-34"></a></span>
<span id="cb216-35"><a href="shiny-input-system.html#cb216-35"></a><span class="va">Shiny</span>.<span class="va">inputBindings</span>.<span class="at">register</span>(boxBinding<span class="op">,</span> <span class="st">&#39;box-input&#39;</span>)<span class="op">;</span></span></code></pre></div>
<p>Some comments about the binding:</p>
<ul>
<li><code>getValue</code> returns an object which will give a list in R. This is in case we add other elements like the remove action available in AdminLTE</li>
<li><code>setValue</code> calls the plug and play <code>toggleBox</code> method</li>
<li><code>receiveMessage</code> must trigger a change event so that Shiny knows when the value needs to be updated</li>
<li><code>subscribe</code> listens to the <code>click</code> event on the <code>[data-widget="collapse"]</code> element and delays the <code>callback</code> call by a value which is slightly higher than the default AdminLTE2 animation to collapse the box (500mx). If you omit this part, the input will not have time to properly update!!!</li>
<li>We don’t need an extra listener for the <code>updateBox2</code> function since it also triggers a click on the collapse button, thereby forwarding to the corresponding listener</li>
</ul>
<p>Let’s try our new toy in a simple dashboard:</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="shiny-input-system.html#cb217-1"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb217-2"><a href="shiny-input-system.html#cb217-2"></a>  <span class="co"># import shinydashboard deps without the need of the dashboard template</span></span>
<span id="cb217-3"><a href="shiny-input-system.html#cb217-3"></a>  <span class="kw">useShinydashboard</span>(),</span>
<span id="cb217-4"><a href="shiny-input-system.html#cb217-4"></a></span>
<span id="cb217-5"><a href="shiny-input-system.html#cb217-5"></a>  tags<span class="op">$</span><span class="kw">style</span>(<span class="st">&quot;body { background-color: ghostwhite};&quot;</span>),</span>
<span id="cb217-6"><a href="shiny-input-system.html#cb217-6"></a></span>
<span id="cb217-7"><a href="shiny-input-system.html#cb217-7"></a>  <span class="kw">br</span>(),</span>
<span id="cb217-8"><a href="shiny-input-system.html#cb217-8"></a>  <span class="kw">box2</span>(</span>
<span id="cb217-9"><a href="shiny-input-system.html#cb217-9"></a>   <span class="dt">title =</span> <span class="kw">textOutput</span>(<span class="st">&quot;box_state&quot;</span>),</span>
<span id="cb217-10"><a href="shiny-input-system.html#cb217-10"></a>   <span class="st">&quot;Box body&quot;</span>,</span>
<span id="cb217-11"><a href="shiny-input-system.html#cb217-11"></a>   <span class="dt">inputId =</span> <span class="st">&quot;mybox&quot;</span>,</span>
<span id="cb217-12"><a href="shiny-input-system.html#cb217-12"></a>   <span class="dt">collapsible =</span> <span class="ot">TRUE</span>,</span>
<span id="cb217-13"><a href="shiny-input-system.html#cb217-13"></a>   <span class="kw">plotOutput</span>(<span class="st">&quot;plot&quot;</span>)</span>
<span id="cb217-14"><a href="shiny-input-system.html#cb217-14"></a>  ),</span>
<span id="cb217-15"><a href="shiny-input-system.html#cb217-15"></a>  <span class="kw">actionButton</span>(<span class="st">&quot;toggle_box&quot;</span>, <span class="st">&quot;Toggle Box&quot;</span>, <span class="dt">class =</span> <span class="st">&quot;bg-success&quot;</span>)</span>
<span id="cb217-16"><a href="shiny-input-system.html#cb217-16"></a> )</span>
<span id="cb217-17"><a href="shiny-input-system.html#cb217-17"></a></span>
<span id="cb217-18"><a href="shiny-input-system.html#cb217-18"></a> server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session) {</span>
<span id="cb217-19"><a href="shiny-input-system.html#cb217-19"></a>  output<span class="op">$</span>plot &lt;-<span class="st"> </span><span class="kw">renderPlot</span>({</span>
<span id="cb217-20"><a href="shiny-input-system.html#cb217-20"></a>    <span class="kw">req</span>(<span class="op">!</span>input<span class="op">$</span>mybox<span class="op">$</span>collapsed)</span>
<span id="cb217-21"><a href="shiny-input-system.html#cb217-21"></a>    <span class="kw">plot</span>(<span class="kw">rnorm</span>(<span class="dv">200</span>))</span>
<span id="cb217-22"><a href="shiny-input-system.html#cb217-22"></a>  })</span>
<span id="cb217-23"><a href="shiny-input-system.html#cb217-23"></a></span>
<span id="cb217-24"><a href="shiny-input-system.html#cb217-24"></a>  output<span class="op">$</span>box_state &lt;-<span class="st"> </span><span class="kw">renderText</span>({</span>
<span id="cb217-25"><a href="shiny-input-system.html#cb217-25"></a>    state &lt;-<span class="st"> </span><span class="cf">if</span> (input<span class="op">$</span>mybox<span class="op">$</span>collapsed) <span class="st">&quot;collapsed&quot;</span> <span class="cf">else</span> <span class="st">&quot;uncollapsed&quot;</span></span>
<span id="cb217-26"><a href="shiny-input-system.html#cb217-26"></a>    <span class="kw">paste</span>(<span class="st">&quot;My box is&quot;</span>, state)</span>
<span id="cb217-27"><a href="shiny-input-system.html#cb217-27"></a>  })</span>
<span id="cb217-28"><a href="shiny-input-system.html#cb217-28"></a></span>
<span id="cb217-29"><a href="shiny-input-system.html#cb217-29"></a>  <span class="kw">observeEvent</span>(input<span class="op">$</span>toggle_box, {</span>
<span id="cb217-30"><a href="shiny-input-system.html#cb217-30"></a>    <span class="kw">updateBox2</span>(<span class="st">&quot;mybox&quot;</span>)</span>
<span id="cb217-31"><a href="shiny-input-system.html#cb217-31"></a>  })</span>
<span id="cb217-32"><a href="shiny-input-system.html#cb217-32"></a></span>
<span id="cb217-33"><a href="shiny-input-system.html#cb217-33"></a> }</span>
<span id="cb217-34"><a href="shiny-input-system.html#cb217-34"></a></span>
<span id="cb217-35"><a href="shiny-input-system.html#cb217-35"></a> <span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
<p>Even though animations are nice, it appears rather sub-optimal to wait 500 ms for a box to collapse. AdminLTE <a href="https://adminlte.io/themes/AdminLTE/documentation/index.html#adminlte-options">options</a> allow to change this through the <code>$.AdminLTE.boxWidget</code> object. We specify the <code>animationSpeed</code> property to 10 milliseconds and update the input binding script to reduce the delay in the <code>subscribe</code> method (50 ms seems reasonable). To get a comparison try to run the example below.</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="shiny-input-system.html#cb218-1"></a><span class="co"># You&#39;ll need the devel version of shinydashboardPlus</span></span>
<span id="cb218-2"><a href="shiny-input-system.html#cb218-2"></a><span class="co">#remotes::install_github(&quot;RinteRface/shinydashboardPlus&quot;)</span></span>
<span id="cb218-3"><a href="shiny-input-system.html#cb218-3"></a></span>
<span id="cb218-4"><a href="shiny-input-system.html#cb218-4"></a><span class="kw">library</span>(shiny)</span>
<span id="cb218-5"><a href="shiny-input-system.html#cb218-5"></a><span class="kw">library</span>(shinydashboard)</span>
<span id="cb218-6"><a href="shiny-input-system.html#cb218-6"></a><span class="kw">library</span>(shinydashboardPlus)</span>
<span id="cb218-7"><a href="shiny-input-system.html#cb218-7"></a> </span>
<span id="cb218-8"><a href="shiny-input-system.html#cb218-8"></a> ui &lt;-<span class="st"> </span><span class="kw">dashboardPage</span>(</span>
<span id="cb218-9"><a href="shiny-input-system.html#cb218-9"></a>   <span class="kw">dashboardHeader</span>(),</span>
<span id="cb218-10"><a href="shiny-input-system.html#cb218-10"></a>   <span class="kw">dashboardSidebar</span>(),</span>
<span id="cb218-11"><a href="shiny-input-system.html#cb218-11"></a>   <span class="kw">dashboardBody</span>(</span>
<span id="cb218-12"><a href="shiny-input-system.html#cb218-12"></a>     tags<span class="op">$</span><span class="kw">style</span>(<span class="st">&quot;body { background-color: ghostwhite}&quot;</span>),</span>
<span id="cb218-13"><a href="shiny-input-system.html#cb218-13"></a>     <span class="kw">actionButton</span>(<span class="st">&quot;toggle_box&quot;</span>, <span class="st">&quot;Toggle Box&quot;</span>),</span>
<span id="cb218-14"><a href="shiny-input-system.html#cb218-14"></a>     <span class="kw">br</span>(),</span>
<span id="cb218-15"><a href="shiny-input-system.html#cb218-15"></a>     <span class="kw">box</span>(</span>
<span id="cb218-16"><a href="shiny-input-system.html#cb218-16"></a>       <span class="dt">title =</span> <span class="kw">textOutput</span>(<span class="st">&quot;box_state&quot;</span>),</span>
<span id="cb218-17"><a href="shiny-input-system.html#cb218-17"></a>       <span class="st">&quot;Box body&quot;</span>,</span>
<span id="cb218-18"><a href="shiny-input-system.html#cb218-18"></a>       <span class="dt">inputId =</span> <span class="st">&quot;mybox&quot;</span>,</span>
<span id="cb218-19"><a href="shiny-input-system.html#cb218-19"></a>       <span class="dt">collapsible =</span> <span class="ot">TRUE</span>,</span>
<span id="cb218-20"><a href="shiny-input-system.html#cb218-20"></a>       <span class="dt">closable =</span> <span class="ot">TRUE</span>,</span>
<span id="cb218-21"><a href="shiny-input-system.html#cb218-21"></a>       <span class="kw">plotOutput</span>(<span class="st">&quot;plot&quot;</span>)</span>
<span id="cb218-22"><a href="shiny-input-system.html#cb218-22"></a>     )</span>
<span id="cb218-23"><a href="shiny-input-system.html#cb218-23"></a>   )</span>
<span id="cb218-24"><a href="shiny-input-system.html#cb218-24"></a> )</span>
<span id="cb218-25"><a href="shiny-input-system.html#cb218-25"></a> </span>
<span id="cb218-26"><a href="shiny-input-system.html#cb218-26"></a> server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session) {</span>
<span id="cb218-27"><a href="shiny-input-system.html#cb218-27"></a>   output<span class="op">$</span>plot &lt;-<span class="st"> </span><span class="kw">renderPlot</span>({</span>
<span id="cb218-28"><a href="shiny-input-system.html#cb218-28"></a>     <span class="kw">req</span>(<span class="op">!</span>input<span class="op">$</span>mybox<span class="op">$</span>collapsed)</span>
<span id="cb218-29"><a href="shiny-input-system.html#cb218-29"></a>     <span class="kw">plot</span>(<span class="kw">rnorm</span>(<span class="dv">200</span>))</span>
<span id="cb218-30"><a href="shiny-input-system.html#cb218-30"></a>   })</span>
<span id="cb218-31"><a href="shiny-input-system.html#cb218-31"></a>   </span>
<span id="cb218-32"><a href="shiny-input-system.html#cb218-32"></a>   output<span class="op">$</span>box_state &lt;-<span class="st"> </span><span class="kw">renderText</span>({</span>
<span id="cb218-33"><a href="shiny-input-system.html#cb218-33"></a>     state &lt;-<span class="st"> </span><span class="cf">if</span> (input<span class="op">$</span>mybox<span class="op">$</span>collapsed) <span class="st">&quot;collapsed&quot;</span> <span class="cf">else</span> <span class="st">&quot;uncollapsed&quot;</span></span>
<span id="cb218-34"><a href="shiny-input-system.html#cb218-34"></a>     <span class="kw">paste</span>(<span class="st">&quot;My box is&quot;</span>, state)</span>
<span id="cb218-35"><a href="shiny-input-system.html#cb218-35"></a>   })</span>
<span id="cb218-36"><a href="shiny-input-system.html#cb218-36"></a>   </span>
<span id="cb218-37"><a href="shiny-input-system.html#cb218-37"></a>   <span class="kw">observeEvent</span>(input<span class="op">$</span>toggle_box, {</span>
<span id="cb218-38"><a href="shiny-input-system.html#cb218-38"></a>     <span class="kw">updateBox</span>(<span class="st">&quot;mybox&quot;</span>, <span class="dt">action =</span> <span class="st">&quot;toggle&quot;</span>)</span>
<span id="cb218-39"><a href="shiny-input-system.html#cb218-39"></a>   })</span>
<span id="cb218-40"><a href="shiny-input-system.html#cb218-40"></a>   </span>
<span id="cb218-41"><a href="shiny-input-system.html#cb218-41"></a>   </span>
<span id="cb218-42"><a href="shiny-input-system.html#cb218-42"></a>   <span class="kw">observeEvent</span>(input<span class="op">$</span>mybox<span class="op">$</span>collapsed, {</span>
<span id="cb218-43"><a href="shiny-input-system.html#cb218-43"></a>     collapsed &lt;-<span class="st"> </span><span class="cf">if</span> (input<span class="op">$</span>mybox<span class="op">$</span>collapsed) <span class="st">&quot;collapsed&quot;</span> <span class="cf">else</span> <span class="st">&quot;uncollapsed&quot;</span></span>
<span id="cb218-44"><a href="shiny-input-system.html#cb218-44"></a>     message &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;My box is&quot;</span>, collapsed)</span>
<span id="cb218-45"><a href="shiny-input-system.html#cb218-45"></a>     <span class="kw">showNotification</span>(message, <span class="dt">type =</span> <span class="st">&quot;warning&quot;</span>, <span class="dt">duration =</span> <span class="dv">1</span>)</span>
<span id="cb218-46"><a href="shiny-input-system.html#cb218-46"></a>   })</span>
<span id="cb218-47"><a href="shiny-input-system.html#cb218-47"></a>   </span>
<span id="cb218-48"><a href="shiny-input-system.html#cb218-48"></a> }</span>
<span id="cb218-49"><a href="shiny-input-system.html#cb218-49"></a> </span>
<span id="cb218-50"><a href="shiny-input-system.html#cb218-50"></a> <span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
</div>
<div id="going-further" class="section level3">
<h3><span class="header-section-number">8.2.2</span> Going further</h3>
<p>We may imagine leveraging the input binding system to update any box property and get rid of the classic <code>renderUI</code> approach. Indeed, until now, there would be only one way to update a box from the server:</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="shiny-input-system.html#cb219-1"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb219-2"><a href="shiny-input-system.html#cb219-2"></a>  <span class="co"># import shinydashboard deps without the need of the dashboard template</span></span>
<span id="cb219-3"><a href="shiny-input-system.html#cb219-3"></a>  <span class="kw">useShinydashboard</span>(),</span>
<span id="cb219-4"><a href="shiny-input-system.html#cb219-4"></a></span>
<span id="cb219-5"><a href="shiny-input-system.html#cb219-5"></a>  tags<span class="op">$</span><span class="kw">style</span>(<span class="st">&quot;body { background-color: ghostwhite};&quot;</span>),</span>
<span id="cb219-6"><a href="shiny-input-system.html#cb219-6"></a></span>
<span id="cb219-7"><a href="shiny-input-system.html#cb219-7"></a>  <span class="kw">br</span>(),</span>
<span id="cb219-8"><a href="shiny-input-system.html#cb219-8"></a>  <span class="kw">uiOutput</span>(<span class="st">&quot;custom_box&quot;</span>),</span>
<span id="cb219-9"><a href="shiny-input-system.html#cb219-9"></a>  <span class="kw">selectInput</span>(<span class="st">&quot;background&quot;</span>, <span class="st">&quot;Background&quot;</span>, <span class="dt">choices =</span> shinydashboard<span class="op">:::</span>validColors)</span>
<span id="cb219-10"><a href="shiny-input-system.html#cb219-10"></a> )</span>
<span id="cb219-11"><a href="shiny-input-system.html#cb219-11"></a></span>
<span id="cb219-12"><a href="shiny-input-system.html#cb219-12"></a> server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session) {</span>
<span id="cb219-13"><a href="shiny-input-system.html#cb219-13"></a>  output<span class="op">$</span>custom_box &lt;-<span class="st"> </span><span class="kw">renderUI</span>({</span>
<span id="cb219-14"><a href="shiny-input-system.html#cb219-14"></a>    <span class="kw">box2</span>(</span>
<span id="cb219-15"><a href="shiny-input-system.html#cb219-15"></a>      <span class="dt">title =</span> <span class="st">&quot;Box&quot;</span>,</span>
<span id="cb219-16"><a href="shiny-input-system.html#cb219-16"></a>      <span class="st">&quot;Box body&quot;</span>,</span>
<span id="cb219-17"><a href="shiny-input-system.html#cb219-17"></a>      <span class="dt">background =</span> input<span class="op">$</span>background</span>
<span id="cb219-18"><a href="shiny-input-system.html#cb219-18"></a>    )</span>
<span id="cb219-19"><a href="shiny-input-system.html#cb219-19"></a>  })</span>
<span id="cb219-20"><a href="shiny-input-system.html#cb219-20"></a> }</span>
<span id="cb219-21"><a href="shiny-input-system.html#cb219-21"></a></span>
<span id="cb219-22"><a href="shiny-input-system.html#cb219-22"></a> <span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
<p>The whole piece of UI is re-rendered each time, while only the box class should be modified. This does not have much impact here but for a very complex app festooned with inputs/outputs, the overall user experience may be altered.</p>
<p>To do so, we proceed in 2 steps. The first part consists in customizing the <code>box</code> function to gather as many parameter as possible in an option list. For instance, we choose to extract background, width and title. width and background are expected to be numeric and character, respectively, while title might be any HTML tag, justifying the use of <code>as.character</code>.</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="shiny-input-system.html#cb220-1"></a>box2 &lt;-<span class="st"> </span><span class="cf">function</span>(..., <span class="dt">id =</span> <span class="ot">NULL</span>, <span class="dt">title =</span> <span class="ot">NULL</span>, <span class="dt">footer =</span> <span class="ot">NULL</span>,</span>
<span id="cb220-2"><a href="shiny-input-system.html#cb220-2"></a>                 <span class="dt">background =</span> <span class="ot">NULL</span>, <span class="dt">width =</span> <span class="dv">6</span>, <span class="dt">height =</span> <span class="ot">NULL</span>,</span>
<span id="cb220-3"><a href="shiny-input-system.html#cb220-3"></a>                 <span class="dt">collapsible =</span> <span class="ot">FALSE</span>, <span class="dt">collapsed =</span> <span class="ot">FALSE</span>) {</span>
<span id="cb220-4"><a href="shiny-input-system.html#cb220-4"></a>  </span>
<span id="cb220-5"><a href="shiny-input-system.html#cb220-5"></a>  props &lt;-<span class="st"> </span><span class="kw">dropNulls</span>(</span>
<span id="cb220-6"><a href="shiny-input-system.html#cb220-6"></a>    <span class="kw">list</span>(</span>
<span id="cb220-7"><a href="shiny-input-system.html#cb220-7"></a>      <span class="dt">title =</span> <span class="kw">as.character</span>(title),</span>
<span id="cb220-8"><a href="shiny-input-system.html#cb220-8"></a>      <span class="dt">background =</span> background,</span>
<span id="cb220-9"><a href="shiny-input-system.html#cb220-9"></a>      <span class="dt">width =</span> width</span>
<span id="cb220-10"><a href="shiny-input-system.html#cb220-10"></a>    )</span>
<span id="cb220-11"><a href="shiny-input-system.html#cb220-11"></a>  )</span>
<span id="cb220-12"><a href="shiny-input-system.html#cb220-12"></a>  </span>
<span id="cb220-13"><a href="shiny-input-system.html#cb220-13"></a>  <span class="co"># I removed some of the code to highlight that part</span></span>
<span id="cb220-14"><a href="shiny-input-system.html#cb220-14"></a>}</span></code></pre></div>
<p>This properties list has to be treated on the JS side. Before, we must make it accessible within the <code>box2</code>
HTML tag. We choose the following approach, where we convert our properties to a JSON with <code>jsonlite::toJSON</code> and embed them in a script tag. Note the <code>data-for</code> attribute with the unique id parameter. This will guarantee the uniqueness of our configuration script.</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="shiny-input-system.html#cb221-1"></a>box2 &lt;-<span class="st"> </span><span class="cf">function</span>(..., <span class="dt">id =</span> <span class="ot">NULL</span>, <span class="dt">title =</span> <span class="ot">NULL</span>, <span class="dt">footer =</span> <span class="ot">NULL</span>,</span>
<span id="cb221-2"><a href="shiny-input-system.html#cb221-2"></a>                 <span class="dt">background =</span> <span class="ot">NULL</span>, <span class="dt">width =</span> <span class="dv">6</span>, <span class="dt">height =</span> <span class="ot">NULL</span>,</span>
<span id="cb221-3"><a href="shiny-input-system.html#cb221-3"></a>                 <span class="dt">collapsible =</span> <span class="ot">FALSE</span>, <span class="dt">collapsed =</span> <span class="ot">FALSE</span>) {</span>
<span id="cb221-4"><a href="shiny-input-system.html#cb221-4"></a>  </span>
<span id="cb221-5"><a href="shiny-input-system.html#cb221-5"></a>  <span class="co"># code not shown</span></span>
<span id="cb221-6"><a href="shiny-input-system.html#cb221-6"></a>  </span>
<span id="cb221-7"><a href="shiny-input-system.html#cb221-7"></a>  boxTag &lt;-<span class="st"> </span>shiny<span class="op">::</span>tags<span class="op">$</span><span class="kw">div</span>(</span>
<span id="cb221-8"><a href="shiny-input-system.html#cb221-8"></a>    <span class="dt">class =</span> <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.null</span>(width)) <span class="kw">paste0</span>(<span class="st">&quot;col-sm-&quot;</span>, width), </span>
<span id="cb221-9"><a href="shiny-input-system.html#cb221-9"></a>    shiny<span class="op">::</span>tags<span class="op">$</span><span class="kw">div</span>(</span>
<span id="cb221-10"><a href="shiny-input-system.html#cb221-10"></a>      <span class="dt">id =</span> id,</span>
<span id="cb221-11"><a href="shiny-input-system.html#cb221-11"></a>      <span class="dt">class =</span> boxClass, </span>
<span id="cb221-12"><a href="shiny-input-system.html#cb221-12"></a>      headerTag, </span>
<span id="cb221-13"><a href="shiny-input-system.html#cb221-13"></a>      shiny<span class="op">::</span>tags<span class="op">$</span><span class="kw">div</span>(</span>
<span id="cb221-14"><a href="shiny-input-system.html#cb221-14"></a>        <span class="dt">class =</span> <span class="st">&quot;box-body&quot;</span>, </span>
<span id="cb221-15"><a href="shiny-input-system.html#cb221-15"></a>        <span class="dt">style =</span> style,</span>
<span id="cb221-16"><a href="shiny-input-system.html#cb221-16"></a>        ...,</span>
<span id="cb221-17"><a href="shiny-input-system.html#cb221-17"></a>        sidebar[<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>)],</span>
<span id="cb221-18"><a href="shiny-input-system.html#cb221-18"></a>      ), </span>
<span id="cb221-19"><a href="shiny-input-system.html#cb221-19"></a>      <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.null</span>(footer)) shiny<span class="op">::</span>tags<span class="op">$</span><span class="kw">div</span>(</span>
<span id="cb221-20"><a href="shiny-input-system.html#cb221-20"></a>        <span class="dt">class =</span> <span class="cf">if</span> (<span class="kw">isTRUE</span>(footerPadding)) <span class="st">&quot;box-footer&quot;</span> <span class="cf">else</span> <span class="st">&quot;box-footer no-padding&quot;</span>, footer)</span>
<span id="cb221-21"><a href="shiny-input-system.html#cb221-21"></a>    ),</span>
<span id="cb221-22"><a href="shiny-input-system.html#cb221-22"></a>    </span>
<span id="cb221-23"><a href="shiny-input-system.html#cb221-23"></a>    <span class="co"># this will make our props accessible from JS</span></span>
<span id="cb221-24"><a href="shiny-input-system.html#cb221-24"></a>    shiny<span class="op">::</span>tags<span class="op">$</span><span class="kw">script</span>(</span>
<span id="cb221-25"><a href="shiny-input-system.html#cb221-25"></a>      <span class="dt">type =</span> <span class="st">&quot;application/json&quot;</span>,</span>
<span id="cb221-26"><a href="shiny-input-system.html#cb221-26"></a>      <span class="st">`</span><span class="dt">data-for</span><span class="st">`</span> =<span class="st"> </span>id,</span>
<span id="cb221-27"><a href="shiny-input-system.html#cb221-27"></a>      jsonlite<span class="op">::</span><span class="kw">toJSON</span>(</span>
<span id="cb221-28"><a href="shiny-input-system.html#cb221-28"></a>        <span class="dt">x =</span> props,</span>
<span id="cb221-29"><a href="shiny-input-system.html#cb221-29"></a>        <span class="dt">auto_unbox =</span> <span class="ot">TRUE</span>,</span>
<span id="cb221-30"><a href="shiny-input-system.html#cb221-30"></a>        <span class="dt">json_verbatim =</span> <span class="ot">TRUE</span></span>
<span id="cb221-31"><a href="shiny-input-system.html#cb221-31"></a>      )</span>
<span id="cb221-32"><a href="shiny-input-system.html#cb221-32"></a>    )</span>
<span id="cb221-33"><a href="shiny-input-system.html#cb221-33"></a>  )</span>
<span id="cb221-34"><a href="shiny-input-system.html#cb221-34"></a>  </span>
<span id="cb221-35"><a href="shiny-input-system.html#cb221-35"></a>  boxTag</span>
<span id="cb221-36"><a href="shiny-input-system.html#cb221-36"></a>  </span>
<span id="cb221-37"><a href="shiny-input-system.html#cb221-37"></a>}</span></code></pre></div>
<p>Then, we have to update the <code>updateBox2</code> such that it handles both toggle and update possibilities. <code>options</code> contains all updatable properties like background, title and width.
We don’t describe the toggle case since it is quite similar to the previous implementations. When the action is <code>update</code>, we enter the if statement and options must be processed. If the option element is a shiny tag or a list of shiny tag (<code>tagList</code>), we convert it to character. The returned message is a vector containing the action as well as the option list.</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="shiny-input-system.html#cb222-1"></a>updateBox2 &lt;-<span class="st"> </span><span class="cf">function</span>(id, <span class="dt">action =</span> <span class="kw">c</span>(<span class="st">&quot;toggle&quot;</span>, <span class="st">&quot;update&quot;</span>), <span class="dt">options =</span> <span class="ot">NULL</span>,</span>
<span id="cb222-2"><a href="shiny-input-system.html#cb222-2"></a>                      <span class="dt">session =</span> <span class="kw">getDefaultReactiveDomain</span>()) {</span>
<span id="cb222-3"><a href="shiny-input-system.html#cb222-3"></a>  <span class="co"># for update, we take a list of options</span></span>
<span id="cb222-4"><a href="shiny-input-system.html#cb222-4"></a>  <span class="cf">if</span> (action <span class="op">==</span><span class="st"> &quot;update&quot;</span>) {</span>
<span id="cb222-5"><a href="shiny-input-system.html#cb222-5"></a>    <span class="co"># handle case whare options are shiny tag or a list of tags ...</span></span>
<span id="cb222-6"><a href="shiny-input-system.html#cb222-6"></a>    options &lt;-<span class="st"> </span><span class="kw">lapply</span>(options, <span class="cf">function</span>(o) {</span>
<span id="cb222-7"><a href="shiny-input-system.html#cb222-7"></a>      <span class="cf">if</span> (<span class="kw">inherits</span>(o, <span class="st">&quot;shiny.tag&quot;</span>) <span class="op">||</span><span class="st"> </span><span class="kw">inherits</span>(o, <span class="st">&quot;shiny.tag.list&quot;</span>)) {</span>
<span id="cb222-8"><a href="shiny-input-system.html#cb222-8"></a>        o &lt;-<span class="st"> </span><span class="kw">as.character</span>(o)</span>
<span id="cb222-9"><a href="shiny-input-system.html#cb222-9"></a>      }</span>
<span id="cb222-10"><a href="shiny-input-system.html#cb222-10"></a>      o</span>
<span id="cb222-11"><a href="shiny-input-system.html#cb222-11"></a>    })</span>
<span id="cb222-12"><a href="shiny-input-system.html#cb222-12"></a>    message &lt;-<span class="st"> </span><span class="kw">dropNulls</span>(<span class="kw">c</span>(<span class="dt">action =</span> action, <span class="dt">options =</span> options))</span>
<span id="cb222-13"><a href="shiny-input-system.html#cb222-13"></a>    session<span class="op">$</span><span class="kw">sendInputMessage</span>(id, message)</span>
<span id="cb222-14"><a href="shiny-input-system.html#cb222-14"></a>  } <span class="cf">else</span> {</span>
<span id="cb222-15"><a href="shiny-input-system.html#cb222-15"></a>    session<span class="op">$</span><span class="kw">sendInputMessage</span>(id, <span class="dt">message =</span> action)</span>
<span id="cb222-16"><a href="shiny-input-system.html#cb222-16"></a>  }</span>
<span id="cb222-17"><a href="shiny-input-system.html#cb222-17"></a>}</span></code></pre></div>
<p>On the JS side, we modify the <code>setValue</code> method to import our newly defined properties. The <code>boxTag</code> has two children, the box and the configuration script. <code>$(el)</code> refers to the box, therefore we have to look one level up to be able to use the <code>find</code> method (find always goes deeper in the DOM), namely <code>$(el).parent()</code>. From there, we only have to target the script tag <code>$(el).parent().find("script[data-for='" + el.id + "']")</code>. Once captured in a variable, we parse the corresponding element to convert it to an objects that we can manipulate: for instance <code>config.width</code> returns the initial width. <code>value.options.width</code> will contain the new width value provided in the <code>updateBox2</code> message output. Good practice is to check whether <code>value.options.width</code> exists with <code>value.options.hasOwnProperty("width")</code>. If yes we ensure whether its value and <code>config.width</code> are different. We always choose <code>===</code> which compares the type and the value (<code>==</code> only compares the value such that <code>"1" == 1</code> is <code>true</code>). We then call the internal method <code>_updateWidth</code> which is defined in the input binding. It has 3 parameters, el, o and n (o and n being the old and new values, respectively):</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb223-1"><a href="shiny-input-system.html#cb223-1"></a>_updateWidth<span class="op">:</span> <span class="kw">function</span>(el<span class="op">,</span> o<span class="op">,</span> n) <span class="op">{</span></span>
<span id="cb223-2"><a href="shiny-input-system.html#cb223-2"></a>  <span class="co">// removes old class</span></span>
<span id="cb223-3"><a href="shiny-input-system.html#cb223-3"></a>  <span class="at">$</span>(el).<span class="at">parent</span>().<span class="at">toggleClass</span>(<span class="st">&quot;col-sm-&quot;</span> <span class="op">+</span> o)<span class="op">;</span></span>
<span id="cb223-4"><a href="shiny-input-system.html#cb223-4"></a>  <span class="at">$</span>(el).<span class="at">parent</span>().<span class="at">addClass</span>(<span class="st">&quot;col-sm-&quot;</span> <span class="op">+</span> n)<span class="op">;</span> </span>
<span id="cb223-5"><a href="shiny-input-system.html#cb223-5"></a>  <span class="co">// trigger resize so that output resize</span></span>
<span id="cb223-6"><a href="shiny-input-system.html#cb223-6"></a>  <span class="at">$</span>(el).<span class="at">trigger</span>(<span class="st">&#39;resize&#39;</span>)<span class="op">;</span></span>
<span id="cb223-7"><a href="shiny-input-system.html#cb223-7"></a><span class="op">}</span></span></code></pre></div>
<p>We must trigger a <code>resize</code> event so that output correctly scale. The internal method is identified by an underscore since it is not an inherited <code>Shiny.InputBinding</code> method.</p>
<p>We finally update the config value by the newly set value and repeat the process for any other property.</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb224-1"><a href="shiny-input-system.html#cb224-1"></a>setValue<span class="op">:</span> <span class="kw">function</span>(el<span class="op">,</span> value) <span class="op">{</span></span>
<span id="cb224-2"><a href="shiny-input-system.html#cb224-2"></a>  <span class="kw">var</span> config <span class="op">=</span> <span class="at">$</span>(el).<span class="at">parent</span>().<span class="at">find</span>(<span class="st">&quot;script[data-for=&#39;&quot;</span> <span class="op">+</span> <span class="va">el</span>.<span class="at">id</span> <span class="op">+</span> <span class="st">&quot;&#39;]&quot;</span>)<span class="op">;</span></span>
<span id="cb224-3"><a href="shiny-input-system.html#cb224-3"></a>  config <span class="op">=</span> <span class="va">JSON</span>.<span class="at">parse</span>(<span class="va">config</span>.<span class="at">html</span>())<span class="op">;</span></span>
<span id="cb224-4"><a href="shiny-input-system.html#cb224-4"></a>  </span>
<span id="cb224-5"><a href="shiny-input-system.html#cb224-5"></a>  <span class="co">// JS logic</span></span>
<span id="cb224-6"><a href="shiny-input-system.html#cb224-6"></a>  <span class="cf">if</span> (<span class="va">value</span>.<span class="at">action</span> <span class="op">===</span> <span class="st">&quot;update&quot;</span>) <span class="op">{</span></span>
<span id="cb224-7"><a href="shiny-input-system.html#cb224-7"></a>    <span class="cf">if</span> (<span class="va">value</span>.<span class="va">options</span>.<span class="at">hasOwnProperty</span>(<span class="st">&quot;width&quot;</span>)) <span class="op">{</span></span>
<span id="cb224-8"><a href="shiny-input-system.html#cb224-8"></a>      <span class="cf">if</span> (<span class="va">value</span>.<span class="va">options</span>.<span class="at">width</span> <span class="op">!==</span> <span class="va">config</span>.<span class="at">width</span>) <span class="op">{</span></span>
<span id="cb224-9"><a href="shiny-input-system.html#cb224-9"></a>        <span class="kw">this</span>.<span class="at">_updateWidth</span>(el<span class="op">,</span> <span class="va">config</span>.<span class="at">width</span><span class="op">,</span> <span class="va">value</span>.<span class="va">options</span>.<span class="at">width</span>)</span>
<span id="cb224-10"><a href="shiny-input-system.html#cb224-10"></a>        <span class="va">config</span>.<span class="at">width</span> <span class="op">=</span> <span class="va">value</span>.<span class="va">options</span>.<span class="at">width</span><span class="op">;</span></span>
<span id="cb224-11"><a href="shiny-input-system.html#cb224-11"></a>      <span class="op">}</span></span>
<span id="cb224-12"><a href="shiny-input-system.html#cb224-12"></a>    <span class="op">}</span></span>
<span id="cb224-13"><a href="shiny-input-system.html#cb224-13"></a>    <span class="co">// other items to update</span></span>
<span id="cb224-14"><a href="shiny-input-system.html#cb224-14"></a>  <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb224-15"><a href="shiny-input-system.html#cb224-15"></a>    <span class="co">// other tasks</span></span>
<span id="cb224-16"><a href="shiny-input-system.html#cb224-16"></a>  <span class="op">}</span></span>
<span id="cb224-17"><a href="shiny-input-system.html#cb224-17"></a>  </span>
<span id="cb224-18"><a href="shiny-input-system.html#cb224-18"></a><span class="op">}</span></span></code></pre></div>
<p>If it represents a significant amount of work, it is also the guarantee to lower the load on the server side.</p>
<p>Be careful with <code>this</code>. Indeed, called in an event listener, <code>this</code> refers to the element that triggered the event and not to the input binding object!</p>
</div>
</div>
<div id="utilities-to-quickly-define-new-inputs" class="section level2">
<h2><span class="header-section-number">8.3</span> Utilities to quickly define new inputs</h2>
<div id="introduction" class="section level3">
<h3><span class="header-section-number">8.3.1</span> Introduction</h3>
<p>If you ever wondered where the <code>Shiny.onInputChange</code> or <code>Shiny.setInputValue</code> comes from (see <a href="https://shiny.rstudio.com/articles/communicating-with-js.html">article</a>), it is actually defined in the <code>initShiny</code> function.</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb225-1"><a href="shiny-input-system.html#cb225-1"></a><span class="va">exports</span>.<span class="at">setInputValue</span> <span class="op">=</span> <span class="va">exports</span>.<span class="at">onInputChange</span> <span class="op">=</span> <span class="kw">function</span>(name<span class="op">,</span> value<span class="op">,</span> opts) <span class="op">{</span></span>
<span id="cb225-2"><a href="shiny-input-system.html#cb225-2"></a>  opts <span class="op">=</span> <span class="at">addDefaultInputOpts</span>(opts)<span class="op">;</span></span>
<span id="cb225-3"><a href="shiny-input-system.html#cb225-3"></a>  <span class="va">inputs</span>.<span class="at">setInput</span>(name<span class="op">,</span> value<span class="op">,</span> opts)<span class="op">;</span></span>
<span id="cb225-4"><a href="shiny-input-system.html#cb225-4"></a><span class="op">};</span></span></code></pre></div>
<p>Briefly, this function avoids creating an input binding. It is faster to code but there is a price to pay: losing the ability to easily update the new input. Indeed, all input functions like <code>sliderInput</code> have their own update function like <code>updateSliderInput</code>, because of the custom input binding system (We will see it very soon)!</p>
</div>
<div id="examples-1" class="section level3">
<h3><span class="header-section-number">8.3.2</span> Examples</h3>
<p><code>Shiny.setInputValues</code> becomes powerful when combined to the numerous Shiny JavaScript events listed <a href="https://shiny.rstudio.com/articles/js-events.html">here</a>. This is what
we use in the <a href="https://rinterface.github.io/shinyMobile/articles/shinyMobile_tools.html">shinyMobile</a> package to store the current device information in a shiny input.
Briefly, Framework7 (on top of which is built shinyMobile) has a method <code>Framework7.device</code>, which gives many <a href="https://framework7.io/docs/device.html">details</a> related to the user device.</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb226-1"><a href="shiny-input-system.html#cb226-1"></a><span class="at">$</span>(document).<span class="at">on</span>(<span class="st">&#39;shiny:connected&#39;</span><span class="op">,</span> <span class="kw">function</span>(event) <span class="op">{</span></span>
<span id="cb226-2"><a href="shiny-input-system.html#cb226-2"></a>  <span class="va">Shiny</span>.<span class="at">setInputValue</span>(<span class="st">&#39;deviceInfo&#39;</span><span class="op">,</span> <span class="va">Framework7</span>.<span class="at">device</span>)<span class="op">;</span></span>
<span id="cb226-3"><a href="shiny-input-system.html#cb226-3"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>This allows to conditionally display elements and deeply customize the interface.
In the example below, the card will not show on mobile devices.</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="shiny-input-system.html#cb227-1"></a><span class="kw">library</span>(shinyMobile)</span>
<span id="cb227-2"><a href="shiny-input-system.html#cb227-2"></a><span class="kw">shinyApp</span>(</span>
<span id="cb227-3"><a href="shiny-input-system.html#cb227-3"></a>  <span class="dt">ui =</span> <span class="kw">f7Page</span>(</span>
<span id="cb227-4"><a href="shiny-input-system.html#cb227-4"></a>    <span class="dt">title =</span> <span class="st">&quot;My app&quot;</span>,</span>
<span id="cb227-5"><a href="shiny-input-system.html#cb227-5"></a>    <span class="kw">f7SingleLayout</span>(</span>
<span id="cb227-6"><a href="shiny-input-system.html#cb227-6"></a>      <span class="dt">navbar =</span> <span class="kw">f7Navbar</span>(</span>
<span id="cb227-7"><a href="shiny-input-system.html#cb227-7"></a>        <span class="dt">title =</span> <span class="st">&quot;shinyMobile info&quot;</span>,</span>
<span id="cb227-8"><a href="shiny-input-system.html#cb227-8"></a>        <span class="dt">hairline =</span> <span class="ot">FALSE</span>,</span>
<span id="cb227-9"><a href="shiny-input-system.html#cb227-9"></a>        <span class="dt">shadow =</span> <span class="ot">TRUE</span></span>
<span id="cb227-10"><a href="shiny-input-system.html#cb227-10"></a>      ),</span>
<span id="cb227-11"><a href="shiny-input-system.html#cb227-11"></a>      <span class="co"># main content</span></span>
<span id="cb227-12"><a href="shiny-input-system.html#cb227-12"></a>      <span class="kw">uiOutput</span>(<span class="st">&quot;card&quot;</span>),</span>
<span id="cb227-13"><a href="shiny-input-system.html#cb227-13"></a>      <span class="kw">verbatimTextOutput</span>(<span class="st">&quot;info&quot;</span>),</span>
<span id="cb227-14"><a href="shiny-input-system.html#cb227-14"></a>    )</span>
<span id="cb227-15"><a href="shiny-input-system.html#cb227-15"></a>  ),</span>
<span id="cb227-16"><a href="shiny-input-system.html#cb227-16"></a>  <span class="dt">server =</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb227-17"><a href="shiny-input-system.html#cb227-17"></a>    </span>
<span id="cb227-18"><a href="shiny-input-system.html#cb227-18"></a>    output<span class="op">$</span>info &lt;-<span class="st"> </span><span class="kw">renderPrint</span>(input<span class="op">$</span>shinyInfo)</span>
<span id="cb227-19"><a href="shiny-input-system.html#cb227-19"></a></span>
<span id="cb227-20"><a href="shiny-input-system.html#cb227-20"></a>    <span class="co"># generate a card only for desktop</span></span>
<span id="cb227-21"><a href="shiny-input-system.html#cb227-21"></a>    output<span class="op">$</span>card &lt;-<span class="st"> </span><span class="kw">renderUI</span>({</span>
<span id="cb227-22"><a href="shiny-input-system.html#cb227-22"></a>      <span class="cf">if</span> (<span class="op">!</span>input<span class="op">$</span>deviceInfo<span class="op">$</span>desktop) {</span>
<span id="cb227-23"><a href="shiny-input-system.html#cb227-23"></a>        <span class="kw">f7Card</span>(</span>
<span id="cb227-24"><a href="shiny-input-system.html#cb227-24"></a>          <span class="st">&quot;This is a simple card with plain text,</span></span>
<span id="cb227-25"><a href="shiny-input-system.html#cb227-25"></a><span class="st">          but cards can also contain their own header,</span></span>
<span id="cb227-26"><a href="shiny-input-system.html#cb227-26"></a><span class="st">          footer, list view, image, or any other element.&quot;</span></span>
<span id="cb227-27"><a href="shiny-input-system.html#cb227-27"></a>        )</span>
<span id="cb227-28"><a href="shiny-input-system.html#cb227-28"></a>      } <span class="cf">else</span> {</span>
<span id="cb227-29"><a href="shiny-input-system.html#cb227-29"></a>        <span class="kw">f7Toast</span>(</span>
<span id="cb227-30"><a href="shiny-input-system.html#cb227-30"></a>          session, </span>
<span id="cb227-31"><a href="shiny-input-system.html#cb227-31"></a>          <span class="st">&quot;You are on desktop! The card will not display&quot;</span>, </span>
<span id="cb227-32"><a href="shiny-input-system.html#cb227-32"></a>          <span class="dt">position =</span> <span class="st">&quot;center&quot;</span></span>
<span id="cb227-33"><a href="shiny-input-system.html#cb227-33"></a>        )</span>
<span id="cb227-34"><a href="shiny-input-system.html#cb227-34"></a>      }</span>
<span id="cb227-35"><a href="shiny-input-system.html#cb227-35"></a>    })</span>
<span id="cb227-36"><a href="shiny-input-system.html#cb227-36"></a>  }</span>
<span id="cb227-37"><a href="shiny-input-system.html#cb227-37"></a>)</span></code></pre></div>
</div>
<div id="custom-data-format" class="section level3">
<h3><span class="header-section-number">8.3.3</span> Custom data format</h3>
<p>In some cases, the automatic Shiny R to JS data management may not meet our needs. For instance, assume we create a date in JS with <code>new Date()</code> and store it in a shiny input with <code>Shiny.setInputValue</code>. On the R side, we will not obtain a date but a character, which is not convenient. This is where input handlers are useful since they allow to manipulate data generated on the JS side before injecting them in R. Such handlers are created with <code>shiny::registerInputHandler</code> that takes 2 parameters:</p>
<ul>
<li>type allows to connect the handler to <code>Shiny.setInputValue</code>. Note that the id is followed by the handler type, for instance <code>Shiny.setInputValue('test:handler', ...)</code> is connected to <code>shiny::registerInputHandler('handler', ...)</code></li>
<li>a function to transform data, having data as main parameter</li>
</ul>
<p>Below I exceptionally include JS code directly in the shiny app snippet, which is not best practice but convenient for the demonstration. Only the second input will give the correct result.</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="shiny-input-system.html#cb228-1"></a><span class="co"># You must click on the window to create inputs!!</span></span>
<span id="cb228-2"><a href="shiny-input-system.html#cb228-2"></a><span class="kw">registerInputHandler</span>(<span class="st">&quot;textDate&quot;</span>, <span class="cf">function</span>(data, ...) {</span>
<span id="cb228-3"><a href="shiny-input-system.html#cb228-3"></a>  <span class="cf">if</span> (<span class="kw">is.null</span>(data)) {</span>
<span id="cb228-4"><a href="shiny-input-system.html#cb228-4"></a>    <span class="ot">NULL</span></span>
<span id="cb228-5"><a href="shiny-input-system.html#cb228-5"></a>  } <span class="cf">else</span> {</span>
<span id="cb228-6"><a href="shiny-input-system.html#cb228-6"></a>    res &lt;-<span class="st"> </span><span class="kw">try</span>(<span class="kw">as.Date</span>(<span class="kw">unlist</span>(data)), <span class="dt">silent =</span> <span class="ot">TRUE</span>)</span>
<span id="cb228-7"><a href="shiny-input-system.html#cb228-7"></a>    <span class="cf">if</span> (<span class="st">&quot;try-error&quot;</span> <span class="op">%in%</span><span class="st"> </span><span class="kw">class</span>(res)) {</span>
<span id="cb228-8"><a href="shiny-input-system.html#cb228-8"></a>      <span class="kw">warning</span>(<span class="st">&quot;Failed to parse dates!&quot;</span>)</span>
<span id="cb228-9"><a href="shiny-input-system.html#cb228-9"></a>      <span class="co"># as.Date(NA)</span></span>
<span id="cb228-10"><a href="shiny-input-system.html#cb228-10"></a>      data</span>
<span id="cb228-11"><a href="shiny-input-system.html#cb228-11"></a>    } <span class="cf">else</span> {</span>
<span id="cb228-12"><a href="shiny-input-system.html#cb228-12"></a>      res</span>
<span id="cb228-13"><a href="shiny-input-system.html#cb228-13"></a>    }</span>
<span id="cb228-14"><a href="shiny-input-system.html#cb228-14"></a>  }</span>
<span id="cb228-15"><a href="shiny-input-system.html#cb228-15"></a>}, <span class="dt">force =</span> <span class="ot">TRUE</span>)</span>
<span id="cb228-16"><a href="shiny-input-system.html#cb228-16"></a></span>
<span id="cb228-17"><a href="shiny-input-system.html#cb228-17"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb228-18"><a href="shiny-input-system.html#cb228-18"></a>  tags<span class="op">$</span><span class="kw">script</span>(</span>
<span id="cb228-19"><a href="shiny-input-system.html#cb228-19"></a>    <span class="st">&quot;$(function(){</span></span>
<span id="cb228-20"><a href="shiny-input-system.html#cb228-20"></a><span class="st">      $(window).on(&#39;click&#39;, function() {</span></span>
<span id="cb228-21"><a href="shiny-input-system.html#cb228-21"></a><span class="st">        var currentTime = new Date();</span></span>
<span id="cb228-22"><a href="shiny-input-system.html#cb228-22"></a><span class="st">        Shiny.setInputValue(&#39;time1&#39;, currentTime);</span></span>
<span id="cb228-23"><a href="shiny-input-system.html#cb228-23"></a><span class="st">        Shiny.setInputValue(&#39;time2:textDate&#39;, currentTime);</span></span>
<span id="cb228-24"><a href="shiny-input-system.html#cb228-24"></a><span class="st">      });</span></span>
<span id="cb228-25"><a href="shiny-input-system.html#cb228-25"></a><span class="st">    });</span></span>
<span id="cb228-26"><a href="shiny-input-system.html#cb228-26"></a><span class="st">    &quot;</span></span>
<span id="cb228-27"><a href="shiny-input-system.html#cb228-27"></a>  ),</span>
<span id="cb228-28"><a href="shiny-input-system.html#cb228-28"></a>  <span class="kw">verbatimTextOutput</span>(<span class="st">&quot;res1&quot;</span>),</span>
<span id="cb228-29"><a href="shiny-input-system.html#cb228-29"></a>  <span class="kw">verbatimTextOutput</span>(<span class="st">&quot;res2&quot;</span>)</span>
<span id="cb228-30"><a href="shiny-input-system.html#cb228-30"></a>)</span>
<span id="cb228-31"><a href="shiny-input-system.html#cb228-31"></a></span>
<span id="cb228-32"><a href="shiny-input-system.html#cb228-32"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session) {</span>
<span id="cb228-33"><a href="shiny-input-system.html#cb228-33"></a>  output<span class="op">$</span>res1 &lt;-<span class="st"> </span><span class="kw">renderPrint</span>(<span class="kw">list</span>(<span class="kw">class</span>(input<span class="op">$</span>time1), input<span class="op">$</span>time1))</span>
<span id="cb228-34"><a href="shiny-input-system.html#cb228-34"></a>  output<span class="op">$</span>res2 &lt;-<span class="st"> </span><span class="kw">renderPrint</span>(<span class="kw">list</span>(<span class="kw">class</span>(input<span class="op">$</span>time2), input<span class="op">$</span>time2))</span>
<span id="cb228-35"><a href="shiny-input-system.html#cb228-35"></a>}</span>
<span id="cb228-36"><a href="shiny-input-system.html#cb228-36"></a></span>
<span id="cb228-37"><a href="shiny-input-system.html#cb228-37"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
</div>
</div>
<div id="hidden-gems-about-inputs" class="section level2">
<h2><span class="header-section-number">8.4</span> Hidden gems about inputs</h2>
<p>We present some tools that may be useful…TO FINISH</p>
<div id="get-the-last-changed-input" class="section level3">
<h3><span class="header-section-number">8.4.1</span> Get the last changed input</h3>
<div id="motivations" class="section level4">
<h4><span class="header-section-number">8.4.1.1</span> Motivations</h4>
<p>We probably all had this question one day: How can I get the last changed input in Shiny? There are already some methods like this <a href="https://stackoverflow.com/questions/31250587/creating-shiny-reactive-variable-that-indicates-which-widget-was-last-modified">one</a> provided by Dean Attali.</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="shiny-input-system.html#cb229-1"></a><span class="kw">runApp</span>(</span>
<span id="cb229-2"><a href="shiny-input-system.html#cb229-2"></a>  <span class="kw">shinyApp</span>(</span>
<span id="cb229-3"><a href="shiny-input-system.html#cb229-3"></a>    <span class="dt">ui =</span> <span class="kw">shinyUI</span>(</span>
<span id="cb229-4"><a href="shiny-input-system.html#cb229-4"></a>      <span class="kw">fluidPage</span>(</span>
<span id="cb229-5"><a href="shiny-input-system.html#cb229-5"></a>        <span class="kw">textInput</span>(<span class="st">&#39;txt_a&#39;</span>, <span class="st">&#39;Input Text A&#39;</span>),</span>
<span id="cb229-6"><a href="shiny-input-system.html#cb229-6"></a>        <span class="kw">textInput</span>(<span class="st">&#39;txt_b&#39;</span>, <span class="st">&#39;Input Text B&#39;</span>),</span>
<span id="cb229-7"><a href="shiny-input-system.html#cb229-7"></a>        <span class="kw">uiOutput</span>(<span class="st">&#39;txt_c_out&#39;</span>),</span>
<span id="cb229-8"><a href="shiny-input-system.html#cb229-8"></a>        <span class="kw">verbatimTextOutput</span>(<span class="st">&quot;show_last&quot;</span>)</span>
<span id="cb229-9"><a href="shiny-input-system.html#cb229-9"></a>      )</span>
<span id="cb229-10"><a href="shiny-input-system.html#cb229-10"></a>    ),</span>
<span id="cb229-11"><a href="shiny-input-system.html#cb229-11"></a>    <span class="dt">server =</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb229-12"><a href="shiny-input-system.html#cb229-12"></a>      output<span class="op">$</span>txt_c_out &lt;-<span class="st"> </span><span class="kw">renderUI</span>({</span>
<span id="cb229-13"><a href="shiny-input-system.html#cb229-13"></a>        <span class="kw">textInput</span>(<span class="st">&#39;txt_c&#39;</span>, <span class="st">&#39;Input Text C&#39;</span>)</span>
<span id="cb229-14"><a href="shiny-input-system.html#cb229-14"></a>      })</span>
<span id="cb229-15"><a href="shiny-input-system.html#cb229-15"></a>      </span>
<span id="cb229-16"><a href="shiny-input-system.html#cb229-16"></a>      values &lt;-<span class="st"> </span><span class="kw">reactiveValues</span>(</span>
<span id="cb229-17"><a href="shiny-input-system.html#cb229-17"></a>        <span class="dt">lastUpdated =</span> <span class="ot">NULL</span></span>
<span id="cb229-18"><a href="shiny-input-system.html#cb229-18"></a>      )</span>
<span id="cb229-19"><a href="shiny-input-system.html#cb229-19"></a>      </span>
<span id="cb229-20"><a href="shiny-input-system.html#cb229-20"></a>      <span class="kw">observe</span>({</span>
<span id="cb229-21"><a href="shiny-input-system.html#cb229-21"></a>        <span class="kw">lapply</span>(<span class="kw">names</span>(input), <span class="cf">function</span>(x) {</span>
<span id="cb229-22"><a href="shiny-input-system.html#cb229-22"></a>          <span class="kw">observe</span>({</span>
<span id="cb229-23"><a href="shiny-input-system.html#cb229-23"></a>            input[[x]]</span>
<span id="cb229-24"><a href="shiny-input-system.html#cb229-24"></a>            values<span class="op">$</span>lastUpdated &lt;-<span class="st"> </span>x</span>
<span id="cb229-25"><a href="shiny-input-system.html#cb229-25"></a>          })</span>
<span id="cb229-26"><a href="shiny-input-system.html#cb229-26"></a>        })</span>
<span id="cb229-27"><a href="shiny-input-system.html#cb229-27"></a>      })</span>
<span id="cb229-28"><a href="shiny-input-system.html#cb229-28"></a>      </span>
<span id="cb229-29"><a href="shiny-input-system.html#cb229-29"></a>      output<span class="op">$</span>show_last &lt;-<span class="st"> </span><span class="kw">renderPrint</span>({</span>
<span id="cb229-30"><a href="shiny-input-system.html#cb229-30"></a>        values<span class="op">$</span>lastUpdated</span>
<span id="cb229-31"><a href="shiny-input-system.html#cb229-31"></a>      })</span>
<span id="cb229-32"><a href="shiny-input-system.html#cb229-32"></a>    }</span>
<span id="cb229-33"><a href="shiny-input-system.html#cb229-33"></a>  )</span>
<span id="cb229-34"><a href="shiny-input-system.html#cb229-34"></a>)</span></code></pre></div>
<p>Shouldn’t this be easier? Could we do that from the client instead, thereby reducing the server load?</p>
</div>
<div id="javascript-my-friend" class="section level4">
<h4><span class="header-section-number">8.4.1.2</span> JavaScript, my friend</h4>
<p>Here comes our friend, JavaScript. If you insert this snippet in the head of your app, you will be able to get the last changed input (name, value and type).</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb230-1"><a href="shiny-input-system.html#cb230-1"></a><span class="at">$</span>(document).<span class="at">on</span>(<span class="st">&#39;shiny:inputchanged&#39;</span><span class="op">,</span> <span class="kw">function</span>(event) <span class="op">{</span></span>
<span id="cb230-2"><a href="shiny-input-system.html#cb230-2"></a>  <span class="va">Shiny</span>.<span class="at">setInputValue</span>(<span class="st">&#39;pleaseStayHome&#39;</span><span class="op">,</span> <span class="op">{</span><span class="dt">name</span><span class="op">:</span> <span class="va">event</span>.<span class="at">name</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="va">event</span>.<span class="at">value</span><span class="op">,</span> <span class="dt">type</span><span class="op">:</span> <span class="va">event</span>.<span class="va">binding</span>.<span class="va">name</span>.<span class="at">split</span>(<span class="st">&#39;.&#39;</span>)[<span class="dv">1</span>]<span class="op">}</span>)<span class="op">;</span></span>
<span id="cb230-3"><a href="shiny-input-system.html#cb230-3"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>If you use this code in a custom shiny template, it is possible that input bindings don’t have name, which would thereby make <code>event.binding.name.split('.')[1]</code> crash because <code>event.binding</code> is undefined. If so, you may remove this part:</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb231-1"><a href="shiny-input-system.html#cb231-1"></a><span class="at">$</span>(document).<span class="at">on</span>(<span class="st">&#39;shiny:inputchanged&#39;</span><span class="op">,</span> <span class="kw">function</span>(event) <span class="op">{</span></span>
<span id="cb231-2"><a href="shiny-input-system.html#cb231-2"></a>  <span class="va">Shiny</span>.<span class="at">setInputValue</span>(<span class="st">&#39;pleaseStayHome&#39;</span><span class="op">,</span> <span class="op">{</span><span class="dt">name</span><span class="op">:</span> <span class="va">event</span>.<span class="at">name</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="va">event</span>.<span class="at">value</span><span class="op">}</span>)<span class="op">;</span></span>
<span id="cb231-3"><a href="shiny-input-system.html#cb231-3"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
</div>
<div id="example" class="section level4">
<h4><span class="header-section-number">8.4.1.3</span> Example</h4>
<p><code>{shinyMobile}</code> natively implements this feature that may be accessed with <code>input$lastInputChanged</code>.</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="shiny-input-system.html#cb232-1"></a><span class="kw">library</span>(shinyMobile)</span>
<span id="cb232-2"><a href="shiny-input-system.html#cb232-2"></a><span class="kw">shinyApp</span>(</span>
<span id="cb232-3"><a href="shiny-input-system.html#cb232-3"></a>  <span class="dt">ui =</span> <span class="kw">f7Page</span>(</span>
<span id="cb232-4"><a href="shiny-input-system.html#cb232-4"></a>    <span class="dt">title =</span> <span class="st">&quot;My app&quot;</span>,</span>
<span id="cb232-5"><a href="shiny-input-system.html#cb232-5"></a>    <span class="kw">f7SingleLayout</span>(</span>
<span id="cb232-6"><a href="shiny-input-system.html#cb232-6"></a>      <span class="dt">navbar =</span> <span class="kw">f7Navbar</span>(</span>
<span id="cb232-7"><a href="shiny-input-system.html#cb232-7"></a>        <span class="dt">title =</span> <span class="st">&quot;Single Layout&quot;</span>,</span>
<span id="cb232-8"><a href="shiny-input-system.html#cb232-8"></a>        <span class="dt">hairline =</span> <span class="ot">FALSE</span>,</span>
<span id="cb232-9"><a href="shiny-input-system.html#cb232-9"></a>        <span class="dt">shadow =</span> <span class="ot">TRUE</span></span>
<span id="cb232-10"><a href="shiny-input-system.html#cb232-10"></a>      ),</span>
<span id="cb232-11"><a href="shiny-input-system.html#cb232-11"></a>      <span class="dt">toolbar =</span> <span class="kw">f7Toolbar</span>(</span>
<span id="cb232-12"><a href="shiny-input-system.html#cb232-12"></a>        <span class="dt">position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb232-13"><a href="shiny-input-system.html#cb232-13"></a>        <span class="kw">f7Link</span>(<span class="dt">label =</span> <span class="st">&quot;Link 1&quot;</span>, <span class="dt">src =</span> <span class="st">&quot;https://www.google.com&quot;</span>),</span>
<span id="cb232-14"><a href="shiny-input-system.html#cb232-14"></a>        <span class="kw">f7Link</span>(<span class="dt">label =</span> <span class="st">&quot;Link 2&quot;</span>, <span class="dt">src =</span> <span class="st">&quot;https://www.google.com&quot;</span>, <span class="dt">external =</span> <span class="ot">TRUE</span>)</span>
<span id="cb232-15"><a href="shiny-input-system.html#cb232-15"></a>      ),</span>
<span id="cb232-16"><a href="shiny-input-system.html#cb232-16"></a>      <span class="co"># main content,</span></span>
<span id="cb232-17"><a href="shiny-input-system.html#cb232-17"></a>      <span class="kw">f7Card</span>(</span>
<span id="cb232-18"><a href="shiny-input-system.html#cb232-18"></a>        <span class="kw">f7Text</span>(<span class="dt">inputId =</span> <span class="st">&quot;text&quot;</span>, <span class="dt">label =</span> <span class="st">&quot;Text&quot;</span>),</span>
<span id="cb232-19"><a href="shiny-input-system.html#cb232-19"></a>        <span class="kw">f7Slider</span>(<span class="dt">inputId =</span> <span class="st">&quot;range1&quot;</span>, <span class="dt">label =</span> <span class="st">&quot;Range&quot;</span>, <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="dv">2</span>, <span class="dt">value =</span> <span class="dv">1</span>, <span class="dt">step =</span> <span class="fl">0.1</span>),</span>
<span id="cb232-20"><a href="shiny-input-system.html#cb232-20"></a>        <span class="kw">f7Stepper</span>(<span class="dt">inputId =</span> <span class="st">&quot;stepper1&quot;</span>, <span class="dt">label =</span> <span class="st">&quot;Stepper&quot;</span>, <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="dv">10</span>, <span class="dt">value =</span> <span class="dv">5</span>),</span>
<span id="cb232-21"><a href="shiny-input-system.html#cb232-21"></a>        <span class="kw">verbatimTextOutput</span>(<span class="st">&quot;lastChanged&quot;</span>)</span>
<span id="cb232-22"><a href="shiny-input-system.html#cb232-22"></a>      )</span>
<span id="cb232-23"><a href="shiny-input-system.html#cb232-23"></a>    )</span>
<span id="cb232-24"><a href="shiny-input-system.html#cb232-24"></a>  ),</span>
<span id="cb232-25"><a href="shiny-input-system.html#cb232-25"></a>  <span class="dt">server =</span> <span class="cf">function</span>(input, output) {</span>
<span id="cb232-26"><a href="shiny-input-system.html#cb232-26"></a>    output<span class="op">$</span>lastChanged &lt;-<span class="st"> </span><span class="kw">renderPrint</span>(input<span class="op">$</span>lastInputChanged)</span>
<span id="cb232-27"><a href="shiny-input-system.html#cb232-27"></a>  }</span>
<span id="cb232-28"><a href="shiny-input-system.html#cb232-28"></a>)</span></code></pre></div>
<p>This approach has the advantage not to overload the server part with complex logic.</p>
</div>
<div id="about-shinylogs" class="section level4">
<h4><span class="header-section-number">8.4.1.4</span> About {shinylogs}</h4>
<p>The <code>{shinylogs}</code> package developed by <a href="https://github.com/dreamRs/shinylogs">dreamRs</a> contains this feature with much more advanced options.</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="shiny-input-system.html#cb233-1"></a><span class="kw">library</span>(shinylogs)</span>
<span id="cb233-2"><a href="shiny-input-system.html#cb233-2"></a></span>
<span id="cb233-3"><a href="shiny-input-system.html#cb233-3"></a><span class="kw">shinyApp</span>(</span>
<span id="cb233-4"><a href="shiny-input-system.html#cb233-4"></a>  <span class="dt">ui =</span> <span class="kw">fluidPage</span>(</span>
<span id="cb233-5"><a href="shiny-input-system.html#cb233-5"></a>    <span class="kw">numericInput</span>(<span class="st">&quot;n&quot;</span>, <span class="st">&quot;n&quot;</span>, <span class="dv">1</span>),</span>
<span id="cb233-6"><a href="shiny-input-system.html#cb233-6"></a>    <span class="kw">sliderInput</span>(<span class="st">&quot;s&quot;</span>, <span class="st">&quot;s&quot;</span>, <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="dv">10</span>, <span class="dt">value =</span> <span class="dv">5</span>),</span>
<span id="cb233-7"><a href="shiny-input-system.html#cb233-7"></a>    <span class="kw">verbatimTextOutput</span>(<span class="st">&quot;lastChanged&quot;</span>)</span>
<span id="cb233-8"><a href="shiny-input-system.html#cb233-8"></a>  ),</span>
<span id="cb233-9"><a href="shiny-input-system.html#cb233-9"></a>  <span class="dt">server =</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb233-10"><a href="shiny-input-system.html#cb233-10"></a>    <span class="co"># specific to shinylogs</span></span>
<span id="cb233-11"><a href="shiny-input-system.html#cb233-11"></a>    <span class="kw">track_usage</span>(<span class="dt">storage_mode =</span> <span class="kw">store_null</span>())</span>
<span id="cb233-12"><a href="shiny-input-system.html#cb233-12"></a>    output<span class="op">$</span>lastChanged &lt;-<span class="st"> </span><span class="kw">renderPrint</span>(input<span class="op">$</span><span class="st">`</span><span class="dt">.shinylogs_lastInput</span><span class="st">`</span>)</span>
<span id="cb233-13"><a href="shiny-input-system.html#cb233-13"></a>  }</span>
<span id="cb233-14"><a href="shiny-input-system.html#cb233-14"></a>)</span></code></pre></div>
</div>
</div>
</div>
<div id="recap-shiny-app-lifecycles" class="section level2">
<h2><span class="header-section-number">8.5</span> Recap: Shiny App lifecycles</h2>
<p>In the following, we’ll recap everything we see from chapter <a href="shiny-intro.html#shiny-intro">7</a>.</p>
<div id="app-initialization" class="section level3">
<h3><span class="header-section-number">8.5.1</span> App initialization</h3>
<div class="figure"><span id="fig:init-shiny-recap"></span>
<img src="images/survival-kit/init-shiny-recap.png" alt="What Shiny does client side on initialization" width="100%" />
<p class="caption">
FIGURE 8.7: What Shiny does client side on initialization
</p>
</div>
<p>When a shiny apps starts, Shiny runs <code>initShiny</code> on the client. This <a href="https://github.com/rstudio/shiny/blob/master/srcjs/init_shiny.js">function</a> has 3 main tasks:</p>
<ul>
<li>Bind all inputs and outputs with <code>_bindAll()</code>.</li>
<li>Initialize all inputs (if necessary) with <code>initializeInputs</code>.</li>
<li>Initialize the client websocket connection mentioned in the previous chapter <a href="shiny-intro.html#shiny-intro">7</a> and send initial values to the server.</li>
</ul>
<p>Most input bindings are in principle bundled in the <code>{shiny}</code> package. Some may be user-defined like in <code>{shinyMobile}</code> or even in a simple shiny app. In any case,
they are all contained in a binding registry, namely <code>inputBindings</code> built on top the following class (the same apply for output bindings):</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb234-1"><a href="shiny-input-system.html#cb234-1"></a><span class="kw">var</span> BindingRegistry <span class="op">=</span> <span class="kw">function</span>() <span class="op">{</span></span>
<span id="cb234-2"><a href="shiny-input-system.html#cb234-2"></a>  <span class="kw">this</span>.<span class="at">bindings</span> <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb234-3"><a href="shiny-input-system.html#cb234-3"></a>  <span class="kw">this</span>.<span class="at">bindingNames</span> <span class="op">=</span> <span class="op">{};</span></span>
<span id="cb234-4"><a href="shiny-input-system.html#cb234-4"></a><span class="op">}</span></span></code></pre></div>
<p>This class has method to <code>register</code> binding. This is the one we call when doing <code>Shiny.inputBindings.register(myBinding, 'reference');</code>, which appends the newly created binding to the bindings array.</p>
<p>When shiny starts, it has to find all defined bindings with the <code>getBindings</code> method.
Once done, for each binding, <code>find</code> is triggered. If no corresponding element is found in the DOM, nothing is done. For each found input, the following methods are triggered:</p>
<ul>
<li><code>getId</code> (no described before) returns the input id. This ensures the uniqueness and is critical!</li>
<li><code>getType</code> optionally handles any <code>registerInputHandler</code> defined by the user on the R side.</li>
<li><code>getValue</code> gets the initial input value.</li>
<li><code>subscribe</code> registers event listeners driving the input behavior.</li>
</ul>
<p>The data attribute <code>shiny-input-binding</code> is then added. This allows shiny or any end-users to access the input binding methods from the client (in practice, very few end-users will do that). The <code>shiny-bound-input</code> class is added, the corresponding input is appended to the <code>boundInputs</code> object (listing all bound inputs) and <code>shiny:bound</code> triggered on the client.</p>
<p>Once done, shiny stores all initial values in a variable <code>initialInput</code>, also containing all <a href="https://shiny.rstudio.com/articles/client-data.html">client data</a> and pass them to the <code>Shinyapp.connect</code> method. As shown in <a href="shiny-intro.html#shiny-intro">7</a>, the latter opens the client websocket connection, raises the <code>shiny:connected</code> event and send all values to the server (R). Few time after, <code>shiny:sessioninitialized</code> is triggered.</p>
<p>In chapter <a href="shiny-intro.html#shiny-intro">7</a>, we briefly described the <code>shiny</code> JavaScript object. As an exercise, let’s explore what the <code>Shiny.shinyApp</code> object contains. The definition is located in the shinyapps.js <a href="https://github.com/rstudio/shiny/blob/master/srcjs/shinyapp.js">script</a>.</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb235-1"><a href="shiny-input-system.html#cb235-1"></a><span class="kw">var</span> ShinyApp <span class="op">=</span> <span class="kw">function</span>() <span class="op">{</span></span>
<span id="cb235-2"><a href="shiny-input-system.html#cb235-2"></a>  <span class="kw">this</span>.<span class="at">$socket</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb235-3"><a href="shiny-input-system.html#cb235-3"></a>  </span>
<span id="cb235-4"><a href="shiny-input-system.html#cb235-4"></a>  <span class="co">// Cached input values</span></span>
<span id="cb235-5"><a href="shiny-input-system.html#cb235-5"></a>  <span class="kw">this</span>.<span class="at">$inputValues</span> <span class="op">=</span> <span class="op">{};</span></span>
<span id="cb235-6"><a href="shiny-input-system.html#cb235-6"></a>  </span>
<span id="cb235-7"><a href="shiny-input-system.html#cb235-7"></a>  <span class="co">// Input values at initialization (and reconnect)</span></span>
<span id="cb235-8"><a href="shiny-input-system.html#cb235-8"></a>  <span class="kw">this</span>.<span class="at">$initialInput</span> <span class="op">=</span> <span class="op">{};</span></span>
<span id="cb235-9"><a href="shiny-input-system.html#cb235-9"></a>  </span>
<span id="cb235-10"><a href="shiny-input-system.html#cb235-10"></a>  <span class="co">// Output bindings</span></span>
<span id="cb235-11"><a href="shiny-input-system.html#cb235-11"></a>  <span class="kw">this</span>.<span class="at">$bindings</span> <span class="op">=</span> <span class="op">{};</span></span>
<span id="cb235-12"><a href="shiny-input-system.html#cb235-12"></a>  </span>
<span id="cb235-13"><a href="shiny-input-system.html#cb235-13"></a>  <span class="co">// Cached values/errors</span></span>
<span id="cb235-14"><a href="shiny-input-system.html#cb235-14"></a>  <span class="kw">this</span>.<span class="at">$values</span> <span class="op">=</span> <span class="op">{};</span></span>
<span id="cb235-15"><a href="shiny-input-system.html#cb235-15"></a>  <span class="kw">this</span>.<span class="at">$errors</span> <span class="op">=</span> <span class="op">{};</span></span>
<span id="cb235-16"><a href="shiny-input-system.html#cb235-16"></a>  </span>
<span id="cb235-17"><a href="shiny-input-system.html#cb235-17"></a>  <span class="co">// Conditional bindings (show/hide element based on expression)</span></span>
<span id="cb235-18"><a href="shiny-input-system.html#cb235-18"></a>  <span class="kw">this</span>.<span class="at">$conditionals</span> <span class="op">=</span> <span class="op">{};</span></span>
<span id="cb235-19"><a href="shiny-input-system.html#cb235-19"></a>  </span>
<span id="cb235-20"><a href="shiny-input-system.html#cb235-20"></a>  <span class="kw">this</span>.<span class="at">$pendingMessages</span> <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb235-21"><a href="shiny-input-system.html#cb235-21"></a>  <span class="kw">this</span>.<span class="at">$activeRequests</span> <span class="op">=</span> <span class="op">{};</span></span>
<span id="cb235-22"><a href="shiny-input-system.html#cb235-22"></a>  <span class="kw">this</span>.<span class="at">$nextRequestId</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb235-23"><a href="shiny-input-system.html#cb235-23"></a>  </span>
<span id="cb235-24"><a href="shiny-input-system.html#cb235-24"></a>  <span class="kw">this</span>.<span class="at">$allowReconnect</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb235-25"><a href="shiny-input-system.html#cb235-25"></a><span class="op">};</span></span></code></pre></div>
<p>It creates several properties, some of them are easy to guess like <code>inputValues</code> or <code>initialInput</code>. Let’s run the example below and open the HTML inspector. Notice that the <code>sliderInput</code> is set to 500 at <code>t0</code> (initialization).</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="shiny-input-system.html#cb236-1"></a>ui &lt;-<span class="st"> </span><span class="kw">fluidPage</span>(</span>
<span id="cb236-2"><a href="shiny-input-system.html#cb236-2"></a>  <span class="kw">sliderInput</span>(<span class="st">&quot;obs&quot;</span>, <span class="st">&quot;Number of observations:&quot;</span>,</span>
<span id="cb236-3"><a href="shiny-input-system.html#cb236-3"></a>              <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="dv">1000</span>, <span class="dt">value =</span> <span class="dv">500</span></span>
<span id="cb236-4"><a href="shiny-input-system.html#cb236-4"></a>  ),</span>
<span id="cb236-5"><a href="shiny-input-system.html#cb236-5"></a>  <span class="kw">plotOutput</span>(<span class="st">&quot;distPlot&quot;</span>)</span>
<span id="cb236-6"><a href="shiny-input-system.html#cb236-6"></a>)</span>
<span id="cb236-7"><a href="shiny-input-system.html#cb236-7"></a></span>
<span id="cb236-8"><a href="shiny-input-system.html#cb236-8"></a>server &lt;-<span class="st"> </span><span class="cf">function</span>(input, output, session) {</span>
<span id="cb236-9"><a href="shiny-input-system.html#cb236-9"></a>  output<span class="op">$</span>distPlot &lt;-<span class="st"> </span><span class="kw">renderPlot</span>({</span>
<span id="cb236-10"><a href="shiny-input-system.html#cb236-10"></a>    <span class="kw">hist</span>(<span class="kw">rnorm</span>(input<span class="op">$</span>obs))</span>
<span id="cb236-11"><a href="shiny-input-system.html#cb236-11"></a>  })</span>
<span id="cb236-12"><a href="shiny-input-system.html#cb236-12"></a>}</span>
<span id="cb236-13"><a href="shiny-input-system.html#cb236-13"></a><span class="kw">shinyApp</span>(ui, server)</span></code></pre></div>
<p>Figure <a href="shiny-input-system.html#fig:shiny-initial-inputs">8.8</a> shows how to access Shiny’s initial input value with <code>Shiny.shinyapp.$initialInput.obs</code>. After changing the slider position, its value is given by <code>Shiny.shinyapp.$inputValues.obs</code>. <code>$initialInput</code> and <code>$inputValues</code> contains many more elements, however we are only interested in the slider function in this example.</p>
<div class="figure"><span id="fig:shiny-initial-inputs"></span>
<img src="images/survival-kit/shiny-init-input.png" alt="Explore initial input values" width="100%" />
<p class="caption">
FIGURE 8.8: Explore initial input values
</p>
</div>
</div>
<div id="update-input" class="section level3">
<h3><span class="header-section-number">8.5.2</span> Update input</h3>
<p>Below we try to explain what are the mechanisms to update an input from the server on the client. As stated above, it all starts with an <code>update&lt;name&gt;Input</code> function call, which actually sends a message through the current <code>session</code>. This message is received by the client websocket message manager:</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb237-1"><a href="shiny-input-system.html#cb237-1"></a><span class="va">socket</span>.<span class="at">onmessage</span> <span class="op">=</span> <span class="kw">function</span>(e) <span class="op">{</span></span>
<span id="cb237-2"><a href="shiny-input-system.html#cb237-2"></a>  <span class="va">self</span>.<span class="at">dispatchMessage</span>(<span class="va">e</span>.<span class="at">data</span>)<span class="op">;</span></span>
<span id="cb237-3"><a href="shiny-input-system.html#cb237-3"></a><span class="op">};</span></span></code></pre></div>
<p>which sends the message to the appropriate <a href="https://github.com/rstudio/shiny/blob/master/srcjs/shinyapp.js#L552">handler</a>, that is <code>inputMessages</code>:</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb238-1"><a href="shiny-input-system.html#cb238-1"></a><span class="at">addMessageHandler</span>(<span class="st">&#39;inputMessages&#39;</span><span class="op">,</span> <span class="kw">function</span>(message) <span class="op">{</span></span>
<span id="cb238-2"><a href="shiny-input-system.html#cb238-2"></a>  <span class="co">// inputMessages should be an array</span></span>
<span id="cb238-3"><a href="shiny-input-system.html#cb238-3"></a>  <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="va">message</span>.<span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) <span class="op">{</span></span>
<span id="cb238-4"><a href="shiny-input-system.html#cb238-4"></a>    <span class="kw">var</span> $obj <span class="op">=</span> <span class="at">$</span>(<span class="st">&#39;.shiny-bound-input#&#39;</span> <span class="op">+</span> <span class="at">$escape</span>(message[i].<span class="at">id</span>))<span class="op">;</span></span>
<span id="cb238-5"><a href="shiny-input-system.html#cb238-5"></a>    <span class="kw">var</span> inputBinding <span class="op">=</span> <span class="va">$obj</span>.<span class="at">data</span>(<span class="st">&#39;shiny-input-binding&#39;</span>)<span class="op">;</span></span>
<span id="cb238-6"><a href="shiny-input-system.html#cb238-6"></a></span>
<span id="cb238-7"><a href="shiny-input-system.html#cb238-7"></a>    <span class="co">// Dispatch the message to the appropriate input object</span></span>
<span id="cb238-8"><a href="shiny-input-system.html#cb238-8"></a>    <span class="cf">if</span> (<span class="va">$obj</span>.<span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">{</span></span>
<span id="cb238-9"><a href="shiny-input-system.html#cb238-9"></a>      <span class="kw">var</span> el <span class="op">=</span> $obj[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb238-10"><a href="shiny-input-system.html#cb238-10"></a>      <span class="kw">var</span> evt <span class="op">=</span> <span class="va">jQuery</span>.<span class="at">Event</span>(<span class="st">&#39;shiny:updateinput&#39;</span>)<span class="op">;</span></span>
<span id="cb238-11"><a href="shiny-input-system.html#cb238-11"></a>      <span class="va">evt</span>.<span class="at">message</span> <span class="op">=</span> message[i].<span class="at">message</span><span class="op">;</span></span>
<span id="cb238-12"><a href="shiny-input-system.html#cb238-12"></a>      <span class="va">evt</span>.<span class="at">binding</span> <span class="op">=</span> inputBinding<span class="op">;</span></span>
<span id="cb238-13"><a href="shiny-input-system.html#cb238-13"></a>      <span class="at">$</span>(el).<span class="at">trigger</span>(evt)<span class="op">;</span></span>
<span id="cb238-14"><a href="shiny-input-system.html#cb238-14"></a>      <span class="cf">if</span> (<span class="op">!</span><span class="va">evt</span>.<span class="at">isDefaultPrevented</span>())</span>
<span id="cb238-15"><a href="shiny-input-system.html#cb238-15"></a>        <span class="va">inputBinding</span>.<span class="at">receiveMessage</span>(el<span class="op">,</span> <span class="va">evt</span>.<span class="at">message</span>)<span class="op">;</span></span>
<span id="cb238-16"><a href="shiny-input-system.html#cb238-16"></a>    <span class="op">}</span></span>
<span id="cb238-17"><a href="shiny-input-system.html#cb238-17"></a>  <span class="op">}</span></span>
<span id="cb238-18"><a href="shiny-input-system.html#cb238-18"></a><span class="op">}</span>)<span class="op">;</span></span></code></pre></div>
<p>In short, this does get the inputId and access the corresponding input binding. Then it triggers the <code>shiny:updateinput</code> <a href="https://shiny.rstudio.com/articles/js-events.html">event</a> and call the input binding <code>receiveMessage</code> method. This fires <code>setValue</code> and <code>subscribe</code>.
The way <code>subscribe</code> works is not really well covered in the official <a href="https://shiny.rstudio.com/articles/building-inputs.html">documentation</a>.
The <code>callback</code> function is actually defined during the initialization <a href="https://github.com/rstudio/shiny/blob/master/srcjs/init_shiny.js#L174">process</a>:</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb239-1"><a href="shiny-input-system.html#cb239-1"></a><span class="kw">function</span> <span class="at">valueChangeCallback</span>(binding<span class="op">,</span> el<span class="op">,</span> allowDeferred) <span class="op">{</span></span>
<span id="cb239-2"><a href="shiny-input-system.html#cb239-2"></a>  <span class="kw">var</span> id <span class="op">=</span> <span class="va">binding</span>.<span class="at">getId</span>(el)<span class="op">;</span></span>
<span id="cb239-3"><a href="shiny-input-system.html#cb239-3"></a>  <span class="cf">if</span> (id) <span class="op">{</span></span>
<span id="cb239-4"><a href="shiny-input-system.html#cb239-4"></a>    <span class="kw">var</span> value <span class="op">=</span> <span class="va">binding</span>.<span class="at">getValue</span>(el)<span class="op">;</span></span>
<span id="cb239-5"><a href="shiny-input-system.html#cb239-5"></a>    <span class="kw">var</span> type <span class="op">=</span> <span class="va">binding</span>.<span class="at">getType</span>(el)<span class="op">;</span></span>
<span id="cb239-6"><a href="shiny-input-system.html#cb239-6"></a>    <span class="cf">if</span> (type)</span>
<span id="cb239-7"><a href="shiny-input-system.html#cb239-7"></a>      id <span class="op">=</span> id <span class="op">+</span> <span class="st">&quot;:&quot;</span> <span class="op">+</span> type<span class="op">;</span></span>
<span id="cb239-8"><a href="shiny-input-system.html#cb239-8"></a></span>
<span id="cb239-9"><a href="shiny-input-system.html#cb239-9"></a>    <span class="kw">let</span> opts <span class="op">=</span> <span class="op">{</span></span>
<span id="cb239-10"><a href="shiny-input-system.html#cb239-10"></a>      <span class="dt">priority</span><span class="op">:</span> allowDeferred <span class="op">?</span> <span class="st">&quot;deferred&quot;</span> : <span class="st">&quot;immediate&quot;</span><span class="op">,</span></span>
<span id="cb239-11"><a href="shiny-input-system.html#cb239-11"></a>      <span class="dt">binding</span><span class="op">:</span> binding<span class="op">,</span></span>
<span id="cb239-12"><a href="shiny-input-system.html#cb239-12"></a>      <span class="dt">el</span><span class="op">:</span> el</span>
<span id="cb239-13"><a href="shiny-input-system.html#cb239-13"></a>    <span class="op">};</span></span>
<span id="cb239-14"><a href="shiny-input-system.html#cb239-14"></a>    <span class="va">inputs</span>.<span class="at">setInput</span>(id<span class="op">,</span> value<span class="op">,</span> opts)<span class="op">;</span></span>
<span id="cb239-15"><a href="shiny-input-system.html#cb239-15"></a>  <span class="op">}</span></span>
<span id="cb239-16"><a href="shiny-input-system.html#cb239-16"></a><span class="op">}</span></span></code></pre></div>
<p><code>valueChangeCallback</code> ultimately calls <code>inputs.setInput(id, value, opts)</code>. The latters involves a rather complex chain of <a href="https://github.com/rstudio/shiny/blob/master/srcjs/input_rate.js">reactions</a> (which is not described here). Overall, the result is stored in a queue, namely <code>pendingData</code> and sent to the server with <code>shinyapp.sendInput</code>:</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb240-1"><a href="shiny-input-system.html#cb240-1"></a><span class="kw">this</span>.<span class="at">sendInput</span> <span class="op">=</span> <span class="kw">function</span>(values) <span class="op">{</span></span>
<span id="cb240-2"><a href="shiny-input-system.html#cb240-2"></a>  <span class="kw">var</span> msg <span class="op">=</span> <span class="va">JSON</span>.<span class="at">stringify</span>(<span class="op">{</span></span>
<span id="cb240-3"><a href="shiny-input-system.html#cb240-3"></a>    <span class="dt">method</span><span class="op">:</span> <span class="st">&#39;update&#39;</span><span class="op">,</span></span>
<span id="cb240-4"><a href="shiny-input-system.html#cb240-4"></a>    <span class="dt">data</span><span class="op">:</span> values</span>
<span id="cb240-5"><a href="shiny-input-system.html#cb240-5"></a>  <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb240-6"><a href="shiny-input-system.html#cb240-6"></a></span>
<span id="cb240-7"><a href="shiny-input-system.html#cb240-7"></a>  <span class="kw">this</span>.<span class="at">$sendMsg</span>(msg)<span class="op">;</span></span>
<span id="cb240-8"><a href="shiny-input-system.html#cb240-8"></a>    </span>
<span id="cb240-9"><a href="shiny-input-system.html#cb240-9"></a>  <span class="va">$</span>.<span class="at">extend</span>(<span class="kw">this</span>.<span class="at">$inputValues</span><span class="op">,</span> values)<span class="op">;</span></span>
<span id="cb240-10"><a href="shiny-input-system.html#cb240-10"></a>  <span class="co">// other things ...</span></span>
<span id="cb240-11"><a href="shiny-input-system.html#cb240-11"></a><span class="op">}</span></span></code></pre></div>
<p>The message has an <code>update</code> tag and is sent through the client websocket, only if the connection is opened. If not, it is added to the list of pending messages.</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb241-1"><a href="shiny-input-system.html#cb241-1"></a><span class="kw">this</span>.<span class="at">$sendMsg</span> <span class="op">=</span> <span class="kw">function</span>(msg) <span class="op">{</span></span>
<span id="cb241-2"><a href="shiny-input-system.html#cb241-2"></a>  <span class="cf">if</span> (<span class="op">!</span><span class="kw">this</span>.<span class="va">$socket</span>.<span class="at">readyState</span>) <span class="op">{</span></span>
<span id="cb241-3"><a href="shiny-input-system.html#cb241-3"></a>    <span class="kw">this</span>.<span class="va">$pendingMessages</span>.<span class="at">push</span>(msg)<span class="op">;</span></span>
<span id="cb241-4"><a href="shiny-input-system.html#cb241-4"></a>  <span class="op">}</span></span>
<span id="cb241-5"><a href="shiny-input-system.html#cb241-5"></a>  <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb241-6"><a href="shiny-input-system.html#cb241-6"></a>    <span class="kw">this</span>.<span class="va">$socket</span>.<span class="at">send</span>(msg)<span class="op">;</span></span>
<span id="cb241-7"><a href="shiny-input-system.html#cb241-7"></a>  <span class="op">}</span></span>
<span id="cb241-8"><a href="shiny-input-system.html#cb241-8"></a><span class="op">};</span></span></code></pre></div>
<p>Finally, current <code>inputValues</code> are updated. On the server side, the new value is received
by the server websocket message handler, that is <code>ws$onMessage(message)</code>.</p>
<div class="figure"><span id="fig:update-input-recap"></span>
<img src="images/survival-kit/update-input-recap.png" alt="What Shiny does client side on initialization" width="100%" />
<p class="caption">
FIGURE 8.9: What Shiny does client side on initialization
</p>
</div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="shiny-intro.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="shiny-custom-handler.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": {}
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/DivadNojnarg/outstanding-shiny-ui/edit/master/shiny-input-system.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": {},
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
